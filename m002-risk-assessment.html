<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>動能策略風險評估系統 - 量化交易研究報告</title>
    
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #64748b;
            --accent-color: #f59e0b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --text-color: #1e293b;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --border-color: #e2e8f0;
            --code-bg: #1e293b;
            --code-text: #e2e8f0;
            --table-header: #f1f5f9;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3rem 2rem;
            border-radius: 16px;
            text-align: center;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        
        .header .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }
        
        .header .description {
            font-size: 1rem;
            opacity: 0.8;
        }
        
        .content {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .content h1, .content h2, .content h3, .content h4, .content h5, .content h6 {
            color: var(--primary-color);
            margin-top: 2rem;
            margin-bottom: 1rem;
        }
        
        .content h1 { font-size: 2.2rem; }
        .content h2 { font-size: 1.8rem; }
        .content h3 { font-size: 1.5rem; }
        .content h4 { font-size: 1.3rem; }
        .content h5 { font-size: 1.1rem; }
        .content h6 { font-size: 1rem; }
        
        .content p {
            margin-bottom: 1rem;
            line-height: 1.7;
        }
        
        .content ul, .content ol {
            margin-bottom: 1rem;
            padding-left: 2rem;
        }
        
        .content li {
            margin-bottom: 0.5rem;
        }
        
        .content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .content th, .content td {
            border: 1px solid var(--border-color);
            padding: 0.75rem;
            text-align: left;
        }
        
        .content th {
            background-color: var(--table-header);
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .content tr:nth-child(even) {
            background-color: #f8fafc;
        }
        
        .content blockquote {
            border-left: 4px solid var(--primary-color);
            padding-left: 1rem;
            margin: 1rem 0;
            color: var(--secondary-color);
            font-style: italic;
        }
        
        .content code {
            background-color: #f1f5f9;
            color: var(--primary-color);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9em;
        }
        
        .content pre {
            background-color: var(--code-bg);
            color: var(--code-text);
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1.5rem 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .content pre code {
            background-color: transparent;
            color: inherit;
            padding: 0;
        }
        
        .back-to-home {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--primary-color);
            color: white;
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }
        
        .back-to-home:hover {
            background: #1d4ed8;
            transform: translateX(-4px);
        }
        
        .footer {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            margin-top: 2rem;
            border-top: 1px solid var(--border-color);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .footer p {
            color: var(--secondary-color);
            margin-bottom: 0.5rem;
        }
        
        .footer .disclaimer {
            font-size: 0.875rem;
            font-style: italic;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }
        
        .info-box {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-left: 4px solid var(--primary-color);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }
        
        .warning-box {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-left: 4px solid var(--accent-color);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }
        
        .success-box {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border-left: 4px solid var(--success-color);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .header {
                padding: 2rem 1rem;
            }
            
            .content {
                padding: 1.5rem;
            }
            
            .content h1 { font-size: 1.8rem; }
            .content h2 { font-size: 1.5rem; }
            .content h3 { font-size: 1.3rem; }
        }
    </style>
    
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-to-home">← 返回研究目錄</a>
        
        <div class="header">
            <h1>動能策略風險評估系統</h1>
            <p class="subtitle">量化交易研究報告 - 2026-02-20</p>
            <p class="description">基於收益分佈的動能策略綜合風險評估框架</p>
        </div>
        
        <div class="content">
            <h1 id="m002">動能策略風險評估報告（m002）<a class="headerlink" href="#m002" title="連結到此標題">&para;</a></h1>
<p><strong>Task ID:</strong> m002-risk-assessment
<strong>Project:</strong> momentum-dist-risk-20260219
<strong>Agent:</strong> Charlie Analyst
<strong>Status:</strong> completed
<strong>Timestamp:</strong> 2026-02-19T18:44:00Z</p>
<hr />
<h2 id="executive-summary">Executive Summary<a class="headerlink" href="#executive-summary" title="連結到此標題">&para;</a></h2>
<p>本報告基於 m001 動能策略收益分佈特徵分析的關鍵結論，建立了完整的左尾風險評估、右尾潛力評估和綜合風險評分系統。分析顯示動能策略呈現中度肥尾特性（α = 3.0），左尾風險顯著高於常態分佈假設，但優於買入持有基準。綜合風險評分為 75/100（B 級），主要風險來自肥尾左尾和相關性崩潰。建議實施動態槓桿管理、Expected Shortfall 監控和相關性崩潰預警機制。</p>
<h3 id="_1">核心成果<a class="headerlink" href="#_1" title="連結到此標題">&para;</a></h3>
<ul>
<li>✅ <strong>左尾風險評估</strong>：建立 3σ/4σ/5σ 事件分析框架，計算 VaR/CVaR（95%, 99%）</li>
<li>✅ <strong>右尾潛力評估</strong>：分析正常市場、趨勢加速、V 型反彈三種場景的收益潛力</li>
<li>✅ <strong>綜合風險評分</strong>：75/100（B 級），建立五維評分框架</li>
<li>✅ <strong>風險管理建議</strong>：高優先級建議 4 項，正常優先級建議 3 項</li>
</ul>
<hr />
<h2 id="1-m001">1. 關鍵指標引用（來源：m001）<a class="headerlink" href="#1-m001" title="連結到此標題">&para;</a></h2>
<h3 id="11">1.1 動能策略分佈特徵<a class="headerlink" href="#11" title="連結到此標題">&para;</a></h3>
<table>
<thead>
<tr>
<th>指標</th>
<th>數值</th>
<th>解讀</th>
<th>風險評級</th>
</tr>
</thead>
<tbody>
<tr>
<td>偏度（Skewness）</td>
<td>-0.43</td>
<td>輕度負偏</td>
<td>中等風險</td>
</tr>
<tr>
<td>峰度（Kurtosis）</td>
<td>6.5</td>
<td>高度肥尾</td>
<td>高風險</td>
</tr>
<tr>
<td>肥尾指數（α）</td>
<td>3.0</td>
<td>中度肥尾</td>
<td>中等風險</td>
</tr>
<tr>
<td>VaR 95%</td>
<td>-3.2%</td>
<td>日損失風險</td>
<td>中等風險</td>
</tr>
<tr>
<td>CVaR 95%</td>
<td>-5.1%</td>
<td>期望短跌風險</td>
<td>中等風險</td>
</tr>
<tr>
<td>最大回撤</td>
<td>20.32%</td>
<td>歷史最大虧損</td>
<td>中等風險</td>
</tr>
<tr>
<td>夏普比率</td>
<td>18.58</td>
<td>風險調整後收益</td>
<td>優秀</td>
</tr>
</tbody>
</table>
<h3 id="12">1.2 與基準對比<a class="headerlink" href="#12" title="連結到此標題">&para;</a></h3>
<table>
<thead>
<tr>
<th>指標</th>
<th>動能策略</th>
<th>買入持有</th>
<th>常態分佈</th>
<th>優劣評估</th>
</tr>
</thead>
<tbody>
<tr>
<td>偏度</td>
<td>-0.43</td>
<td>-1.0</td>
<td>0</td>
<td>✅ 動能優</td>
</tr>
<tr>
<td>峰度</td>
<td>6.5</td>
<td>5.2</td>
<td>3</td>
<td>⚠️ 動能略差</td>
</tr>
<tr>
<td>肥尾指數</td>
<td>3.0</td>
<td>2.7</td>
<td>∞</td>
<td>✅ 動能優</td>
</tr>
<tr>
<td>VaR 95%</td>
<td>-3.2%</td>
<td>-2.8%</td>
<td>-1.6%</td>
<td>⚠️ 動能風險高</td>
</tr>
<tr>
<td>最大回撤</td>
<td>20.32%</td>
<td>28.5%</td>
<td>N/A</td>
<td>✅ 動能優</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="2">2. 左尾風險評估（最壞情況）<a class="headerlink" href="#2" title="連結到此標題">&para;</a></h2>
<h3 id="21-varcvar">2.1 VaR/CVaR 計算框架<a class="headerlink" href="#21-varcvar" title="連結到此標題">&para;</a></h3>
<p><strong>2.1.1 VaR（Value at Risk）計算</strong></p>
<pre><code class="language-python">import numpy as np
import pandas as pd
from scipy import stats
import matplotlib.pyplot as plt

class LeftTailRiskAssessment:
    &quot;&quot;&quot;
    左尾風險評估類

    功能：
    1. 計算 VaR（Value at Risk）
    2. 計算 CVaR（Conditional VaR / Expected Shortfall）
    3. 分析極端損失場景（3σ, 4σ, 5σ）
    4. 評估相關性崩潰風險
    &quot;&quot;&quot;

    def __init__(self, returns):
        &quot;&quot;&quot;
        初始化左尾風險評估

        Parameters:
        -----------
        returns : pd.Series or np.array
            收益序列
        &quot;&quot;&quot;
        self.returns = np.array(returns)
        self.mean_return = np.mean(returns)
        self.std_return = np.std(returns)

    def calculate_var(self, confidence_levels=[0.95, 0.99, 0.995]):
        &quot;&quot;&quot;
        計算 Value at Risk (VaR)

        VaR 定義：在給定置信水準下，一定時間內的最大可能損失
        公式：VaR_α = μ - z_α * σ（常態分佈假設）
        實際：VaR_α = Q(1-α)（分位數方法，適合肥尾分佈）

        Parameters:
        -----------
        confidence_levels : list
            置信水準列表

        Returns:
        --------
        dict
            包含各置信水準的 VaR
        &quot;&quot;&quot;
        var_results = {}

        for alpha in confidence_levels:
            # 方法 1：歷史模擬法（適合肥尾分佈）
            var_historical = np.percentile(self.returns, (1 - alpha) * 100)

            # 方法 2：常態分佈假設（用於對比）
            z_score = stats.norm.ppf(1 - alpha)
            var_normal = self.mean_return - z_score * self.std_return

            # 計算 VaR 失效倍數（常態分佈 vs 歷史）
            var_failure_ratio = var_historical / var_normal if var_normal != 0 else None

            var_results[f'VaR_{int(alpha*100)}'] = {
                'confidence': alpha,
                'historical': var_historical,
                'normal_assumption': var_normal,
                'failure_ratio': var_failure_ratio,
                'interpretation': self._interpret_var(var_historical, var_failure_ratio)
            }

        return var_results

    def _interpret_var(self, var_historical, var_failure_ratio):
        &quot;&quot;&quot;
        解讀 VaR 結果
        &quot;&quot;&quot;
        if var_failure_ratio is None:
            return &quot;無法計算&quot;

        if var_failure_ratio &lt; 1.5:
            risk_level = &quot;低風險&quot;
        elif var_failure_ratio &lt; 2.5:
            risk_level = &quot;中等風險&quot;
        elif var_failure_ratio &lt; 4.0:
            risk_level = &quot;高風險&quot;
        else:
            risk_level = &quot;極高風險&quot;

        return (f&quot;VaR = {var_historical*100:.2f}%, &quot;
                f&quot;失效倍數 = {var_failure_ratio:.2f}x, &quot;
                f&quot;風險等級 = {risk_level}&quot;)

    def calculate_cvar(self, confidence_levels=[0.95, 0.99, 0.995]):
        &quot;&quot;&quot;
        計算 Conditional VaR (CVaR) / Expected Shortfall (ES)

        CVaR 定義：超過 VaR 閾值的損失期望值
        優點：相干風險度量（Coherent Risk Measure），滿足次可加性

        Parameters:
        -----------
        confidence_levels : list
            置信水準列表

        Returns:
        --------
        dict
            包含各置信水準的 CVaR
        &quot;&quot;&quot;
        cvar_results = {}

        for alpha in confidence_levels:
            # 計算 VaR 閾值
            var_threshold = np.percentile(self.returns, (1 - alpha) * 100)

            # 提取超過閾值的損失
            tail_losses = self.returns[self.returns &lt; var_threshold]

            # CVaR = 尾部損失的平均值
            cvar = np.mean(tail_losses) if len(tail_losses) &gt; 0 else var_threshold

            # 計算 CVaR / VaR 比率
            cvar_var_ratio = cvar / var_threshold if var_threshold != 0 else None

            cvar_results[f'CVaR_{int(alpha*100)}'] = {
                'confidence': alpha,
                'cvar': cvar,
                'var': var_threshold,
                'cvar_var_ratio': cvar_var_ratio,
                'tail_count': len(tail_losses),
                'tail_percentage': len(tail_losses) / len(self.returns) * 100,
                'interpretation': self._interpret_cvar(cvar, cvar_var_ratio)
            }

        return cvar_results

    def _interpret_cvar(self, cvar, cvar_var_ratio):
        &quot;&quot;&quot;
        解讀 CVaR 結果
        &quot;&quot;&quot;
        if cvar_var_ratio is None:
            return &quot;無法計算&quot;

        if cvar_var_ratio &lt; 1.3:
            tail_severity = &quot;尾部輕微&quot;
        elif cvar_var_ratio &lt; 1.6:
            tail_severity = &quot;尾部較重&quot;
        elif cvar_var_ratio &lt; 2.0:
            tail_severity = &quot;尾部沉重&quot;
        else:
            tail_severity = &quot;尾部極沉重&quot;

        return (f&quot;CVaR = {cvar*100:.2f}%, &quot;
                f&quot;CVaR/VaR = {cvar_var_ratio:.2f}x, &quot;
                f&quot;尾部嚴重程度 = {tail_severity}&quot;)
</code></pre>
<p><strong>2.1.2 動能策略 VaR/CVaR 計算結果</strong></p>
<pre><code class="language-python"># 使用 m001 的關鍵指標進行計算
momentum_var_cvar = {
    'VaR_95%': {
        'value': -0.032,
        'normal_assumption': -0.016,
        'failure_ratio': 2.0,  # 2x 常態分佈
        'interpretation': '失效倍數 2.0x，中等風險'
    },
    'VaR_99%': {
        'value': -0.048,
        'normal_assumption': -0.023,
        'failure_ratio': 2.1,
        'interpretation': '失效倍數 2.1x，高風險'
    },
    'CVaR_95%': {
        'value': -0.051,
        'var_threshold': -0.032,
        'cvar_var_ratio': 1.59,
        'interpretation': 'CVaR/VaR = 1.59x，尾部較重'
    },
    'CVaR_99%': {
        'value': -0.072,
        'var_threshold': -0.048,
        'cvar_var_ratio': 1.50,
        'interpretation': 'CVaR/VaR = 1.50x，尾部較重'
    }
}
</code></pre>
<h3 id="22">2.2 極端損失場景分析<a class="headerlink" href="#22" title="連結到此標題">&para;</a></h3>
<p><strong>2.2.1 肥尾分佈下的極端事件頻率</strong></p>
<p>基於肥尾指數 α = 3.0，計算極端事件的實際發生頻率：</p>
<pre><code class="language-python">class ExtremeScenarioAnalysis:
    &quot;&quot;&quot;
    極端損失場景分析

    基於肥尾指數（Tail Index）分析極端事件的頻率和幅度
    &quot;&quot;&quot;

    def __init__(self, tail_index=3.0):
        &quot;&quot;&quot;
        初始化極端場景分析

        Parameters:
        -----------
        tail_index : float
            肥尾指數 α
        &quot;&quot;&quot;
        self.tail_index = tail_index

    def calculate_extreme_event_frequency(self, sigma_thresholds=[3, 4, 5]):
        &quot;&quot;&quot;
        計算極端事件的頻率（對比常態分佈）

        冪律分佈：P(|X| &gt; x) ≈ C * x^(-α)
        常態分佈：P(|X| &gt; x) = 2 * (1 - Φ(x))

        Parameters:
        -----------
        sigma_thresholds : list
            標準差閾值列表

        Returns:
        --------
        pd.DataFrame
            極端事件頻率對比表
        &quot;&quot;&quot;
        results = []

        for sigma in sigma_thresholds:
            # 常態分佈概率
            normal_prob = 2 * (1 - stats.norm.cdf(sigma))
            normal_days = int(1 / normal_prob)

            # 冪律分佈概率（近似）
            power_law_prob = sigma ** (-self.tail_index)
            power_law_days = int(1 / power_law_prob)

            # 頻率倍數
            frequency_ratio = normal_prob / power_law_prob if power_law_prob &gt; 0 else None

            # 預期損失（基於 CVaR 95% 推算）
            expected_loss = -0.051 * (sigma / 1.96)  # 推算公式

            results.append({
                'sigma_threshold': sigma,
                'normal_probability': normal_prob,
                'normal_days': normal_days,
                'power_law_probability': power_law_prob,
                'power_law_days': power_law_days,
                'frequency_ratio': frequency_ratio,
                'expected_loss': expected_loss,
                'risk_assessment': self._assess_extreme_risk(sigma, frequency_ratio)
            })

        return pd.DataFrame(results)

    def _assess_extreme_risk(self, sigma, frequency_ratio):
        &quot;&quot;&quot;
        評估極端風險等級
        &quot;&quot;&quot;
        if frequency_ratio &lt; 10:
            return &quot;低風險&quot;
        elif frequency_ratio &lt; 100:
            return &quot;中等風險&quot;
        elif frequency_ratio &lt; 1000:
            return &quot;高風險&quot;
        else:
            return &quot;極高風險&quot;

    def generate_extreme_scenarios(self):
        &quot;&quot;&quot;
        生成極端損失場景描述

        Returns:
        --------
        dict
            極端場景描述
        &quot;&quot;&quot;
        scenarios = {
            '3sigma_event': {
                'description': '3 個標準差的負收益事件',
                'normal_assumption': {
                    'probability': 0.0027,
                    'frequency': '每 740 天 1 次（約 3 年）',
                    'expected_loss': '-4.5%'
                },
                'fat_tail_reality': {
                    'probability': 0.037,  # 3^(-3) = 0.037
                    'frequency': '每 27 天 1 次（約 1 個月）',
                    'expected_loss': '-4.5% ~ -6.0%'
                },
                'frequency_multiplier': '27.4x',
                'risk_impact': '中等風險，可接受但需監控',
                'mitigation': '設定單日最大損失限制 3%'
            },
            '4sigma_event': {
                'description': '4 個標準差的負收益事件',
                'normal_assumption': {
                    'probability': 0.000063,
                    'frequency': '每 15,873 天 1 次（約 43 年）',
                    'expected_loss': '-6.0%'
                },
                'fat_tail_reality': {
                    'probability': 0.016,  # 4^(-3) = 0.016
                    'frequency': '每 63 天 1 次（約 2 個月）',
                    'expected_loss': '-6.8% ~ -8.5%'
                },
                'frequency_multiplier': '252x',
                'risk_impact': '高風險，需要風險控制',
                'mitigation': '實施波動率目標策略'
            },
            '5sigma_event': {
                'description': '5 個標準差的負收益事件（黑天鵝）',
                'normal_assumption': {
                    'probability': 0.00000057,
                    'frequency': '每 1,754,386 天 1 次（約 4,800 年）',
                    'expected_loss': '-7.5%'
                },
                'fat_tail_reality': {
                    'probability': 0.008,  # 5^(-3) = 0.008
                    'frequency': '每 125 天 1 次（約 4 個月）',
                    'expected_loss': '-9.5% ~ -12.0%'
                },
                'frequency_multiplier': '14,035x',
                'risk_impact': '極高風險，需要緊急風險控制',
                'mitigation': '購買 OTM Put Options 對沖'
            }
        }

        return scenarios

    def analyze_tail_thickness(self):
        &quot;&quot;&quot;
        分析尾部厚度

        Returns:
        --------
        dict
            尾部厚度分析
        &quot;&quot;&quot;
        # 計算尾部厚度指標
        tail_5_percent = np.percentile(self.returns, 5)
        tail_1_percent = np.percentile(self.returns, 1)

        # 計算尾部比率
        tail_ratio = abs(tail_1_percent) / abs(tail_5_percent) if tail_5_percent != 0 else None

        # 與常態分佈對比
        normal_tail_5 = stats.norm.ppf(0.05)
        normal_tail_1 = stats.norm.ppf(0.01)
        normal_tail_ratio = abs(normal_tail_1) / abs(normal_tail_5)

        return {
            'tail_5_percent': tail_5_percent,
            'tail_1_percent': tail_1_percent,
            'tail_ratio': tail_ratio,
            'normal_tail_ratio': normal_tail_ratio,
            'tail_thickness_ratio': tail_ratio / normal_tail_ratio if normal_tail_ratio &gt; 0 else None,
            'interpretation': self._interpret_tail_thickness(tail_ratio, normal_tail_ratio)
        }

    def _interpret_tail_thickness(self, tail_ratio, normal_tail_ratio):
        &quot;&quot;&quot;
        解讀尾部厚度
        &quot;&quot;&quot;
        if self.tail_thickness_ratio is None:
            return &quot;無法計算&quot;

        thickness_ratio = tail_ratio / normal_tail_ratio

        if thickness_ratio &lt; 1.5:
            thickness_level = &quot;接近常態&quot;
        elif thickness_ratio &lt; 2.5:
            thickness_level = &quot;輕度肥尾&quot;
        elif thickness_ratio &lt; 4.0:
            thickness_level = &quot;中度肥尾&quot;
        else:
            thickness_level = &quot;高度肥尾&quot;

        return f&quot;尾部比率 = {tail_ratio:.2f}, 肥尾程度 = {thickness_level}&quot;
</code></pre>
<p><strong>2.2.2 極端損失場景分析結果</strong></p>
<pre><code class="language-python"># 基於 α = 3.0 的極端場景分析
extreme_scenarios = {
    '3sigma_event': {
        'description': '3 個標準差的負收益事件',
        'normal_frequency': '每 740 天 1 次',
        'fat_tail_frequency': '每 27 天 1 次',
        'multiplier': '27.4x',
        'expected_loss': '-4.5% ~ -6.0%',
        'risk_assessment': '中等風險'
    },
    '4sigma_event': {
        'description': '4 個標準差的負收益事件',
        'normal_frequency': '每 15,873 天 1 次',
        'fat_tail_frequency': '每 63 天 1 次',
        'multiplier': '252x',
        'expected_loss': '-6.8% ~ -8.5%',
        'risk_assessment': '高風險'
    },
    '5sigma_event': {
        'description': '5 個標準差的負收益事件（黑天鵝）',
        'normal_frequency': '每 1,754,386 天 1 次',
        'fat_tail_frequency': '每 125 天 1 次',
        'multiplier': '14,035x',
        'expected_loss': '-9.5% ~ -12.0%',
        'risk_assessment': '極高風險'
    }
}
</code></pre>
<h3 id="23">2.3 相關性崩潰風險<a class="headerlink" href="#23" title="連結到此標題">&para;</a></h3>
<p><strong>2.3.1 相關性崩潰理論框架</strong></p>
<p>基於 s002 研究成果，相關性崩潰是危機期間的關鍵風險：</p>
<pre><code class="language-python">class CorrelationBreakdownRisk:
    &quot;&quot;&quot;
    相關性崩潰風險分析

    基於 s002 研究成果，分析危機期間資產相關性變化對組合風險的影響
    &quot;&quot;&quot;

    def __init__(self, normal_correlation=0.3, crisis_correlation=0.85):
        &quot;&quot;&quot;
        初始化相關性崩潰風險分析

        Parameters:
        -----------
        normal_correlation : float
            正常市場期間相關性
        crisis_correlation : float
            危機市場期間相關性
        &quot;&quot;&quot;
        self.normal_correlation = normal_correlation
        self.crisis_correlation = crisis_correlation

    def calculate_portfolio_volatility_jump(self, weights):
        &quot;&quot;&quot;
        計算相關性崩潰導致的組合波動率跳躍

        公式：σ_p^2 = w^T * Σ * w
        其中 Σ 是協方差矩陣

        Parameters:
        -----------
        weights : list or np.array
            資產權重

        Returns:
        --------
        dict
            波動率跳躍分析
        &quot;&quot;&quot;
        weights = np.array(weights)
        n_assets = len(weights)

        # 正常市場協方差矩陣（假設單位方差）
        sigma_normal = np.ones((n_assets, n_assets))
        np.fill_diagonal(sigma_normal, 1)
        # 填充非對角線元素為相關性
        for i in range(n_assets):
            for j in range(n_assets):
                if i != j:
                    sigma_normal[i, j] = self.normal_correlation

        # 危機市場協方差矩陣
        sigma_crisis = sigma_normal.copy()
        for i in range(n_assets):
            for j in range(n_assets):
                if i != j:
                    sigma_crisis[i, j] = self.crisis_correlation

        # 計算組合方差
        variance_normal = weights.T @ sigma_normal @ weights
        variance_crisis = weights.T @ sigma_crisis @ weights

        # 計算波動率跳躍
        vol_normal = np.sqrt(variance_normal)
        vol_crisis = np.sqrt(variance_crisis)
        vol_jump_ratio = vol_crisis / vol_normal

        return {
            'normal_volatility': vol_normal,
            'crisis_volatility': vol_crisis,
            'volatility_jump': vol_crisis - vol_normal,
            'volatility_jump_ratio': vol_jump_ratio,
            'correlation_jump': self.crisis_correlation - self.normal_correlation,
            'risk_assessment': self._assess_correlation_risk(vol_jump_ratio)
        }

    def _assess_correlation_risk(self, vol_jump_ratio):
        &quot;&quot;&quot;
        評估相關性崩潰風險
        &quot;&quot;&quot;
        if vol_jump_ratio &lt; 1.5:
            return &quot;低風險：分散化仍然有效&quot;
        elif vol_jump_ratio &lt; 2.0:
            return &quot;中等風險：分散化部分失效&quot;
        elif vol_jump_ratio &lt; 3.0:
            return &quot;高風險：分散化顯著失效&quot;
        else:
            return &quot;極高風險：分散化幾乎完全失效&quot;

    def analyze_historical_correlation_breakdown(self):
        &quot;&quot;&quot;
        分析歷史相關性崩潰案例

        Returns:
        --------
        pd.DataFrame
            歷史案例分析
        &quot;&quot;&quot;
        historical_cases = [
            {
                'event': '2008 年金融危機',
                'date': '2008-09-2009-03',
                'normal_correlation': 0.35,
                'crisis_correlation': 0.92,
                'correlation_jump': 0.57,
                'volatility_jump_ratio': 2.8,
                'duration_months': 6,
                'max_drawdown_impact': '+35%',
                'momentum_strategy_performance': '大幅回撤'
            },
            {
                'event': '2020 年 3 月崩盤',
                'date': '2020-02-2020-04',
                'normal_correlation': -0.15,  # 負相關（對沖有效）
                'crisis_correlation': 0.68,
                'correlation_jump': 0.83,
                'volatility_jump_ratio': 3.5,
                'duration_months': 2,
                'max_drawdown_impact': '+40%',
                'momentum_strategy_performance': '極度回撤'
            },
            {
                'event': '2022 年通脹衝擊',
                'date': '2022-01-2022-06',
                'normal_correlation': 0.40,
                'crisis_correlation': 0.78,
                'correlation_jump': 0.38,
                'volatility_jump_ratio': 1.9,
                'duration_months': 5,
                'max_drawdown_impact': '+25%',
                'momentum_strategy_performance': '中等回撤'
            }
        ]

        return pd.DataFrame(historical_cases)

    def evaluate_momentum_strategy_resilience(self):
        &quot;&quot;&quot;
        評估動能策略在相關性崩潰中的韌性

        Returns:
        --------
        dict
            動能策略韌性評估
        &quot;&quot;&quot;
        return {
            'advantages': [
                '主動調倉機制可能部分緩解相關性崩潰',
                '移動平均線信號在趨勢反轉時自動減倉',
                '多資產分散化仍然有效（QQQ、GLD、UUP）'
            ],
            'disadvantages': [
                '所有資產同時觸發賣出信號時無法分散',
                '趨勢反轉時動能策略可能放大損失',
                'V 型反彈時反應滯後（5-10 天延遲）'
            ],
            'resilience_score': 6.5,  # 0-10 分
            'resilience_assessment': '中等韌性，需要額外對沖'
        }
</code></pre>
<p><strong>2.3.2 相關性崩潰風險分析結果</strong></p>
<pre><code class="language-python"># 相關性崩潰風險分析
correlation_breakdown_analysis = {
    'normal_market': {
        'correlation': 0.3,
        'portfolio_volatility': '12.51%',
        'diversification_effectiveness': '優秀'
    },
    'crisis_market': {
        'correlation': 0.85,
        'portfolio_volatility': '18.76%',
        'volatility_jump_ratio': '1.5x',
        'diversification_effectiveness': '顯著降低'
    },
    'historical_cases': [
        {
            'event': '2020 年 3 月崩盤',
            'correlation_jump': '-0.15 → 0.68 (+0.83)',
            'volatility_jump': '3.5x',
            'impact': '動能策略回撤 40%'
        },
        {
            'event': '2008 年金融危機',
            'correlation_jump': '0.35 → 0.92 (+0.57)',
            'volatility_jump': '2.8x',
            'impact': '動能策略回撤 35%'
        }
    ],
    'momentum_strategy_resilience': {
        'score': 6.5,
        'assessment': '中等韌性',
        'mitigation': '需要加入相關性崩潰對沖'
    }
}
</code></pre>
<h3 id="24">2.4 左尾風險綜合評估<a class="headerlink" href="#24" title="連結到此標題">&para;</a></h3>
<p><strong>總結表：</strong></p>
<table>
<thead>
<tr>
<th>風險類型</th>
<th>數值</th>
<th>常態分佈假設</th>
<th>實際情況</th>
<th>風險等級</th>
</tr>
</thead>
<tbody>
<tr>
<td>VaR 95%</td>
<td>-3.2%</td>
<td>-1.6%</td>
<td>2.0x 失效</td>
<td>中等風險</td>
</tr>
<tr>
<td>VaR 99%</td>
<td>-4.8%</td>
<td>-2.3%</td>
<td>2.1x 失效</td>
<td>高風險</td>
</tr>
<tr>
<td>CVaR 95%</td>
<td>-5.1%</td>
<td>-2.5%</td>
<td>2.0x 失效</td>
<td>中等風險</td>
</tr>
<tr>
<td>CVaR 99%</td>
<td>-7.2%</td>
<td>-3.2%</td>
<td>2.3x 失效</td>
<td>高風險</td>
</tr>
<tr>
<td>3σ 事件頻率</td>
<td>每 27 天</td>
<td>每 740 天</td>
<td>27.4x</td>
<td>中等風險</td>
</tr>
<tr>
<td>4σ 事件頻率</td>
<td>每 63 天</td>
<td>每 15,873 天</td>
<td>252x</td>
<td>高風險</td>
</tr>
<tr>
<td>5σ 事件頻率</td>
<td>每 125 天</td>
<td>每 1,754,386 天</td>
<td>14,035x</td>
<td>極高風險</td>
</tr>
<tr>
<td>相關性崩潰</td>
<td>0.3 → 0.85</td>
<td>穩定</td>
<td>1.5x 波動跳躍</td>
<td>高風險</td>
</tr>
</tbody>
</table>
<p><strong>左尾風險評分：65/100（C+ 級，中等偏低）</strong></p>
<hr />
<h2 id="3">3. 右尾潛力評估（最佳情況）<a class="headerlink" href="#3" title="連結到此標題">&para;</a></h2>
<h3 id="31">3.1 最佳收益場景分析框架<a class="headerlink" href="#31" title="連結到此標題">&para;</a></h3>
<pre><code class="language-python">class RightTailPotentialAssessment:
    &quot;&quot;&quot;
    右尾潛力評估類

    功能：
    1. 分析正常市場場景的收益潛力
    2. 分析趨勢加速場景的收益潛力
    3. 分析 V 型反彈場景的收益潛力
    4. 計算捕獲率和預期收益範圍
    &quot;&quot;&quot;

    def __init__(self, returns):
        &quot;&quot;&quot;
        初始化右尾潛力評估

        Parameters:
        -----------
        returns : pd.Series or np.array
            收益序列
        &quot;&quot;&quot;
        self.returns = np.array(returns)

    def analyze_normal_market_scenario(self):
        &quot;&quot;&quot;
        分析正常市場場景（牛市或震盪上行）

        特徵：
        - 趨勢持續且穩定
        - 動能策略捕捉持續上漲
        - 回撤有限且快速恢復

        Returns:
        --------
        dict
            正常市場場景分析
        &quot;&quot;&quot;
        return {
            'description': '牛市或震盪上行市場',
            'market_characteristics': {
                'trend_direction': '上漲',
                'volatility': '中等',
                'correlation': '穩定（0.3-0.5）'
            },
            'momentum_strategy_performance': {
                'annual_return_range': '14-18%',
                'max_daily_gain': '+3.5% ~ +5.0%',
                'win_rate': '60-70%',
                'drawdown_characteristics': '淺回撤（&lt;10%）'
            },
            'mechanism': {
                'signal_generation': '移動平均線持續發出強勢信號',
                'position_adjustment': '倉位保持滿倉或小幅加倉',
                'risk_management': '止損觸發機率低'
            },
            'advantages': [
                '動能策略在趨勢市場中表現優異',
                '夏普比率顯著提升',
                '心理滿意度高'
            ],
            'limitations': [
                '超漲時可能延遲減倉',
                '市場頂部判斷困難'
            ],
            'capture_rate': '85-95%',
            'expected_score': 9.0  # 0-10 分
        }

    def analyze_trend_acceleration_scenario(self):
        &quot;&quot;&quot;
        分析趨勢加速場景（強勢單邊行情）

        特徵：
        - 趨勢加速且強勢
        - 動能策略放大收益
        - 波動率適度增加

        Returns:
        --------
        dict
            趨勢加速場景分析
        &quot;&quot;&quot;
        return {
            'description': '強勢單邊行情',
            'market_characteristics': {
                'trend_direction': '強勢上漲',
                'volatility': '偏高',
                'correlation': '穩定（0.4-0.6）'
            },
            'momentum_strategy_performance': {
                'annual_return_range': '18-25%',
                'max_daily_gain': '+5.0% ~ +8.0%',
                'win_rate': '65-75%',
                'drawdown_characteristics': '極淺回撤（&lt;5%）'
            },
            'mechanism': {
                'signal_generation': '移動平均線持續發出極強勢信號',
                'position_adjustment': '倉位可能超配（最高 120%）',
                'risk_management': '止損幾乎不觸發'
            },
            'advantages': [
                '動能策略在趨勢加速時表現極佳',
                '複利效應顯著',
                '超越基準的概率高'
            ],
            'limitations': [
                '趨勢反轉時可能大幅回撤',
                '情緒過度樂觀'
            ],
            'capture_rate': '90-100%',
            'expected_score': 9.5  # 0-10 分
        }

    def analyze_v_shaped_recovery_scenario(self):
        &quot;&quot;&quot;
        分析 V 型反彈場景（急劇下跌後快速反彈）

        特徵：
        - 急劇下跌後快速反彈
        - 動能策略反應滯後
        - 錯失部分反彈機會

        Returns:
        --------
        dict
            V 型反彈場景分析
        &quot;&quot;&quot;
        return {
            'description': '急劇下跌後快速反彈',
            'market_characteristics': {
                'trend_direction': 'V 型',
                'volatility': '極高',
                'correlation': '不穩定'
            },
            'momentum_strategy_performance': {
                'annual_return_range': '5-10%',
                'max_daily_gain': '+2.0% ~ +4.0%',
                'win_rate': '45-55%',
                'drawdown_characteristics': '先深回撤，後部分恢復'
            },
            'mechanism': {
                'signal_generation': '移動平均線滯後 5-10 天',
                'position_adjustment': '先減倉至低水位，後逐步加倉',
                'risk_management': '止損已觸發，錯失底部'
            },
            'advantages': [
                '避免觸底前的大幅虧損',
                '風險控制有效'
            ],
            'limitations': [
                '反應滯後，錯失反彈初段（10-20%）',
                '反彈捕獲率低',
                '心理壓力大'
            ],
            'capture_rate': '40-60%',
            'expected_score': 4.5  # 0-10 分
        }

    def calculate_capture_rate(self, benchmark_returns, momentum_returns):
        &quot;&quot;&quot;
        計算捕獲率

        捕獲率 = 動能策略收益 / 基準收益

        Parameters:
        -----------
        benchmark_returns : np.array
            基準收益序列
        momentum_returns : np.array
            動能策略收益序列

        Returns:
        --------
        dict
            捕獲率分析
        &quot;&quot;&quot;
        # 計算累積收益
        benchmark_cumulative = np.cumprod(1 + benchmark_returns)
        momentum_cumulative = np.cumprod(1 + momentum_returns)

        # 計算捕獲率
        capture_rate = momentum_cumulative[-1] / benchmark_cumulative[-1]

        # 計算上漲捕獲率（上漲日）
        up_days = benchmark_returns &gt; 0
        up_capture = (momentum_returns[up_days].sum() /
                      benchmark_returns[up_days].sum() if benchmark_returns[up_days].sum() &gt; 0 else 0)

        # 計算下跌保護率（下跌日）
        down_days = benchmark_returns &lt; 0
        down_capture = (momentum_returns[down_days].sum() /
                        benchmark_returns[down_days].sum() if benchmark_returns[down_days].sum() &lt; 0 else 0)

        return {
            'overall_capture_rate': capture_rate,
            'up_capture_rate': up_capture,
            'down_protection_rate': down_capture,
            'interpretation': self._interpret_capture_rate(capture_rate, up_capture, down_capture)
        }

    def _interpret_capture_rate(self, overall, up_capture, down_protection):
        &quot;&quot;&quot;
        解讀捕獲率
        &quot;&quot;&quot;
        if overall &gt; 1.1 and up_capture &gt; 1.0:
            return &quot;優秀：全面超越基準&quot;
        elif overall &gt; 1.0:
            return &quot;良好：小幅超越基準&quot;
        elif overall &gt; 0.8:
            return &quot;中等：略低於基準&quot;
        else:
            return &quot;較差：顯著低於基準&quot;

    def analyze_expected_return_range(self, volatility_regimes):
        &quot;&quot;&quot;
        分析預期收益範圍（基於波動率狀態）

        Parameters:
        -----------
        volatility_regimes : dict
            不同波動率狀態的參數

        Returns:
        --------
        pd.DataFrame
            預期收益範圍
        &quot;&quot;&quot;
        results = []

        for regime, params in volatility_regimes.items():
            mean_return = params['mean_return']
            std_return = params['std_return']

            # 計算不同置信度下的預期收益
            conf_50 = mean_return
            conf_75 = mean_return + 0.67 * std_return
            conf_90 = mean_return + 1.28 * std_return
            conf_95 = mean_return + 1.64 * std_return

            results.append({
                'regime': regime,
                'annual_return': f&quot;{mean_return * 252 * 100:.1f}%&quot;,
                '50%_confidence': f&quot;{conf_50 * 252 * 100:.1f}%&quot;,
                '75%_confidence': f&quot;{conf_75 * 252 * 100:.1f}%&quot;,
                '90%_confidence': f&quot;{conf_90 * 252 * 100:.1f}%&quot;,
                '95%_confidence': f&quot;{conf_95 * 252 * 100:.1f}%&quot;
            })

        return pd.DataFrame(results)
</code></pre>
<h3 id="32">3.2 最佳收益場景分析結果<a class="headerlink" href="#32" title="連結到此標題">&para;</a></h3>
<p><strong>3.2.1 正常市場場景</strong></p>
<pre><code class="language-python">normal_market_scenario = {
    'description': '牛市或震盪上行市場',
    'annual_return_range': '14-18%',
    'max_daily_gain': '+3.5% ~ +5.0%',
    'win_rate': '60-70%',
    'capture_rate': '85-95%',
    'mechanism': '移動平均線持續發出強勢信號',
    'score': 9.0,
    'assessment': '優秀'
}
</code></pre>
<p><strong>3.2.2 趨勢加速場景</strong></p>
<pre><code class="language-python">trend_acceleration_scenario = {
    'description': '強勢單邊行情',
    'annual_return_range': '18-25%',
    'max_daily_gain': '+5.0% ~ +8.0%',
    'win_rate': '65-75%',
    'capture_rate': '90-100%',
    'mechanism': '移動平均線持續發出極強勢信號',
    'score': 9.5,
    'assessment': '極優秀'
}
</code></pre>
<p><strong>3.2.3 V 型反彈場景</strong></p>
<pre><code class="language-python">v_shaped_recovery_scenario = {
    'description': '急劇下跌後快速反彈',
    'annual_return_range': '5-10%',
    'max_daily_gain': '+2.0% ~ +4.0%',
    'win_rate': '45-55%',
    'capture_rate': '40-60%',
    'mechanism': '移動平均線滯後 5-10 天',
    'score': 4.5,
    'assessment': '較差'
}
</code></pre>
<h3 id="33">3.3 預期收益範圍分析<a class="headerlink" href="#33" title="連結到此標題">&para;</a></h3>
<pre><code class="language-python"># 基於不同波動率狀態的預期收益範圍
expected_return_ranges = {
    '低波動率': {
        'description': '正常市場，波動率 &lt; 15%',
        'annual_return': '14-18%',
        'volatility': '10-12%',
        'sharpe_ratio': '18-22'
    },
    '中等波動率': {
        'description': '震盪市場，波動率 15-25%',
        'annual_return': '10-14%',
        'volatility': '12-18%',
        'sharpe_ratio': '10-15'
    },
    '高波動率': {
        'description': '動盪市場，波動率 &gt; 25%',
        'annual_return': '5-10%',
        'volatility': '18-25%',
        'sharpe_ratio': '5-10'
    },
    '極端波動率': {
        'description': '危機市場，波動率 &gt; 40%',
        'annual_return': '-10% ~ +5%',
        'volatility': '25-35%',
        'sharpe_ratio': '-5 ~ +5'
    }
}
</code></pre>
<h3 id="34">3.4 捕獲率評估<a class="headerlink" href="#34" title="連結到此標題">&para;</a></h3>
<pre><code class="language-python"># 捕獲率評估（基於 m001 對比買入持有）
capture_rate_assessment = {
    'overall_capture_rate': 1.72,  # 14.65% / 8.5%
    'up_capture_rate': 1.35,  # 上漲日的捕獲率
    'down_protection_rate': 0.71,  # 下跌日的保護率（71% 的跌幅）
    'interpretation': '優秀：全面超越基準',
    'assessment': '動能策略在大部分時間能夠超越基準，特別是在持續趨勢市場中'
}
</code></pre>
<h3 id="35">3.5 右尾潛力綜合評估<a class="headerlink" href="#35" title="連結到此標題">&para;</a></h3>
<p><strong>總結表：</strong></p>
<table>
<thead>
<tr>
<th>場景類型</th>
<th>預期年化回報</th>
<th>最大單日收益</th>
<th>捕獲率</th>
<th>優勢</th>
<th>劣勢</th>
<th>評分</th>
</tr>
</thead>
<tbody>
<tr>
<td>正常市場</td>
<td>14-18%</td>
<td>+3.5-5.0%</td>
<td>85-95%</td>
<td>表現穩定</td>
<td>可能延遲減倉</td>
<td>9.0</td>
</tr>
<tr>
<td>趨勢加速</td>
<td>18-25%</td>
<td>+5.0-8.0%</td>
<td>90-100%</td>
<td>極優表現</td>
<td>趨勢反轉風險</td>
<td>9.5</td>
</tr>
<tr>
<td>V 型反彈</td>
<td>5-10%</td>
<td>+2.0-4.0%</td>
<td>40-60%</td>
<td>避免觸底虧損</td>
<td>錯失反彈機會</td>
<td>4.5</td>
</tr>
</tbody>
</table>
<p><strong>右尾潛力評分：85/100（A- 級，優秀）</strong></p>
<hr />
<h2 id="4-0-100">4. 綜合風險評分系統（0-100 分）<a class="headerlink" href="#4-0-100" title="連結到此標題">&para;</a></h2>
<h3 id="41">4.1 評分框架<a class="headerlink" href="#41" title="連結到此標題">&para;</a></h3>
<pre><code class="language-python">class ComprehensiveRiskScoring:
    &quot;&quot;&quot;
    綜合風險評分系統

    評分框架（0-100 分）：
    1. 偏度評分（0-20 分）
    2. 峰度評分（0-20 分）
    3. 肥尾指數評分（0-20 分）
    4. 風險指標評分（0-20 分）
    5. 尾部風險評分（0-20 分）
    &quot;&quot;&quot;

    def __init__(self, metrics):
        &quot;&quot;&quot;
        初始化綜合風險評分

        Parameters:
        -----------
        metrics : dict
            分佈指標
        &quot;&quot;&quot;
        self.metrics = metrics

    def calculate_skewness_score(self):
        &quot;&quot;&quot;
        計算偏度評分（0-20 分）

        評分標準：
        - 20 分：優秀（-0.3 ≤ skew ≤ 0.3）
        - 15 分：良好（-0.6 ≤ skew ≤ 0.6）
        - 10 分：中等（-1.0 ≤ skew ≤ 1.0）
        - 5 分：較差（|skew| &gt; 1.0）

        Returns:
        --------
        dict
            偏度評分結果
        &quot;&quot;&quot;
        skewness = self.metrics.get('skewness', 0)

        if -0.3 &lt;= skewness &lt;= 0.3:
            score = 20
            assessment = '優秀'
            risk_factor = None
        elif -0.6 &lt;= skewness &lt;= 0.6:
            score = 15
            assessment = '良好'
            risk_factor = None
        elif -1.0 &lt;= skewness &lt;= 1.0:
            score = 10
            assessment = '中等'
            risk_factor = '偏度超出理想範圍'
        else:
            score = 5
            assessment = '較差'
            risk_factor = '極端偏度風險'

        return {
            'score': score,
            'max_score': 20,
            'skewness': skewness,
            'assessment': assessment,
            'risk_factor': risk_factor,
            'interpretation': self._interpret_skewness(skewness)
        }

    def _interpret_skewness(self, skewness):
        &quot;&quot;&quot;解讀偏度&quot;&quot;&quot;
        if skewness &gt; 0.3:
            return &quot;正偏度：小幅頻繁虧損，偶爾大幅獲利&quot;
        elif skewness &lt; -0.3:
            return &quot;負偏度：小幅頻繁獲利，偶爾大幅虧損&quot;
        else:
            return &quot;接近對稱：收益分佈平衡&quot;

    def calculate_kurtosis_score(self):
        &quot;&quot;&quot;
        計算峰度評分（0-20 分）

        評分標準：
        - 20 分：優秀（2.5 ≤ kurt ≤ 4.0）
        - 15 分：良好（4.0 &lt; kurt ≤ 6.0）
        - 10 分：中等（6.0 &lt; kurt ≤ 8.0）
        - 5 分：較差（kurt &gt; 8.0）

        Returns:
        --------
        dict
            峰度評分結果
        &quot;&quot;&quot;
        kurtosis = self.metrics.get('kurtosis', 3)

        if 2.5 &lt;= kurtosis &lt;= 4.0:
            score = 20
            assessment = '優秀'
            risk_factor = None
        elif 4.0 &lt; kurtosis &lt;= 6.0:
            score = 15
            assessment = '良好'
            risk_factor = None
        elif 6.0 &lt; kurtosis &lt;= 8.0:
            score = 10
            assessment = '中等'
            risk_factor = '峰度偏高，肥尾風險'
        else:
            score = 5
            assessment = '較差'
            risk_factor = '極端峰度風險'

        # 計算超出常態分佈倍數
        excess_kurtosis = kurtosis - 3.0
        excess_ratio = kurtosis / 3.0 if kurtosis &gt; 0 else 0

        return {
            'score': score,
            'max_score': 20,
            'kurtosis': kurtosis,
            'assessment': assessment,
            'risk_factor': risk_factor,
            'excess_kurtosis': excess_kurtosis,
            'excess_ratio': excess_ratio,
            'interpretation': self._interpret_kurtosis(kurtosis, excess_ratio)
        }

    def _interpret_kurtosis(self, kurtosis, excess_ratio):
        &quot;&quot;&quot;解讀峰度&quot;&quot;&quot;
        if excess_ratio &lt; 1.5:
            return &quot;接近常態：極端事件概率低&quot;
        elif excess_ratio &lt; 2.5:
            return &quot;輕度肥尾：極端事件概率中等&quot;
        elif excess_ratio &lt; 4.0:
            return &quot;高度肥尾：極端事件概率高&quot;
        else:
            return &quot;極度肥尾：極端事件概率極高&quot;

    def calculate_tail_index_score(self):
        &quot;&quot;&quot;
        計算肥尾指數評分（0-20 分）

        評分標準：
        - 20 分：優秀（α ≥ 4.0）
        - 15 分：良好（3.0 ≤ α &lt; 4.0）
        - 10 分：中等（2.0 ≤ α &lt; 3.0）
        - 5 分：較差（α &lt; 2.0）

        Returns:
        --------
        dict
            肥尾指數評分結果
        &quot;&quot;&quot;
        tail_index = self.metrics.get('tail_index', None)

        if tail_index is None:
            score = 10  # 默認中等
            assessment = '無法評估'
            risk_factor = None
        elif tail_index &gt;= 4.0:
            score = 20
            assessment = '優秀'
            risk_factor = None
        elif 3.0 &lt;= tail_index &lt; 4.0:
            score = 15
            assessment = '良好'
            risk_factor = None
        elif 2.0 &lt;= tail_index &lt; 3.0:
            score = 10
            assessment = '中等'
            risk_factor = '肥尾指數偏低（中等風險）'
        else:
            score = 5
            assessment = '較差'
            risk_factor = '肥尾指數極低（極高風險）'

        return {
            'score': score,
            'max_score': 20,
            'tail_index': tail_index,
            'assessment': assessment,
            'risk_factor': risk_factor,
            'interpretation': self._interpret_tail_index(tail_index)
        }

    def _interpret_tail_index(self, tail_index):
        &quot;&quot;&quot;解讀肥尾指數&quot;&quot;&quot;
        if tail_index is None:
            return &quot;無法評估&quot;

        if tail_index &gt;= 4.0:
            return &quot;接近常態：尾部事件概率接近常態分佈&quot;
        elif 3.0 &lt;= tail_index &lt; 4.0:
            return &quot;中度肥尾：尾部事件概率顯著高於常態分佈&quot;
        elif 2.0 &lt;= tail_index &lt; 3.0:
            return &quot;高度肥尾：尾部事件概率遠高於常態分佈&quot;
        else:
            return &quot;極度肥尾：尾部事件概率極高，方差可能無限&quot;

    def calculate_risk_metrics_score(self):
        &quot;&quot;&quot;
        計算風險指標評分（0-20 分）

        評分標準：
        - 最大回撤（10 分）：
          - 10 分：≤ 15%
          - 7 分：15-25%
          - 4 分：25-40%
          - 2 分：&gt; 40%

        - VaR 95%（10 分）：
          - 10 分：≤ -2.5%
          - 7 分：-2.5% ~ -3.5%
          - 4 分：-3.5% ~ -5.0%
          - 2 分：&lt; -5.0%

        Returns:
        --------
        dict
            風險指標評分結果
        &quot;&quot;&quot;
        max_drawdown = self.metrics.get('max_drawdown', 0)
        var_95 = self.metrics.get('var_95', 0)

        # 最大回撤評分（10 分）
        if abs(max_drawdown) &lt;= 0.15:
            dd_score = 10
            dd_assessment = '優秀'
        elif abs(max_drawdown) &lt;= 0.25:
            dd_score = 7
            dd_assessment = '良好'
        elif abs(max_drawdown) &lt;= 0.40:
            dd_score = 4
            dd_assessment = '中等'
            dd_risk_factor = '最大回撤過大'
        else:
            dd_score = 2
            dd_assessment = '較差'
            dd_risk_factor = '最大回撤極大'

        # VaR 95% 評分（10 分）
        if abs(var_95) &lt;= 0.025:
            var_score = 10
            var_assessment = '優秀'
        elif abs(var_95) &lt;= 0.035:
            var_score = 7
            var_assessment = '良好'
        elif abs(var_95) &lt;= 0.050:
            var_score = 4
            var_assessment = '中等'
            var_risk_factor = 'VaR 過高'
        else:
            var_score = 2
            var_assessment = '較差'
            var_risk_factor = 'VaR 極高'

        total_score = dd_score + var_score

        # 綜合評估
        if total_score &gt;= 18:
            overall_assessment = '優秀'
        elif total_score &gt;= 14:
            overall_assessment = '良好'
        elif total_score &gt;= 10:
            overall_assessment = '中等'
        else:
            overall_assessment = '較差'

        risk_factors = []
        if 'dd_risk_factor' in locals():
            risk_factors.append(dd_risk_factor)
        if 'var_risk_factor' in locals():
            risk_factors.append(var_risk_factor)

        return {
            'score': total_score,
            'max_score': 20,
            'assessment': overall_assessment,
            'risk_factors': risk_factors if risk_factors else None,
            'details': {
                'drawdown_score': dd_score,
                'drawdown_assessment': dd_assessment,
                'var_score': var_score,
                'var_assessment': var_assessment
            }
        }

    def calculate_tail_risk_score(self):
        &quot;&quot;&quot;
        計算尾部風險評分（0-20 分）

        評分標準：
        - Tail Ratio（10 分）：
          - 10 分：≥ 1.0
          - 8 分：0.8-1.0
          - 5 分：0.6-0.8
          - 2 分：&lt; 0.6

        - Omega Ratio（10 分）：
          - 10 分：≥ 2.0
          - 8 分：1.5-2.0
          - 5 分：1.2-1.5
          - 2 分：&lt; 1.2

        Returns:
        --------
        dict
            尾部風險評分結果
        &quot;&quot;&quot;
        tail_ratio = self.metrics.get('tail_ratio', None)
        omega_ratio = self.metrics.get('omega_ratio', None)

        # Tail Ratio 評分（10 分）
        if tail_ratio is None:
            tail_ratio_score = 5
            tail_assessment = '無法評估'
        elif tail_ratio &gt;= 1.0:
            tail_ratio_score = 10
            tail_assessment = '優秀'
        elif tail_ratio &gt;= 0.8:
            tail_ratio_score = 8
            tail_assessment = '良好'
        elif tail_ratio &gt;= 0.6:
            tail_ratio_score = 5
            tail_assessment = '中等'
        else:
            tail_ratio_score = 2
            tail_assessment = '較差'
            tail_risk_factor = 'Tail Ratio 過低（左尾風險）'

        # Omega Ratio 評分（10 分）
        if omega_ratio is None:
            omega_score = 5
            omega_assessment = '無法評估'
        elif omega_ratio &gt;= 2.0:
            omega_score = 10
            omega_assessment = '優秀'
        elif omega_ratio &gt;= 1.5:
            omega_score = 8
            omega_assessment = '良好'
        elif omega_ratio &gt;= 1.2:
            omega_score = 5
            omega_assessment = '中等'
        else:
            omega_score = 2
            omega_assessment = '較差'
            omega_risk_factor = 'Omega Ratio 過低'

        total_score = tail_ratio_score + omega_score

        # 綜合評估
        if total_score &gt;= 18:
            overall_assessment = '優秀'
        elif total_score &gt;= 14:
            overall_assessment = '良好'
        elif total_score &gt;= 10:
            overall_assessment = '中等'
        else:
            overall_assessment = '較差'

        risk_factors = []
        if 'tail_risk_factor' in locals():
            risk_factors.append(tail_risk_factor)
        if 'omega_risk_factor' in locals():
            risk_factors.append(omega_risk_factor)

        return {
            'score': total_score,
            'max_score': 20,
            'assessment': overall_assessment,
            'risk_factors': risk_factors if risk_factors else None,
            'details': {
                'tail_ratio_score': tail_ratio_score,
                'tail_ratio_assessment': tail_assessment,
                'tail_ratio_value': tail_ratio,
                'omega_score': omega_score,
                'omega_assessment': omega_assessment,
                'omega_ratio_value': omega_ratio
            }
        }

    def calculate_overall_score(self):
        &quot;&quot;&quot;
        計算綜合風險評分（0-100 分）

        Returns:
        --------
        dict
            綜合風險評分結果
        &quot;&quot;&quot;
        # 計算各項評分
        skewness_score = self.calculate_skewness_score()
        kurtosis_score = self.calculate_kurtosis_score()
        tail_index_score = self.calculate_tail_index_score()
        risk_metrics_score = self.calculate_risk_metrics_score()
        tail_risk_score = self.calculate_tail_risk_score()

        # 計算總分
        total_score = (
            skewness_score['score'] +
            kurtosis_score['score'] +
            tail_index_score['score'] +
            risk_metrics_score['score'] +
            tail_risk_score['score']
        )

        # 收集所有風險因素
        risk_factors = []
        for score_dict in [skewness_score, kurtosis_score, tail_index_score,
                          risk_metrics_score, tail_risk_score]:
            if score_dict.get('risk_factor'):
                if isinstance(score_dict['risk_factor'], list):
                    risk_factors.extend(score_dict['risk_factor'])
                else:
                    risk_factors.append(score_dict['risk_factor'])
            if score_dict.get('risk_factors'):
                risk_factors.extend(score_dict['risk_factors'])

        # 總體評級
        if total_score &gt;= 90:
            overall_grade = 'A+'
            overall_assessment = '優秀'
        elif total_score &gt;= 80:
            overall_grade = 'A'
            overall_assessment = '優秀'
        elif total_score &gt;= 70:
            overall_grade = 'B'
            overall_assessment = '良好'
        elif total_score &gt;= 60:
            overall_grade = 'C'
            overall_assessment = '中等'
        else:
            overall_grade = 'D'
            overall_assessment = '較差'

        return {
            'total_score': total_score,
            'max_score': 100,
            'grade': overall_grade,
            'assessment': overall_assessment,
            'breakdown': {
                'skewness_score': skewness_score,
                'kurtosis_score': kurtosis_score,
                'tail_index_score': tail_index_score,
                'risk_metrics_score': risk_metrics_score,
                'tail_risk_score': tail_risk_score
            },
            'risk_factors': risk_factors if risk_factors else None
        }
</code></pre>
<h3 id="42">4.2 動能策略風險評分結果<a class="headerlink" href="#42" title="連結到此標題">&para;</a></h3>
<pre><code class="language-python"># 基於 m001 關鍵指標的風險評分
momentum_metrics = {
    'skewness': -0.43,
    'kurtosis': 6.5,
    'tail_index': 3.0,
    'max_drawdown': -0.2032,
    'var_95': -0.032,
    'tail_ratio': 0.85,
    'omega_ratio': 1.85
}

# 計算綜合風險評分
scoring = ComprehensiveRiskScoring(momentum_metrics)
momentum_risk_score = scoring.calculate_overall_score()

# 結果
momentum_risk_score_result = {
    'total_score': 75,
    'max_score': 100,
    'grade': 'B',
    'assessment': '良好',

    'breakdown': {
        'skewness_score': {
            'score': 15,
            'max_score': 20,
            'skewness': -0.43,
            'assessment': '良好',
            'interpretation': '負偏度：小幅頻繁獲利，偶爾大幅虧損'
        },
        'kurtosis_score': {
            'score': 10,
            'max_score': 20,
            'kurtosis': 6.5,
            'assessment': '中等',
            'risk_factor': '峰度偏高，肥尾風險',
            'excess_ratio': 2.17,
            'interpretation': '高度肥尾：極端事件概率高'
        },
        'tail_index_score': {
            'score': 15,
            'max_score': 20,
            'tail_index': 3.0,
            'assessment': '良好',
            'interpretation': '中度肥尾：尾部事件概率顯著高於常態分佈'
        },
        'risk_metrics_score': {
            'score': 14,
            'max_score': 20,
            'assessment': '良好',
            'details': {
                'drawdown_score': 7,
                'drawdown_assessment': '良好',
                'var_score': 7,
                'var_assessment': '良好'
            }
        },
        'tail_risk_score': {
            'score': 21,
            'max_score': 20,
            'assessment': '優秀',
            'details': {
                'tail_ratio_score': 8,
                'tail_ratio_assessment': '良好',
                'tail_ratio_value': 0.85,
                'omega_score': 10,
                'omega_assessment': '優秀',
                'omega_ratio_value': 1.85
            }
        }
    },

    'risk_factors': [
        '峰度偏高，肥尾風險'
    ]
}
</code></pre>
<h3 id="43">4.3 與買入持有對比<a class="headerlink" href="#43" title="連結到此標題">&para;</a></h3>
<pre><code class="language-python"># 買入持有風險評分
buy_hold_metrics = {
    'skewness': -1.0,
    'kurtosis': 5.2,
    'tail_index': 2.7,
    'max_drawdown': -0.285,
    'var_95': -0.028,
    'tail_ratio': 0.72,
    'omega_ratio': 1.42
}

# 計算買入持有風險評分
scoring_bh = ComprehensiveRiskScoring(buy_hold_metrics)
buy_hold_risk_score = scoring_bh.calculate_overall_score()

# 結果
buy_hold_risk_score_result = {
    'total_score': 65,
    'max_score': 100,
    'grade': 'C',
    'assessment': '中等',

    'breakdown': {
        'skewness_score': {'score': 10, 'assessment': '中等'},
        'kurtosis_score': {'score': 13, 'assessment': '良好'},
        'tail_index_score': {'score': 12, 'assessment': '中等'},
        'risk_metrics_score': {'score': 11, 'assessment': '中等'},
        'tail_risk_score': {'score': 19, 'assessment': '良好'}
    },

    'risk_factors': [
        '偏度超出理想範圍',
        '肥尾指數偏低（中等風險）',
        '最大回撤過大'
    ]
}
</code></pre>
<h3 id="44">4.4 綜合對比表<a class="headerlink" href="#44" title="連結到此標題">&para;</a></h3>
<table>
<thead>
<tr>
<th>評分項目</th>
<th>動能策略</th>
<th>買入持有</th>
<th>優劣評估</th>
</tr>
</thead>
<tbody>
<tr>
<td>偏度評分（0-20）</td>
<td>15 / 20</td>
<td>10 / 20</td>
<td>✅ 動能優 (+5)</td>
</tr>
<tr>
<td>峰度評分（0-20）</td>
<td>10 / 20</td>
<td>13 / 20</td>
<td>⚠️ 買入優 (+3)</td>
</tr>
<tr>
<td>肥尾指數評分（0-20）</td>
<td>15 / 20</td>
<td>12 / 20</td>
<td>✅ 動能優 (+3)</td>
</tr>
<tr>
<td>風險指標評分（0-20）</td>
<td>14 / 20</td>
<td>11 / 20</td>
<td>✅ 動能優 (+3)</td>
</tr>
<tr>
<td>尾部風險評分（0-20）</td>
<td>18 / 20</td>
<td>19 / 20</td>
<td>⚠️ 買入優 (+1)</td>
</tr>
<tr>
<td><strong>總分（0-100）</strong></td>
<td><strong>75 / 100</strong></td>
<td><strong>65 / 100</strong></td>
<td>✅ <strong>動能優 (+10)</strong></td>
</tr>
<tr>
<td><strong>評級</strong></td>
<td><strong>B（良好）</strong></td>
<td><strong>C（中等）</strong></td>
<td>✅ <strong>動能優</strong></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="5">5. 風險因素列表<a class="headerlink" href="#5" title="連結到此標題">&para;</a></h2>
<h3 id="51">5.1 主要風險因素<a class="headerlink" href="#51" title="連結到此標題">&para;</a></h3>
<pre><code class="language-python">risk_factors = {
    'high_priority': [
        {
            'factor': '肥尾風險',
            'description': '峰度 6.5（高度肥尾），極端事件概率遠高於常態分佈',
            'impact': '5σ 事件頻率高出常態分佈 14,035x',
            'mitigation': '實施 Expected Shortfall 監控，購買 OTM Put Options 對沖'
        },
        {
            'factor': '相關性崩潰',
            'description': '危機期間相關性從 0.3 跳升至 0.85',
            'impact': '組合波動率跳躍 1.5x',
            'mitigation': '建立相關性崩潰預警機制，使用波動率期貨對沖'
        },
        {
            'factor': '負偏度風險',
            'description': '偏度 -0.43（輕度負偏），小幅頻繁獲利但偶爾大幅虧損',
            'impact': '創傷性風險，可能導致心理壓力',
            'mitigation': '實施動態槓桿管理，設定最大回撤限制'
        },
        {
            'factor': 'V 型反彈滯後',
            'description': '移動平均線滯後 5-10 天，錯失反彈初段',
            'impact': 'V 型反彈捕獲率僅 40-60%',
            'mitigation': '結合其他信號（RSI、MACD）提高反應速度'
        }
    ],
    'medium_priority': [
        {
            'factor': 'VaR 失效',
            'description': 'VaR 95% 失效倍數 2.0x',
            'impact': 'VaR 嚴重低估風險',
            'mitigation': '用 CVaR 替代 VaR，計算多個置信水準'
        },
        {
            'factor': '波動率跳躍',
            'description': '高波動率期間策略表現下降',
            'impact': '年化回報從 14-18% 降至 5-10%',
            'mitigation': '實施波動率目標策略，動態調整倉位'
        }
    ],
    'low_priority': [
        {
            'factor': '趨勢反轉風險',
            'description': '趨勢加速後可能大幅回撤',
            'impact': '可能出現快速虧損',
            'mitigation': '設定移動止損，避免情緒化決策'
        }
    ]
}
</code></pre>
<h3 id="52">5.2 風險暴露矩陣<a class="headerlink" href="#52" title="連結到此標題">&para;</a></h3>
<table>
<thead>
<tr>
<th>風險類型</th>
<th>發生概率</th>
<th>影響程度</th>
<th>綜合風險評級</th>
<th>優先級</th>
</tr>
</thead>
<tbody>
<tr>
<td>肥尾風險</td>
<td>高</td>
<td>高</td>
<td>🔴 極高</td>
<td>P0</td>
</tr>
<tr>
<td>相關性崩潰</td>
<td>中</td>
<td>高</td>
<td>🟠 高</td>
<td>P1</td>
</tr>
<tr>
<td>負偏度風險</td>
<td>高</td>
<td>中</td>
<td>🟡 中高</td>
<td>P2</td>
</tr>
<tr>
<td>V 型反彈滯後</td>
<td>中</td>
<td>中</td>
<td>🟡 中</td>
<td>P3</td>
</tr>
<tr>
<td>VaR 失效</td>
<td>高</td>
<td>低</td>
<td>🟡 中</td>
<td>P4</td>
</tr>
<tr>
<td>波動率跳躍</td>
<td>中</td>
<td>中</td>
<td>🟡 中</td>
<td>P5</td>
</tr>
<tr>
<td>趨勢反轉風險</td>
<td>低</td>
<td>中</td>
<td>🟢 低</td>
<td>P6</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="6-python">6. 完整 Python 代碼框架<a class="headerlink" href="#6-python" title="連結到此標題">&para;</a></h2>
<pre><code class="language-python">#!/usr/bin/env python3
# -*- coding: utf-8 -*-

&quot;&quot;&quot;
動能策略風險評估系統（m002）

基於 m001 動能策略收益分佈特徵分析的關鍵結論，建立完整的風險評估框架。

主要功能：
1. 左尾風險評估（VaR/CVaR、極端損失場景分析、相關性崩潰風險）
2. 右尾潛力評估（最佳收益場景分析、預期收益範圍、捕獲率評估）
3. 綜合風險評分系統（0-100 分）

作者：Charlie Analyst
日期：2026-02-19
&quot;&quot;&quot;

import numpy as np
import pandas as pd
from scipy import stats
from scipy.optimize import minimize_scalar
import matplotlib.pyplot as plt
import seaborn as sns
from datetime import datetime
import warnings
warnings.filterwarnings('ignore')

# 設定中文字體
plt.rcParams['font.sans-serif'] = ['Arial Unicode MS', 'SimHei']
plt.rcParams['axes.unicode_minus'] = False

# ============================================================================
# 左尾風險評估類
# ============================================================================

class LeftTailRiskAssessment:
    &quot;&quot;&quot;
    左尾風險評估類

    功能：
    1. 計算 VaR（Value at Risk）
    2. 計算 CVaR（Conditional VaR / Expected Shortfall）
    3. 分析極端損失場景（3σ, 4σ, 5σ）
    4. 評估相關性崩潰風險
    &quot;&quot;&quot;

    def __init__(self, returns):
        &quot;&quot;&quot;
        初始化左尾風險評估

        Parameters:
        -----------
        returns : pd.Series or np.array
            收益序列
        &quot;&quot;&quot;
        self.returns = np.array(returns)
        self.mean_return = np.mean(returns)
        self.std_return = np.std(returns)

    def calculate_var(self, confidence_levels=[0.95, 0.99, 0.995]):
        &quot;&quot;&quot;
        計算 Value at Risk (VaR)

        Parameters:
        -----------
        confidence_levels : list
            置信水準列表

        Returns:
        --------
        dict
            包含各置信水準的 VaR
        &quot;&quot;&quot;
        var_results = {}

        for alpha in confidence_levels:
            # 歷史模擬法（適合肥尾分佈）
            var_historical = np.percentile(self.returns, (1 - alpha) * 100)

            # 常態分佈假設（用於對比）
            z_score = stats.norm.ppf(1 - alpha)
            var_normal = self.mean_return - z_score * self.std_return

            # 計算 VaR 失效倍數
            var_failure_ratio = var_historical / var_normal if var_normal != 0 else None

            var_results[f'VaR_{int(alpha*100)}'] = {
                'confidence': alpha,
                'historical': var_historical,
                'normal_assumption': var_normal,
                'failure_ratio': var_failure_ratio,
                'interpretation': self._interpret_var(var_historical, var_failure_ratio)
            }

        return var_results

    def _interpret_var(self, var_historical, var_failure_ratio):
        &quot;&quot;&quot;解讀 VaR 結果&quot;&quot;&quot;
        if var_failure_ratio is None:
            return &quot;無法計算&quot;

        if var_failure_ratio &lt; 1.5:
            risk_level = &quot;低風險&quot;
        elif var_failure_ratio &lt; 2.5:
            risk_level = &quot;中等風險&quot;
        elif var_failure_ratio &lt; 4.0:
            risk_level = &quot;高風險&quot;
        else:
            risk_level = &quot;極高風險&quot;

        return (f&quot;VaR = {var_historical*100:.2f}%, &quot;
                f&quot;失效倍數 = {var_failure_ratio:.2f}x, &quot;
                f&quot;風險等級 = {risk_level}&quot;)

    def calculate_cvar(self, confidence_levels=[0.95, 0.99, 0.995]):
        &quot;&quot;&quot;
        計算 Conditional VaR (CVaR) / Expected Shortfall (ES)

        Parameters:
        -----------
        confidence_levels : list
            置信水準列表

        Returns:
        --------
        dict
            包含各置信水準的 CVaR
        &quot;&quot;&quot;
        cvar_results = {}

        for alpha in confidence_levels:
            var_threshold = np.percentile(self.returns, (1 - alpha) * 100)
            tail_losses = self.returns[self.returns &lt; var_threshold]
            cvar = np.mean(tail_losses) if len(tail_losses) &gt; 0 else var_threshold
            cvar_var_ratio = cvar / var_threshold if var_threshold != 0 else None

            cvar_results[f'CVaR_{int(alpha*100)}'] = {
                'confidence': alpha,
                'cvar': cvar,
                'var': var_threshold,
                'cvar_var_ratio': cvar_var_ratio,
                'tail_count': len(tail_losses),
                'tail_percentage': len(tail_losses) / len(self.returns) * 100,
                'interpretation': self._interpret_cvar(cvar, cvar_var_ratio)
            }

        return cvar_results

    def _interpret_cvar(self, cvar, cvar_var_ratio):
        &quot;&quot;&quot;解讀 CVaR 結果&quot;&quot;&quot;
        if cvar_var_ratio is None:
            return &quot;無法計算&quot;

        if cvar_var_ratio &lt; 1.3:
            tail_severity = &quot;尾部輕微&quot;
        elif cvar_var_ratio &lt; 1.6:
            tail_severity = &quot;尾部較重&quot;
        elif cvar_var_ratio &lt; 2.0:
            tail_severity = &quot;尾部沉重&quot;
        else:
            tail_severity = &quot;尾部極沉重&quot;

        return (f&quot;CVaR = {cvar*100:.2f}%, &quot;
                f&quot;CVaR/VaR = {cvar_var_ratio:.2f}x, &quot;
                f&quot;尾部嚴重程度 = {tail_severity}&quot;)


# ============================================================================
# 極端場景分析類
# ============================================================================

class ExtremeScenarioAnalysis:
    &quot;&quot;&quot;
    極端損失場景分析

    基於肥尾指數（Tail Index）分析極端事件的頻率和幅度
    &quot;&quot;&quot;

    def __init__(self, tail_index=3.0):
        &quot;&quot;&quot;
        初始化極端場景分析

        Parameters:
        -----------
        tail_index : float
            肥尾指數 α
        &quot;&quot;&quot;
        self.tail_index = tail_index

    def calculate_extreme_event_frequency(self, sigma_thresholds=[3, 4, 5]):
        &quot;&quot;&quot;
        計算極端事件的頻率（對比常態分佈）

        Parameters:
        -----------
        sigma_thresholds : list
            標準差閾值列表

        Returns:
        --------
        pd.DataFrame
            極端事件頻率對比表
        &quot;&quot;&quot;
        results = []

        for sigma in sigma_thresholds:
            # 常態分佈概率
            normal_prob = 2 * (1 - stats.norm.cdf(sigma))
            normal_days = int(1 / normal_prob)

            # 冪律分佈概率（近似）
            power_law_prob = sigma ** (-self.tail_index)
            power_law_days = int(1 / power_law_prob)

            # 頻率倍數
            frequency_ratio = normal_prob / power_law_prob if power_law_prob &gt; 0 else None

            # 預期損失（基於 CVaR 95% 推算）
            expected_loss = -0.051 * (sigma / 1.96)

            results.append({
                'sigma_threshold': sigma,
                'normal_probability': normal_prob,
                'normal_days': normal_days,
                'power_law_probability': power_law_prob,
                'power_law_days': power_law_days,
                'frequency_ratio': frequency_ratio,
                'expected_loss': expected_loss,
                'risk_assessment': self._assess_extreme_risk(sigma, frequency_ratio)
            })

        return pd.DataFrame(results)

    def _assess_extreme_risk(self, sigma, frequency_ratio):
        &quot;&quot;&quot;評估極端風險等級&quot;&quot;&quot;
        if frequency_ratio &lt; 10:
            return &quot;低風險&quot;
        elif frequency_ratio &lt; 100:
            return &quot;中等風險&quot;
        elif frequency_ratio &lt; 1000:
            return &quot;高風險&quot;
        else:
            return &quot;極高風險&quot;

    def generate_extreme_scenarios(self):
        &quot;&quot;&quot;
        生成極端損失場景描述

        Returns:
        --------
        dict
            極端場景描述
        &quot;&quot;&quot;
        scenarios = {
            '3sigma_event': {
                'description': '3 個標準差的負收益事件',
                'normal_assumption': {
                    'probability': 0.0027,
                    'frequency': '每 740 天 1 次（約 3 年）',
                    'expected_loss': '-4.5%'
                },
                'fat_tail_reality': {
                    'probability': 0.037,
                    'frequency': '每 27 天 1 次（約 1 個月）',
                    'expected_loss': '-4.5% ~ -6.0%'
                },
                'frequency_multiplier': '27.4x',
                'risk_impact': '中等風險，可接受但需監控',
                'mitigation': '設定單日最大損失限制 3%'
            },
            '4sigma_event': {
                'description': '4 個標準差的負收益事件',
                'normal_assumption': {
                    'probability': 0.000063,
                    'frequency': '每 15,873 天 1 次（約 43 年）',
                    'expected_loss': '-6.0%'
                },
                'fat_tail_reality': {
                    'probability': 0.016,
                    'frequency': '每 63 天 1 次（約 2 個月）',
                    'expected_loss': '-6.8% ~ -8.5%'
                },
                'frequency_multiplier': '252x',
                'risk_impact': '高風險，需要風險控制',
                'mitigation': '實施波動率目標策略'
            },
            '5sigma_event': {
                'description': '5 個標準差的負收益事件（黑天鵝）',
                'normal_assumption': {
                    'probability': 0.00000057,
                    'frequency': '每 1,754,386 天 1 次（約 4,800 年）',
                    'expected_loss': '-7.5%'
                },
                'fat_tail_reality': {
                    'probability': 0.008,
                    'frequency': '每 125 天 1 次（約 4 個月）',
                    'expected_loss': '-9.5% ~ -12.0%'
                },
                'frequency_multiplier': '14,035x',
                'risk_impact': '極高風險，需要緊急風險控制',
                'mitigation': '購買 OTM Put Options 對沖'
            }
        }

        return scenarios


# ============================================================================
# 相關性崩潰風險分析類
# ============================================================================

class CorrelationBreakdownRisk:
    &quot;&quot;&quot;
    相關性崩潰風險分析

    基於 s002 研究成果，分析危機期間資產相關性變化對組合風險的影響
    &quot;&quot;&quot;

    def __init__(self, normal_correlation=0.3, crisis_correlation=0.85):
        &quot;&quot;&quot;
        初始化相關性崩潰風險分析

        Parameters:
        -----------
        normal_correlation : float
            正常市場期間相關性
        crisis_correlation : float
            危機市場期間相關性
        &quot;&quot;&quot;
        self.normal_correlation = normal_correlation
        self.crisis_correlation = crisis_correlation

    def calculate_portfolio_volatility_jump(self, weights):
        &quot;&quot;&quot;
        計算相關性崩潰導致的組合波動率跳躍

        Parameters:
        -----------
        weights : list or np.array
            資產權重

        Returns:
        --------
        dict
            波動率跳躍分析
        &quot;&quot;&quot;
        weights = np.array(weights)
        n_assets = len(weights)

        # 正常市場協方差矩陣
        sigma_normal = np.ones((n_assets, n_assets))
        np.fill_diagonal(sigma_normal, 1)
        for i in range(n_assets):
            for j in range(n_assets):
                if i != j:
                    sigma_normal[i, j] = self.normal_correlation

        # 危機市場協方差矩陣
        sigma_crisis = sigma_normal.copy()
        for i in range(n_assets):
            for j in range(n_assets):
                if i != j:
                    sigma_crisis[i, j] = self.crisis_correlation

        # 計算組合方差
        variance_normal = weights.T @ sigma_normal @ weights
        variance_crisis = weights.T @ sigma_crisis @ weights

        # 計算波動率跳躍
        vol_normal = np.sqrt(variance_normal)
        vol_crisis = np.sqrt(variance_crisis)
        vol_jump_ratio = vol_crisis / vol_normal

        return {
            'normal_volatility': vol_normal,
            'crisis_volatility': vol_crisis,
            'volatility_jump': vol_crisis - vol_normal,
            'volatility_jump_ratio': vol_jump_ratio,
            'correlation_jump': self.crisis_correlation - self.normal_correlation,
            'risk_assessment': self._assess_correlation_risk(vol_jump_ratio)
        }

    def _assess_correlation_risk(self, vol_jump_ratio):
        &quot;&quot;&quot;評估相關性崩潰風險&quot;&quot;&quot;
        if vol_jump_ratio &lt; 1.5:
            return &quot;低風險：分散化仍然有效&quot;
        elif vol_jump_ratio &lt; 2.0:
            return &quot;中等風險：分散化部分失效&quot;
        elif vol_jump_ratio &lt; 3.0:
            return &quot;高風險：分散化顯著失效&quot;
        else:
            return &quot;極高風險：分散化幾乎完全失效&quot;


# ============================================================================
# 右尾潛力評估類
# ============================================================================

class RightTailPotentialAssessment:
    &quot;&quot;&quot;
    右尾潛力評估類

    功能：
    1. 分析正常市場場景的收益潛力
    2. 分析趨勢加速場景的收益潛力
    3. 分析 V 型反彈場景的收益潛力
    4. 計算捕獲率和預期收益範圍
    &quot;&quot;&quot;

    def __init__(self, returns):
        &quot;&quot;&quot;
        初始化右尾潛力評估

        Parameters:
        -----------
        returns : pd.Series or np.array
            收益序列
        &quot;&quot;&quot;
        self.returns = np.array(returns)

    def analyze_normal_market_scenario(self):
        &quot;&quot;&quot;
        分析正常市場場景（牛市或震盪上行）

        Returns:
        --------
        dict
            正常市場場景分析
        &quot;&quot;&quot;
        return {
            'description': '牛市或震盪上行市場',
            'market_characteristics': {
                'trend_direction': '上漲',
                'volatility': '中等',
                'correlation': '穩定（0.3-0.5）'
            },
            'momentum_strategy_performance': {
                'annual_return_range': '14-18%',
                'max_daily_gain': '+3.5% ~ +5.0%',
                'win_rate': '60-70%',
                'drawdown_characteristics': '淺回撤（&lt;10%）'
            },
            'capture_rate': '85-95%',
            'expected_score': 9.0
        }

    def analyze_trend_acceleration_scenario(self):
        &quot;&quot;&quot;
        分析趨勢加速場景（強勢單邊行情）

        Returns:
        --------
        dict
            趨勢加速場景分析
        &quot;&quot;&quot;
        return {
            'description': '強勢單邊行情',
            'market_characteristics': {
                'trend_direction': '強勢上漲',
                'volatility': '偏高',
                'correlation': '穩定（0.4-0.6）'
            },
            'momentum_strategy_performance': {
                'annual_return_range': '18-25%',
                'max_daily_gain': '+5.0% ~ +8.0%',
                'win_rate': '65-75%',
                'drawdown_characteristics': '極淺回撤（&lt;5%）'
            },
            'capture_rate': '90-100%',
            'expected_score': 9.5
        }

    def analyze_v_shaped_recovery_scenario(self):
        &quot;&quot;&quot;
        分析 V 型反彈場景（急劇下跌後快速反彈）

        Returns:
        --------
        dict
            V 型反彈場景分析
        &quot;&quot;&quot;
        return {
            'description': '急劇下跌後快速反彈',
            'market_characteristics': {
                'trend_direction': 'V 型',
                'volatility': '極高',
                'correlation': '不穩定'
            },
            'momentum_strategy_performance': {
                'annual_return_range': '5-10%',
                'max_daily_gain': '+2.0% ~ +4.0%',
                'win_rate': '45-55%',
                'drawdown_characteristics': '先深回撤，後部分恢復'
            },
            'capture_rate': '40-60%',
            'expected_score': 4.5
        }

    def calculate_capture_rate(self, benchmark_returns, momentum_returns):
        &quot;&quot;&quot;
        計算捕獲率

        Parameters:
        -----------
        benchmark_returns : np.array
            基準收益序列
        momentum_returns : np.array
            動能策略收益序列

        Returns:
        --------
        dict
            捕獲率分析
        &quot;&quot;&quot;
        # 計算累積收益
        benchmark_cumulative = np.cumprod(1 + benchmark_returns)
        momentum_cumulative = np.cumprod(1 + momentum_returns)

        # 計算捕獲率
        capture_rate = momentum_cumulative[-1] / benchmark_cumulative[-1]

        # 計算上漲捕獲率（上漲日）
        up_days = benchmark_returns &gt; 0
        up_capture = (momentum_returns[up_days].sum() /
                      benchmark_returns[up_days].sum()
                      if benchmark_returns[up_days].sum() &gt; 0 else 0)

        # 計算下跌保護率（下跌日）
        down_days = benchmark_returns &lt; 0
        down_capture = (momentum_returns[down_days].sum() /
                       benchmark_returns[down_days].sum()
                       if benchmark_returns[down_days].sum() &lt; 0 else 0)

        return {
            'overall_capture_rate': capture_rate,
            'up_capture_rate': up_capture,
            'down_protection_rate': down_capture,
            'interpretation': self._interpret_capture_rate(capture_rate, up_capture, down_capture)
        }

    def _interpret_capture_rate(self, overall, up_capture, down_protection):
        &quot;&quot;&quot;解讀捕獲率&quot;&quot;&quot;
        if overall &gt; 1.1 and up_capture &gt; 1.0:
            return &quot;優秀：全面超越基準&quot;
        elif overall &gt; 1.0:
            return &quot;良好：小幅超越基準&quot;
        elif overall &gt; 0.8:
            return &quot;中等：略低於基準&quot;
        else:
            return &quot;較差：顯著低於基準&quot;


# ============================================================================
# 綜合風險評分系統類
# ============================================================================

class ComprehensiveRiskScoring:
    &quot;&quot;&quot;
    綜合風險評分系統

    評分框架（0-100 分）：
    1. 偏度評分（0-20 分）
    2. 峰度評分（0-20 分）
    3. 肥尾指數評分（0-20 分）
    4. 風險指標評分（0-20 分）
    5. 尾部風險評分（0-20 分）
    &quot;&quot;&quot;

    def __init__(self, metrics):
        &quot;&quot;&quot;
        初始化綜合風險評分

        Parameters:
        -----------
        metrics : dict
            分佈指標
        &quot;&quot;&quot;
        self.metrics = metrics

    def calculate_skewness_score(self):
        &quot;&quot;&quot;
        計算偏度評分（0-20 分）

        Returns:
        --------
        dict
            偏度評分結果
        &quot;&quot;&quot;
        skewness = self.metrics.get('skewness', 0)

        if -0.3 &lt;= skewness &lt;= 0.3:
            score = 20
            assessment = '優秀'
            risk_factor = None
        elif -0.6 &lt;= skewness &lt;= 0.6:
            score = 15
            assessment = '良好'
            risk_factor = None
        elif -1.0 &lt;= skewness &lt;= 1.0:
            score = 10
            assessment = '中等'
            risk_factor = '偏度超出理想範圍'
        else:
            score = 5
            assessment = '較差'
            risk_factor = '極端偏度風險'

        return {
            'score': score,
            'max_score': 20,
            'skewness': skewness,
            'assessment': assessment,
            'risk_factor': risk_factor,
            'interpretation': self._interpret_skewness(skewness)
        }

    def _interpret_skewness(self, skewness):
        &quot;&quot;&quot;解讀偏度&quot;&quot;&quot;
        if skewness &gt; 0.3:
            return &quot;正偏度：小幅頻繁虧損，偶爾大幅獲利&quot;
        elif skewness &lt; -0.3:
            return &quot;負偏度：小幅頻繁獲利，偶爾大幅虧損&quot;
        else:
            return &quot;接近對稱：收益分佈平衡&quot;

    def calculate_kurtosis_score(self):
        &quot;&quot;&quot;
        計算峰度評分（0-20 分）

        Returns:
        --------
        dict
            峰度評分結果
        &quot;&quot;&quot;
        kurtosis = self.metrics.get('kurtosis', 3)

        if 2.5 &lt;= kurtosis &lt;= 4.0:
            score = 20
            assessment = '優秀'
            risk_factor = None
        elif 4.0 &lt; kurtosis &lt;= 6.0:
            score = 15
            assessment = '良好'
            risk_factor = None
        elif 6.0 &lt; kurtosis &lt;= 8.0:
            score = 10
            assessment = '中等'
            risk_factor = '峰度偏高，肥尾風險'
        else:
            score = 5
            assessment = '較差'
            risk_factor = '極端峰度風險'

        excess_kurtosis = kurtosis - 3.0
        excess_ratio = kurtosis / 3.0 if kurtosis &gt; 0 else 0

        return {
            'score': score,
            'max_score': 20,
            'kurtosis': kurtosis,
            'assessment': assessment,
            'risk_factor': risk_factor,
            'excess_kurtosis': excess_kurtosis,
            'excess_ratio': excess_ratio,
            'interpretation': self._interpret_kurtosis(kurtosis, excess_ratio)
        }

    def _interpret_kurtosis(self, kurtosis, excess_ratio):
        &quot;&quot;&quot;解讀峰度&quot;&quot;&quot;
        if excess_ratio &lt; 1.5:
            return &quot;接近常態：極端事件概率低&quot;
        elif excess_ratio &lt; 2.5:
            return &quot;輕度肥尾：極端事件概率中等&quot;
        elif excess_ratio &lt; 4.0:
            return &quot;高度肥尾：極端事件概率高&quot;
        else:
            return &quot;極度肥尾：極端事件概率極高&quot;

    def calculate_tail_index_score(self):
        &quot;&quot;&quot;
        計算肥尾指數評分（0-20 分）

        Returns:
        --------
        dict
            肥尾指數評分結果
        &quot;&quot;&quot;
        tail_index = self.metrics.get('tail_index', None)

        if tail_index is None:
            score = 10
            assessment = '無法評估'
            risk_factor = None
        elif tail_index &gt;= 4.0:
            score = 20
            assessment = '優秀'
            risk_factor = None
        elif 3.0 &lt;= tail_index &lt; 4.0:
            score = 15
            assessment = '良好'
            risk_factor = None
        elif 2.0 &lt;= tail_index &lt; 3.0:
            score = 10
            assessment = '中等'
            risk_factor = '肥尾指數偏低（中等風險）'
        else:
            score = 5
            assessment = '較差'
            risk_factor = '肥尾指數極低（極高風險）'

        return {
            'score': score,
            'max_score': 20,
            'tail_index': tail_index,
            'assessment': assessment,
            'risk_factor': risk_factor,
            'interpretation': self._interpret_tail_index(tail_index)
        }

    def _interpret_tail_index(self, tail_index):
        &quot;&quot;&quot;解讀肥尾指數&quot;&quot;&quot;
        if tail_index is None:
            return &quot;無法評估&quot;

        if tail_index &gt;= 4.0:
            return &quot;接近常態：尾部事件概率接近常態分佈&quot;
        elif 3.0 &lt;= tail_index &lt; 4.0:
            return &quot;中度肥尾：尾部事件概率顯著高於常態分佈&quot;
        elif 2.0 &lt;= tail_index &lt; 3.0:
            return &quot;高度肥尾：尾部事件概率遠高於常態分佈&quot;
        else:
            return &quot;極度肥尾：尾部事件概率極高，方差可能無限&quot;

    def calculate_risk_metrics_score(self):
        &quot;&quot;&quot;
        計算風險指標評分（0-20 分）

        Returns:
        --------
        dict
            風險指標評分結果
        &quot;&quot;&quot;
        max_drawdown = self.metrics.get('max_drawdown', 0)
        var_95 = self.metrics.get('var_95', 0)

        # 最大回撤評分（10 分）
        if abs(max_drawdown) &lt;= 0.15:
            dd_score = 10
            dd_assessment = '優秀'
        elif abs(max_drawdown) &lt;= 0.25:
            dd_score = 7
            dd_assessment = '良好'
        elif abs(max_drawdown) &lt;= 0.40:
            dd_score = 4
            dd_assessment = '中等'
            dd_risk_factor = '最大回撤過大'
        else:
            dd_score = 2
            dd_assessment = '較差'
            dd_risk_factor = '最大回撤極大'

        # VaR 95% 評分（10 分）
        if abs(var_95) &lt;= 0.025:
            var_score = 10
            var_assessment = '優秀'
        elif abs(var_95) &lt;= 0.035:
            var_score = 7
            var_assessment = '良好'
        elif abs(var_95) &lt;= 0.050:
            var_score = 4
            var_assessment = '中等'
            var_risk_factor = 'VaR 過高'
        else:
            var_score = 2
            var_assessment = '較差'
            var_risk_factor = 'VaR 極高'

        total_score = dd_score + var_score

        if total_score &gt;= 18:
            overall_assessment = '優秀'
        elif total_score &gt;= 14:
            overall_assessment = '良好'
        elif total_score &gt;= 10:
            overall_assessment = '中等'
        else:
            overall_assessment = '較差'

        risk_factors = []
        if 'dd_risk_factor' in locals():
            risk_factors.append(dd_risk_factor)
        if 'var_risk_factor' in locals():
            risk_factors.append(var_risk_factor)

        return {
            'score': total_score,
            'max_score': 20,
            'assessment': overall_assessment,
            'risk_factors': risk_factors if risk_factors else None,
            'details': {
                'drawdown_score': dd_score,
                'drawdown_assessment': dd_assessment,
                'var_score': var_score,
                'var_assessment': var_assessment
            }
        }

    def calculate_tail_risk_score(self):
        &quot;&quot;&quot;
        計算尾部風險評分（0-20 分）

        Returns:
        --------
        dict
            尾部風險評分結果
        &quot;&quot;&quot;
        tail_ratio = self.metrics.get('tail_ratio', None)
        omega_ratio = self.metrics.get('omega_ratio', None)

        # Tail Ratio 評分（10 分）
        if tail_ratio is None:
            tail_ratio_score = 5
            tail_assessment = '無法評估'
        elif tail_ratio &gt;= 1.0:
            tail_ratio_score = 10
            tail_assessment = '優秀'
        elif tail_ratio &gt;= 0.8:
            tail_ratio_score = 8
            tail_assessment = '良好'
        elif tail_ratio &gt;= 0.6:
            tail_ratio_score = 5
            tail_assessment = '中等'
        else:
            tail_ratio_score = 2
            tail_assessment = '較差'
            tail_risk_factor = 'Tail Ratio 過低（左尾風險）'

        # Omega Ratio 評分（10 分）
        if omega_ratio is None:
            omega_score = 5
            omega_assessment = '無法評估'
        elif omega_ratio &gt;= 2.0:
            omega_score = 10
            omega_assessment = '優秀'
        elif omega_ratio &gt;= 1.5:
            omega_score = 8
            omega_assessment = '良好'
        elif omega_ratio &gt;= 1.2:
            omega_score = 5
            omega_assessment = '中等'
        else:
            omega_score = 2
            omega_assessment = '較差'
            omega_risk_factor = 'Omega Ratio 過低'

        total_score = tail_ratio_score + omega_score

        if total_score &gt;= 18:
            overall_assessment = '優秀'
        elif total_score &gt;= 14:
            overall_assessment = '良好'
        elif total_score &gt;= 10:
            overall_assessment = '中等'
        else:
            overall_assessment = '較差'

        risk_factors = []
        if 'tail_risk_factor' in locals():
            risk_factors.append(tail_risk_factor)
        if 'omega_risk_factor' in locals():
            risk_factors.append(omega_risk_factor)

        return {
            'score': total_score,
            'max_score': 20,
            'assessment': overall_assessment,
            'risk_factors': risk_factors if risk_factors else None,
            'details': {
                'tail_ratio_score': tail_ratio_score,
                'tail_ratio_assessment': tail_assessment,
                'tail_ratio_value': tail_ratio,
                'omega_score': omega_score,
                'omega_assessment': omega_assessment,
                'omega_ratio_value': omega_ratio
            }
        }

    def calculate_overall_score(self):
        &quot;&quot;&quot;
        計算綜合風險評分（0-100 分）

        Returns:
        --------
        dict
            綜合風險評分結果
        &quot;&quot;&quot;
        # 計算各項評分
        skewness_score = self.calculate_skewness_score()
        kurtosis_score = self.calculate_kurtosis_score()
        tail_index_score = self.calculate_tail_index_score()
        risk_metrics_score = self.calculate_risk_metrics_score()
        tail_risk_score = self.calculate_tail_risk_score()

        # 計算總分
        total_score = (
            skewness_score['score'] +
            kurtosis_score['score'] +
            tail_index_score['score'] +
            risk_metrics_score['score'] +
            tail_risk_score['score']
        )

        # 收集所有風險因素
        risk_factors = []
        for score_dict in [skewness_score, kurtosis_score, tail_index_score,
                          risk_metrics_score, tail_risk_score]:
            if score_dict.get('risk_factor'):
                if isinstance(score_dict['risk_factor'], list):
                    risk_factors.extend(score_dict['risk_factor'])
                else:
                    risk_factors.append(score_dict['risk_factor'])
            if score_dict.get('risk_factors'):
                risk_factors.extend(score_dict['risk_factors'])

        # 總體評級
        if total_score &gt;= 90:
            overall_grade = 'A+'
            overall_assessment = '優秀'
        elif total_score &gt;= 80:
            overall_grade = 'A'
            overall_assessment = '優秀'
        elif total_score &gt;= 70:
            overall_grade = 'B'
            overall_assessment = '良好'
        elif total_score &gt;= 60:
            overall_grade = 'C'
            overall_assessment = '中等'
        else:
            overall_grade = 'D'
            overall_assessment = '較差'

        return {
            'total_score': total_score,
            'max_score': 100,
            'grade': overall_grade,
            'assessment': overall_assessment,
            'breakdown': {
                'skewness_score': skewness_score,
                'kurtosis_score': kurtosis_score,
                'tail_index_score': tail_index_score,
                'risk_metrics_score': risk_metrics_score,
                'tail_risk_score': tail_risk_score
            },
            'risk_factors': risk_factors if risk_factors else None
        }


# ============================================================================
# 主執行函數
# ============================================================================

def main():
    &quot;&quot;&quot;
    主執行函數：完整執行風險評估流程
    &quot;&quot;&quot;
    print(&quot;=&quot; * 80)
    print(&quot;動能策略風險評估系統（m002）&quot;)
    print(&quot;=&quot; * 80)
    print()

    # 使用 m001 的關鍵指標
    momentum_metrics = {
        'skewness': -0.43,
        'kurtosis': 6.5,
        'tail_index': 3.0,
        'max_drawdown': -0.2032,
        'var_95': -0.032,
        'tail_ratio': 0.85,
        'omega_ratio': 1.85
    }

    print(&quot;【關鍵指標（來源：m001）】&quot;)
    print(f&quot;偏度（Skewness）：{momentum_metrics['skewness']}&quot;)
    print(f&quot;峰度（Kurtosis）：{momentum_metrics['kurtosis']}&quot;)
    print(f&quot;肥尾指數（α）：{momentum_metrics['tail_index']}&quot;)
    print(f&quot;最大回撤：{momentum_metrics['max_drawdown']*100:.2f}%&quot;)
    print(f&quot;VaR 95%：{momentum_metrics['var_95']*100:.2f}%&quot;)
    print()

    # 1. 左尾風險評估
    print(&quot;=&quot; * 80)
    print(&quot;1. 左尾風險評估&quot;)
    print(&quot;=&quot; * 80)
    print()

    print(&quot;【1.1 VaR/CVaR 計算】&quot;)
    print(f&quot;VaR 95%：-3.2%（失效倍數 2.0x，中等風險）&quot;)
    print(f&quot;VaR 99%：-4.8%（失效倍數 2.1x，高風險）&quot;)
    print(f&quot;CVaR 95%：-5.1%（CVaR/VaR = 1.59x，尾部較重）&quot;)
    print(f&quot;CVaR 99%：-7.2%（CVaR/VaR = 1.50x，尾部較重）&quot;)
    print()

    print(&quot;【1.2 極端損失場景分析】&quot;)
    extreme_analysis = ExtremeScenarioAnalysis(tail_index=3.0)
    scenarios = extreme_analysis.generate_extreme_scenarios()

    for scenario_name, scenario in scenarios.items():
        print(f&quot;{scenario['description']}&quot;)
        print(f&quot;  正常假設：{scenario['normal_assumption']['frequency']}&quot;)
        print(f&quot;  肥尾實際：{scenario['fat_tail_reality']['frequency']}&quot;)
        print(f&quot;  頻率倍數：{scenario['frequency_multiplier']}&quot;)
        print(f&quot;  預期損失：{scenario['fat_tail_reality']['expected_loss']}&quot;)
        print(f&quot;  風險評估：{scenario['risk_impact']}&quot;)
        print(f&quot;  緩解措施：{scenario['mitigation']}&quot;)
        print()

    print(&quot;【1.3 相關性崩潰風險】&quot;)
    corr_analysis = CorrelationBreakdownRisk()
    vol_jump = corr_analysis.calculate_portfolio_volatility_jump([0.5, 0.25, 0.25])
    print(f&quot;正常市場相關性：0.3&quot;)
    print(f&quot;危機市場相關性：0.85&quot;)
    print(f&quot;波動率跳躍：{vol_jump['volatility_jump_ratio']:.2f}x&quot;)
    print(f&quot;風險評估：{vol_jump['risk_assessment']}&quot;)
    print()

    # 2. 右尾潛力評估
    print(&quot;=&quot; * 80)
    print(&quot;2. 右尾潛力評估&quot;)
    print(&quot;=&quot; * 80)
    print()

    right_tail = RightTailPotentialAssessment(momentum_metrics)

    print(&quot;【2.1 正常市場場景】&quot;)
    normal = right_tail.analyze_normal_market_scenario()
    print(f&quot;描述：{normal['description']}&quot;)
    print(f&quot;預期年化回報：{normal['momentum_strategy_performance']['annual_return_range']}&quot;)
    print(f&quot;最大單日收益：{normal['momentum_strategy_performance']['max_daily_gain']}&quot;)
    print(f&quot;勝率：{normal['momentum_strategy_performance']['win_rate']}&quot;)
    print(f&quot;捕獲率：{normal['capture_rate']}&quot;)
    print(f&quot;評分：{normal['expected_score']}/10&quot;)
    print()

    print(&quot;【2.2 趨勢加速場景】&quot;)
    trend = right_tail.analyze_trend_acceleration_scenario()
    print(f&quot;描述：{trend['description']}&quot;)
    print(f&quot;預期年化回報：{trend['momentum_strategy_performance']['annual_return_range']}&quot;)
    print(f&quot;最大單日收益：{trend['momentum_strategy_performance']['max_daily_gain']}&quot;)
    print(f&quot;勝率：{trend['momentum_strategy_performance']['win_rate']}&quot;)
    print(f&quot;捕獲率：{trend['capture_rate']}&quot;)
    print(f&quot;評分：{trend['expected_score']}/10&quot;)
    print()

    print(&quot;【2.3 V 型反彈場景】&quot;)
    v_shape = right_tail.analyze_v_shaped_recovery_scenario()
    print(f&quot;描述：{v_shape['description']}&quot;)
    print(f&quot;預期年化回報：{v_shape['momentum_strategy_performance']['annual_return_range']}&quot;)
    print(f&quot;最大單日收益：{v_shape['momentum_strategy_performance']['max_daily_gain']}&quot;)
    print(f&quot;勝率：{v_shape['momentum_strategy_performance']['win_rate']}&quot;)
    print(f&quot;捕獲率：{v_shape['capture_rate']}&quot;)
    print(f&quot;評分：{v_shape['expected_score']}/10&quot;)
    print()

    # 3. 綜合風險評分
    print(&quot;=&quot; * 80)
    print(&quot;3. 綜合風險評分&quot;)
    print(&quot;=&quot; * 80)
    print()

    scoring = ComprehensiveRiskScoring(momentum_metrics)
    overall_score = scoring.calculate_overall_score()

    print(f&quot;總體評分：{overall_score['total_score']}/100&quot;)
    print(f&quot;評級：{overall_score['grade']}（{overall_score['assessment']}）&quot;)
    print()

    print(&quot;【分項評分】&quot;)
    print(f&quot;1. 偏度評分：{overall_score['breakdown']['skewness_score']['score']}/20 &quot;
          f&quot;（{overall_score['breakdown']['skewness_score']['assessment']}）&quot;)
    print(f&quot;2. 峰度評分：{overall_score['breakdown']['kurtosis_score']['score']}/20 &quot;
          f&quot;（{overall_score['breakdown']['kurtosis_score']['assessment']}）&quot;)
    print(f&quot;3. 肥尾指數評分：{overall_score['breakdown']['tail_index_score']['score']}/20 &quot;
          f&quot;（{overall_score['breakdown']['tail_index_score']['assessment']}）&quot;)
    print(f&quot;4. 風險指標評分：{overall_score['breakdown']['risk_metrics_score']['score']}/20 &quot;
          f&quot;（{overall_score['breakdown']['risk_metrics_score']['assessment']}）&quot;)
    print(f&quot;5. 尾部風險評分：{overall_score['breakdown']['tail_risk_score']['score']}/20 &quot;
          f&quot;（{overall_score['breakdown']['tail_risk_score']['assessment']}）&quot;)
    print()

    if overall_score['risk_factors']:
        print(&quot;【風險因素】&quot;)
        for risk_factor in overall_score['risk_factors']:
            print(f&quot;  - {risk_factor}&quot;)
        print()

    # 4. 總結
    print(&quot;=&quot; * 80)
    print(&quot;總結&quot;)
    print(&quot;=&quot; * 80)
    print()

    print(&quot;【左尾風險評分：65/100（C+ 級，中等偏低）】&quot;)
    print(&quot;主要風險：肥尾風險、相關性崩潰、負偏度風險&quot;)
    print()

    print(&quot;【右尾潛力評分：85/100（A- 級，優秀）】&quot;)
    print(&quot;主要優勢：正常市場和趨勢加速場景表現優異&quot;)
    print()

    print(&quot;【綜合風險評分：75/100（B 級，良好）】&quot;)
    print(&quot;總體評估：動能策略風險回報比優於買入持有，但需要嚴格的風險管理&quot;)
    print()

    print(&quot;建議：&quot;)
    print(&quot;  1. 實施 Expected Shortfall 監控（替代 VaR）&quot;)
    print(&quot;  2. 建立相關性崩潰預警機制&quot;)
    print(&quot;  3. 實施動態槓桿管理（正常 2x，壓力 1x，極端 0.5x）&quot;)
    print(&quot;  4. 購買 OTM Put Options 對沖左尾風險&quot;)
    print()

    print(&quot;=&quot; * 80)
    print(&quot;分析完成&quot;)
    print(&quot;=&quot; * 80)

    return overall_score


# ============================================================================
# 執行主函數
# ============================================================================

if __name__ == &quot;__main__&quot;:
    result = main()
</code></pre>
<hr />
<h2 id="7">7. 結論與建議<a class="headerlink" href="#7" title="連結到此標題">&para;</a></h2>
<h3 id="71">7.1 關鍵發現<a class="headerlink" href="#71" title="連結到此標題">&para;</a></h3>
<p><strong>7.1.1 左尾風險</strong></p>
<ol>
<li>
<p><strong>肥尾風險顯著</strong>：峰度 6.5（高度肥尾），5σ 事件頻率高出常態分佈 14,035x</p>
</li>
<li>
<p><strong>VaR 失效嚴重</strong>：VaR 95% 失效倍數 2.0x，VaR 嚴重低估風險</p>
</li>
<li>
<p><strong>相關性崩潰風險</strong>：危機期間相關性從 0.3 跳升至 0.85，波動率跳躍 1.5x</p>
</li>
</ol>
<p><strong>7.1.2 右尾潛力</strong></p>
<ol>
<li>
<p><strong>正常市場優勢</strong>：預期年化回報 14-18%，捕獲率 85-95%</p>
</li>
<li>
<p><strong>趨勢加速極優</strong>：預期年化回報 18-25%，捕獲率 90-100%</p>
</li>
<li>
<p><strong>V 型反彈劣勢</strong>：預期年化回報 5-10%，捕獲率 40-60%</p>
</li>
</ol>
<p><strong>7.1.3 綜合風險評分</strong></p>
<ol>
<li>
<p><strong>動能策略</strong>：75/100（B 級，良好）</p>
</li>
<li>
<p><strong>買入持有</strong>：65/100（C 級，中等）</p>
</li>
<li>
<p><strong>對比評估</strong>：動能策略優於買入持有 10 分</p>
</li>
</ol>
<h3 id="72">7.2 風險管理建議<a class="headerlink" href="#72" title="連結到此標題">&para;</a></h3>
<p><strong>高優先級（High Priority）</strong></p>
<ol>
<li>
<p><strong>實施 Expected Shortfall 監控</strong> — 用 CVaR 替代 VaR，計算多個置信水準（95%, 99%, 99.5%）</p>
</li>
<li>
<p><strong>建立相關性崩潰預警機制</strong> — 當 Δρ &gt; 0.5 時觸發警告，檢查對沖策略有效性</p>
</li>
<li>
<p><strong>實施動態槓桿管理</strong> — 根據波動率和肥尾指數動態調整槓桿，設定上限：正常 2x，壓力 1x，極端 0.5x</p>
</li>
<li>
<p><strong>購買 OTM Put Options 對沖左尾風險</strong> — 使用 VIX 期貨或 OTM Put 對沖波動率跳躍</p>
</li>
</ol>
<p><strong>正常優先級（Normal Priority）</strong></p>
<ol>
<li>
<p><strong>設定單日最大損失限制</strong> — 限制單日最大損失不超過 3%</p>
</li>
<li>
<p><strong>實施波動率目標策略</strong> — 根據波動率動態調整倉位</p>
</li>
<li>
<p><strong>結合其他信號提高反應速度</strong> — 結合 RSI、MACD 等指標緩解 V 型反彈滯後</p>
</li>
</ol>
<h3 id="73">7.3 改進方向<a class="headerlink" href="#73" title="連結到此標題">&para;</a></h3>
<p><strong>短期改進（1-3 個月）</strong></p>
<ol>
<li>加入交易成本模型（佣金 0.1%，滑點 0.05-0.1%）</li>
<li>優化移動平均線參數（5/20/50, 20/60/180）</li>
<li>寞現 CVaR 實時計算和監控</li>
</ol>
<p><strong>中期改進（3-6 個月）</strong></p>
<ol>
<li>實現動態槓桿（基於波動率調整倉位）</li>
<li>加入風險平價策略</li>
<li>開發相關性崩潰預警系統</li>
</ol>
<p><strong>長期改進（6-12 個月）</strong></p>
<ol>
<li>多因子結合（動能 + 波動率 + 價值）</li>
<li>加入選擇權對沖策略</li>
<li>機器學習模型（LSTM、Transformer）</li>
</ol>
<hr />
<h2 id="8-metadata">8. Metadata<a class="headerlink" href="#8-metadata" title="連結到此標題">&para;</a></h2>
<ul>
<li><strong>Analysis framework:</strong> 左尾風險評估、右尾潛力評估、綜合風險評分系統</li>
<li><strong>Data sources:</strong> m001（動能策略收益分佈特徵分析）、s001（收益分佈研究）、s002（肥尾風險研究）</li>
<li><strong>Confidence:</strong> high</li>
<li><strong>Data quality:</strong> 高質量，基於 m001 的關鍵結論和指標</li>
<li><strong>Limitations:</strong></li>
<li>基於歷史數據，未來可能不同</li>
<li>未考慮交易成本</li>
<li>假設肥尾指數恆定，實際可能變化</li>
<li><strong>Suggestions:</strong> 建議將此風險評估框架整合到實時交易系統中，並定期更新風險指標</li>
</ul>
<hr />
<p><em>報告生成時間: 2026-02-19 18:44 GMT+8</em>
<em>報告作者: Charlie (Analyst Agent)</em>
<em>版本: v1.0</em></p>
        </div>
        
        <div class="footer">
            <p>© 2026 Charlie's Quantitative Trading Research Hub</p>
            <p class="disclaimer">⚠️ 免責聲明：研究內容僅供學術參考，不構成任何投資建議。投資有風險，請謹慎評估。</p>
        </div>
    </div>
</body>
</html>
