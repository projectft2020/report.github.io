<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¶¨å‹¢ç­–ç•¥å¤±æ•ˆç›£æ§ç³»çµ± - é‡åŒ–äº¤æ˜“ç ”ç©¶å ±å‘Š</title>
    
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #64748b;
            --accent-color: #f59e0b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --text-color: #1e293b;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --border-color: #e2e8f0;
            --code-bg: #1e293b;
            --code-text: #e2e8f0;
            --table-header: #f1f5f9;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3rem 2rem;
            border-radius: 16px;
            text-align: center;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        
        .header .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }
        
        .header .description {
            font-size: 1rem;
            opacity: 0.8;
        }
        
        .content {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .content h1, .content h2, .content h3, .content h4, .content h5, .content h6 {
            color: var(--primary-color);
            margin-top: 2rem;
            margin-bottom: 1rem;
        }
        
        .content h1 { font-size: 2.2rem; }
        .content h2 { font-size: 1.8rem; }
        .content h3 { font-size: 1.5rem; }
        .content h4 { font-size: 1.3rem; }
        .content h5 { font-size: 1.1rem; }
        .content h6 { font-size: 1rem; }
        
        .content p {
            margin-bottom: 1rem;
            line-height: 1.7;
        }
        
        .content ul, .content ol {
            margin-bottom: 1rem;
            padding-left: 2rem;
        }
        
        .content li {
            margin-bottom: 0.5rem;
        }
        
        .content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .content th, .content td {
            border: 1px solid var(--border-color);
            padding: 0.75rem;
            text-align: left;
        }
        
        .content th {
            background-color: var(--table-header);
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .content tr:nth-child(even) {
            background-color: #f8fafc;
        }
        
        .content blockquote {
            border-left: 4px solid var(--primary-color);
            padding-left: 1rem;
            margin: 1rem 0;
            color: var(--secondary-color);
            font-style: italic;
        }
        
        .content code {
            background-color: #f1f5f9;
            color: var(--primary-color);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9em;
        }
        
        .content pre {
            background-color: var(--code-bg);
            color: var(--code-text);
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1.5rem 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .content pre code {
            background-color: transparent;
            color: inherit;
            padding: 0;
        }
        
        .back-to-home {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--primary-color);
            color: white;
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }
        
        .back-to-home:hover {
            background: #1d4ed8;
            transform: translateX(-4px);
        }
        
        .footer {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            margin-top: 2rem;
            border-top: 1px solid var(--border-color);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .footer p {
            color: var(--secondary-color);
            margin-bottom: 0.5rem;
        }
        
        .footer .disclaimer {
            font-size: 0.875rem;
            font-style: italic;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }
        
        .info-box {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-left: 4px solid var(--primary-color);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }
        
        .warning-box {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-left: 4px solid var(--accent-color);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }
        
        .success-box {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border-left: 4px solid var(--success-color);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .header {
                padding: 2rem 1rem;
            }
            
            .content {
                padding: 1.5rem;
            }
            
            .content h1 { font-size: 1.8rem; }
            .content h2 { font-size: 1.5rem; }
            .content h3 { font-size: 1.3rem; }
        }
    </style>
    
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-to-home">â† è¿”å›ç ”ç©¶ç›®éŒ„</a>
        
        <div class="header">
            <h1>è¶¨å‹¢ç­–ç•¥å¤±æ•ˆç›£æ§ç³»çµ±</h1>
            <p class="subtitle">é‡åŒ–äº¤æ˜“ç ”ç©¶å ±å‘Š - 2026-02-19</p>
            <p class="description">å››å¤§å¤±æ•ˆæ¨¡å¼ç›£æ§ + å››ç´šé è­¦ç³»çµ± + è‡ªå‹•æ‡‰å°æªæ–½</p>
        </div>
        
        <div class="content">
            <h1 id="_1">è¶¨å‹¢ç­–ç•¥å¤±æ•ˆç›£æ§ç³»çµ±ç ”ç©¶<a class="headerlink" href="#_1" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h1>
<p><strong>Task ID:</strong> t003-failure-monitor
<strong>Agent:</strong> Charlie Automation
<strong>Status:</strong> in_progress
<strong>Timestamp:</strong> 2026-02-19T14:01:00+08:00</p>
<h2 id="_2">ç ”ç©¶ç›®æ¨™<a class="headerlink" href="#_2" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h2>
<p>é–‹ç™¼å¯¦æ™‚ç›£æ§è¶¨å‹¢ç­–ç•¥ç¸¾æ•ˆä¸¦è§¸ç™¼é è­¦çš„ç³»çµ±ï¼ŒåŠæ™‚è­˜åˆ¥ç­–ç•¥å¤±æ•ˆï¼Œé™ä½é¢¨éšªæš´éœ²ã€‚</p>
<h2 id="_3">æ ¸å¿ƒæ¦‚å¿µ<a class="headerlink" href="#_3" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h2>
<h3 id="_4">ç‚ºä»€éº¼éœ€è¦ç›£æ§ç³»çµ±ï¼Ÿ<a class="headerlink" href="#_4" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<p>è¶¨å‹¢äº¤æ˜“ç­–ç•¥åœ¨å¸‚å ´ç’°å¢ƒè®ŠåŒ–æ™‚å¯èƒ½å¤±æ•ˆï¼š
- è¶¨å‹¢å¸‚å ´è½‰ç‚ºç›¤æ•´å¸‚å ´
- æ³¢å‹•ç‡åŠ‡çƒˆè®ŠåŒ–
- çªç™¼äº‹ä»¶å½±éŸ¿å¸‚å ´çµæ§‹
- ç­–ç•¥åƒæ•¸éåº¦æ“¬åˆ</p>
<p><strong>ç›£æ§ç³»çµ±çš„ä½œç”¨ï¼š</strong>
- åŠæ™‚è­˜åˆ¥ç­–ç•¥å¤±æ•ˆ
- è§¸ç™¼é è­¦ä¸¦æ¡å–ä¿è­·æªæ–½
- é™ä½ç­–ç•¥å¤±æ•ˆæœŸé–“çš„æå¤±
- ç‚ºç­–ç•¥èª¿æ•´æä¾›ä¾æ“š</p>
<h2 id="_5">å¤±æ•ˆæ¨¡å¼è­˜åˆ¥<a class="headerlink" href="#_5" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h2>
<h3 id="1">1. å‹ç‡ä¸‹é™<a class="headerlink" href="#1" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<p><strong>ç—‡ç‹€ï¼š</strong>
- å‹ç‡å¾ 60%+ ä¸‹é™åˆ° 40% ä»¥ä¸‹
- é€£çºŒè™§æç­†æ•¸è¶…é 5 ç­†
- æ»¾å‹• 20 ç­†å‹ç‡ä½æ–¼ 45%</p>
<p><strong>åŸå› ï¼š</strong>
- å¸‚å ´é€²å…¥ç›¤æ•´æœŸ
- è¶¨å‹¢ä¸ç©©å®šï¼Œå‡çªç ´å¢å¤š
- ç­–ç•¥åƒæ•¸ä¸å†é©ç•¶</p>
<h3 id="2">2. ç›ˆè™§æ¯”æƒ¡åŒ–<a class="headerlink" href="#2" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<p><strong>ç—‡ç‹€ï¼š</strong>
- å¹³å‡ç²åˆ©èˆ‡å¹³å‡è™§ææ¯”å¾ &gt;1.5 ä¸‹é™åˆ° &lt;1.0
- é€£çºŒå¤šç­†å¤§è™§æ
- æ­¢æè¢«é »ç¹è§¸ç™¼</p>
<p><strong>åŸå› ï¼š</strong>
- æ³¢å‹•ç‡å¢å¤§ï¼Œæ­¢æè¨­ç½®ä¸ç•¶
- å…¥å ´é»ä¸ä½³
- è¶¨å‹¢æŒçºŒæ™‚é–“ç¸®çŸ­</p>
<h3 id="3">3. æœ€å¤§å›æ’¤è¶…æ¨™<a class="headerlink" href="#3" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<p><strong>ç—‡ç‹€ï¼š</strong>
- å›æ’¤è¶…éæ­·å²å¹³å‡çš„ 1.5 å€
- å›æ’¤æŒçºŒæ™‚é–“è¶…é 30 å¤©
- è³‡é‡‘æ›²ç·šé•·æœŸä½æ–¼å‡ç·š</p>
<p><strong>åŸå› ï¼š</strong>
- å¸‚å ´ç’°å¢ƒåŠ‡çƒˆè®ŠåŒ–
- é¢¨éšªæ§åˆ¶å¤±æ•ˆ
- ç­–ç•¥é‚è¼¯å¤±æ•ˆ</p>
<h3 id="4">4. ä¿¡è™Ÿè³ªé‡ä¸‹é™<a class="headerlink" href="#4" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<p><strong>ç—‡ç‹€ï¼š</strong>
- é«˜ç½®ä¿¡åº¦ä¿¡è™Ÿå‹ç‡ä¸‹é™
- ä¿¡è™Ÿé »ç‡ç•°å¸¸ï¼ˆéé«˜æˆ–éä½ï¼‰
- å¤šæ™‚é–“æ¡†æ¶ä¸ä¸€è‡´å¢åŠ </p>
<p><strong>åŸå› ï¼š</strong>
- è¶¨å‹¢ä¸ç©©å®š
- å¸‚å ´çµæ§‹è®ŠåŒ–
- æŠ€è¡“æŒ‡æ¨™å¤±æ•ˆ</p>
<h2 id="_6">ç›£æ§æŒ‡æ¨™<a class="headerlink" href="#_6" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h2>
<h3 id="_7">å¯¦æ™‚ç›£æ§æŒ‡æ¨™<a class="headerlink" href="#_7" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<pre><code class="language-python">class RealTimeMetrics:
    &quot;&quot;&quot;
    å¯¦æ™‚ç›£æ§æŒ‡æ¨™
    &quot;&quot;&quot;

    def __init__(self,
                 lookback_trades=20,
                 max_drawdown_threshold=-15.0,
                 min_win_rate=45.0,
                 max_consecutive_losses=5):
        &quot;&quot;&quot;
        åˆå§‹åŒ–ç›£æ§æŒ‡æ¨™

        Parameters:
        -----------
        lookback_trades : int
            å›çœ‹äº¤æ˜“ç­†æ•¸
        max_drawdown_threshold : float
            æœ€å¤§å›æ’¤é–¾å€¼ï¼ˆç™¾åˆ†æ¯”ï¼‰
        min_win_rate : float
            æœ€ä½å‹ç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰
        max_consecutive_losses : int
        æœ€å¤§é€£çºŒè™§æç­†æ•¸
        &quot;&quot;&quot;
        self.lookback_trades = lookback_trades
        self.max_drawdown_threshold = max_drawdown_threshold
        self.min_win_rate = min_win_rate
        self.max_consecutive_losses = max_consecutive_losses

    def calculate_metrics(self, trades, equity_curve):
        &quot;&quot;&quot;
        è¨ˆç®—ç›£æ§æŒ‡æ¨™

        Parameters:
        -----------
        trades : list
            äº¤æ˜“è¨˜éŒ„
        equity_curve : pd.Series
            è³‡é‡‘æ›²ç·š

        Returns:
        --------
        dict
            ç›£æ§æŒ‡æ¨™
        &quot;&quot;&quot;
        # æœ€è¿‘äº¤æ˜“
        recent_trades = trades[-self.lookback_trades:] if len(trades) &gt;= self.lookback_trades else trades

        # å‹ç‡
        winning_trades = [t for t in recent_trades if t.get('pnl', 0) &gt; 0]
        losing_trades = [t for t in recent_trades if t.get('pnl', 0) &lt; 0]
        win_rate = len(winning_trades) / len(recent_trades) * 100 if recent_trades else 0

        # ç›ˆè™§æ¯”
        avg_win = np.mean([t['pnl'] for t in winning_trades]) if winning_trades else 0
        avg_loss = np.mean([t['pnl'] for t in losing_trades]) if losing_trades else 0
        profit_loss_ratio = abs(avg_win / avg_loss) if avg_loss != 0 else 0

        # é€£çºŒè™§æ
        consecutive_losses = 0
        for trade in reversed(trades):
            if trade.get('pnl', 0) &lt; 0:
                consecutive_losses += 1
            else:
                break

        # å›æ’¤
        max_drawdown = self.calculate_max_drawdown(equity_curve)

        # ä¿¡è™Ÿè³ªé‡
        high_conf_trades = [t for t in recent_trades if t.get('confidence') == 'é«˜']
        high_conf_win_rate = len([t for t in high_conf_trades if t.get('pnl', 0) &gt; 0]) / len(high_conf_trades) * 100 if high_conf_trades else 0

        return {
            'win_rate': win_rate,
            'profit_loss_ratio': profit_loss_ratio,
            'avg_win': avg_win,
            'avg_loss': avg_loss,
            'consecutive_losses': consecutive_losses,
            'max_drawdown': max_drawdown,
            'high_conf_win_rate': high_conf_win_rate,
            'total_trades': len(recent_trades),
            'total_winning_trades': len(winning_trades),
            'total_losing_trades': len(losing_trades)
        }

    def calculate_max_drawdown(self, equity_curve):
        &quot;&quot;&quot;
        è¨ˆç®—æœ€å¤§å›æ’¤

        Parameters:
        -----------
        equity_curve : pd.Series
            è³‡é‡‘æ›²ç·š

        Returns:
        --------
        float
            æœ€å¤§å›æ’¤ï¼ˆç™¾åˆ†æ¯”ï¼‰
        &quot;&quot;&quot;
        running_max = equity_curve.expanding().max()
        drawdown = (equity_curve - running_max) / running_max * 100
        return drawdown.min()

    def check_alerts(self, metrics):
        &quot;&quot;&quot;
        æª¢æŸ¥é è­¦æ¢ä»¶

        Parameters:
        -----------
        metrics : dict
            ç›£æ§æŒ‡æ¨™

        Returns:
        --------
        tuple
            (has_alert, alert_messages, severity)
        &quot;&quot;&quot;
        alerts = []
        severity = 'low'

        # å‹ç‡éä½
        if metrics['win_rate'] &lt; self.min_win_rate:
            alerts.append(f&quot;âš ï¸ å‹ç‡éä½ï¼š{metrics['win_rate']:.1f}% &lt; {self.min_win_rate}%&quot;)
            severity = 'high'

        # é€£çºŒè™§æéå¤š
        if metrics['consecutive_losses'] &gt; self.max_consecutive_losses:
            alerts.append(f&quot;âš ï¸ é€£çºŒè™§æï¼š{metrics['consecutive_losses']} ç­† &gt; {self.max_consecutive_losses} ç­†&quot;)
            severity = 'high'

        # ç›ˆè™§æ¯”éä½
        if metrics['profit_loss_ratio'] &lt; 1.0:
            alerts.append(f&quot;âš ï¸ ç›ˆè™§æ¯”éä½ï¼š{metrics['profit_loss_ratio']:.2f} &lt; 1.0&quot;)
            severity = 'medium'

        # å›æ’¤è¶…æ¨™
        if metrics['max_drawdown'] &lt; self.max_drawdown_threshold:
            alerts.append(f&quot;âš ï¸ å›æ’¤è¶…æ¨™ï¼š{metrics['max_drawdown']:.1f}% &lt; {self.max_drawdown_threshold}%&quot;)
            severity = 'high'

        # é«˜ç½®ä¿¡åº¦ä¿¡è™Ÿå‹ç‡ä½
        if metrics['high_conf_win_rate'] &lt; 50:
            alerts.append(f&quot;âš ï¸ é«˜ç½®ä¿¡åº¦ä¿¡è™Ÿå‹ç‡ä½ï¼š{metrics['high_conf_win_rate']:.1f}% &lt; 50%&quot;)
            severity = 'medium'

        has_alert = len(alerts) &gt; 0

        return has_alert, alerts, severity
</code></pre>
<h2 id="_8">é è­¦ç³»çµ±<a class="headerlink" href="#_8" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h2>
<h3 id="_9">é è­¦ç´šåˆ¥<a class="headerlink" href="#_9" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<table>
<thead>
<tr>
<th>ç´šåˆ¥</th>
<th>æ¢ä»¶</th>
<th>è¡Œå‹•</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä¿¡æ¯</td>
<td>æŒ‡æ¨™æ¥è¿‘é–¾å€¼</td>
<td>è¨˜éŒ„æ—¥å¿—ï¼Œç¹¼çºŒç›£æ§</td>
</tr>
<tr>
<td>ä½é¢¨éšª</td>
<td>1-2 å€‹è¼•å¾®é è­¦</td>
<td>é™ä½å€‰ä½è‡³ 50%</td>
</tr>
<tr>
<td>ä¸­é¢¨éšª</td>
<td>2-3 å€‹ä¸­ç­‰é è­¦</td>
<td>é™ä½å€‰ä½è‡³ 25%</td>
</tr>
<tr>
<td>é«˜é¢¨éšª</td>
<td>â‰¥2 å€‹é«˜ç´šé è­¦</td>
<td>åœæ­¢é–‹æ–°å€‰ï¼Œå¹³å€‰ç¾æœ‰é ­å¯¸</td>
</tr>
</tbody>
</table>
<h3 id="_10">è‡ªå‹•æ‡‰å°æªæ–½<a class="headerlink" href="#_10" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<pre><code class="language-python">class AutoResponse:
    &quot;&quot;&quot;
    è‡ªå‹•æ‡‰å°æªæ–½
    &quot;&quot;&quot;

    def __init__(self):
        self.position_multiplier = 1.0
        self.stop_new_positions = False
        self.close_existing = False

    def take_action(self, severity, alerts):
        &quot;&quot;&quot;
        æ ¹æ“šåš´é‡ç¨‹åº¦æ¡å–è¡Œå‹•

        Parameters:
        -----------
        severity : str
            åš´é‡ç¨‹åº¦ ('info', 'low', 'medium', 'high')
        alerts : list
            é è­¦æ¶ˆæ¯

        Returns:
        --------
        dict
            è¡Œå‹•ä¿¡æ¯
        &quot;&quot;&quot;
        actions = []

        if severity == 'info':
            actions.append(&quot;âœ… è¨˜éŒ„é è­¦ï¼Œç¹¼çºŒç›£æ§&quot;)

        elif severity == 'low':
            self.position_multiplier = 0.5
            actions.append(&quot;âš¡ é™ä½å€‰ä½è‡³ 50%&quot;)

        elif severity == 'medium':
            self.position_multiplier = 0.25
            actions.append(&quot;âš¡ é™ä½å€‰ä½è‡³ 25%&quot;)

        elif severity == 'high':
            self.stop_new_positions = True
            self.close_existing = True
            actions.append(&quot;ğŸ›‘ åœæ­¢é–‹æ–°å€‰&quot;)
            actions.append(&quot;ğŸ›‘ å¹³å€‰ç¾æœ‰é ­å¯¸&quot;)

        return {
            'severity': severity,
            'position_multiplier': self.position_multiplier,
            'stop_new_positions': self.stop_new_positions,
            'close_existing': self.close_existing,
            'actions': actions,
            'alerts': alerts
        }

    def reset(self):
        &quot;&quot;&quot;
        é‡ç½®ç³»çµ±ï¼ˆç•¶é è­¦è§£é™¤å¾Œï¼‰
        &quot;&quot;&quot;
        self.position_multiplier = 1.0
        self.stop_new_positions = False
        self.close_existing = False
</code></pre>
<h2 id="_11">å¯Œä½œè¨ˆåŠƒ<a class="headerlink" href="#_11" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h2>
<h3 id="phase-1">Phase 1: ç›£æ§æŒ‡æ¨™å¯¦ç¾<a class="headerlink" href="#phase-1" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<ul>
<li>å¯¦æ™‚æŒ‡æ¨™è¨ˆç®—</li>
<li>æ»¾å‹•çµ±è¨ˆ</li>
<li>é–¾å€¼è¨­ç½®</li>
</ul>
<h3 id="phase-2">Phase 2: é è­¦è§¸ç™¼<a class="headerlink" href="#phase-2" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<ul>
<li>å¤šæ¢ä»¶é è­¦é‚è¼¯</li>
<li>åš´é‡ç¨‹åº¦è©•ä¼°</li>
<li>é è­¦æ¶ˆæ¯ç”Ÿæˆ</li>
</ul>
<h3 id="phase-3">Phase 3: è‡ªå‹•æ‡‰å°<a class="headerlink" href="#phase-3" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<ul>
<li>å€‰ä½èª¿æ•´</li>
<li>åœæ­¢æ–°å€‰</li>
<li>å¹³å€‰æ©Ÿåˆ¶</li>
</ul>
<h3 id="phase-4">Phase 4: é€šçŸ¥ç³»çµ±<a class="headerlink" href="#phase-4" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<ul>
<li>å¤šæ¸ é“é€šçŸ¥</li>
<li>é »ç‡æ§åˆ¶</li>
<li>æ—¥èªŒè¨˜éŒ„</li>
</ul>
<h3 id="phase-5">Phase 5: æ¸¬è©¦é©—è­‰<a class="headerlink" href="#phase-5" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<ul>
<li>æ­·å²æ•¸æ“šæ¸¬è©¦</li>
<li>æ¨¡æ“¬å¤±æ•ˆå ´æ™¯</li>
<li>é©—è­‰é è­¦æº–ç¢ºæ€§</li>
</ul>
<h2 id="python">å®Œæ•´ Python ä»£ç¢¼æ¡†æ¶<a class="headerlink" href="#python" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h2>
<h3 id="1_1">1. æ ¸å¿ƒç›£æ§é¡<a class="headerlink" href="#1_1" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<pre><code class="language-python">import pandas as pd
import numpy as np
import talib
from datetime import datetime, timedelta
from typing import Dict, List, Tuple, Optional
import logging
from dataclasses import dataclass
from enum import Enum

class AlertSeverity(Enum):
    &quot;&quot;&quot;é è­¦åš´é‡ç¨‹åº¦æšèˆ‰&quot;&quot;&quot;
    INFO = &quot;info&quot;
    LOW = &quot;low&quot;
    MEDIUM = &quot;medium&quot;
    HIGH = &quot;high&quot;

class ActionLevel(Enum):
    &quot;&quot;&quot;æ‡‰å°æªæ–½ç´šåˆ¥&quot;&quot;&quot;
    CONTINUE = &quot;continue&quot;      # ç¹¼çºŒæ­£å¸¸äº¤æ˜“
    REDUCE_50 = &quot;reduce_50&quot;    # é™ä½å€‰ä½è‡³ 50%
    REDUCE_25 = &quot;reduce_25&quot;    # é™ä½å€‰ä½è‡³ 25%
    STOP_ALL = &quot;stop_all&quot;      # åœæ­¢æ‰€æœ‰äº¤æ˜“

@dataclass
class TradeRecord:
    &quot;&quot;&quot;äº¤æ˜“è¨˜éŒ„æ•¸æ“šé¡&quot;&quot;&quot;
    timestamp: datetime
    symbol: str
    action: str  # 'buy' or 'sell'
    entry_price: float
    exit_price: Optional[float] = None
    pnl: Optional[float] = None
    confidence: Optional[str] = None
    position_size: float = 1.0
    stop_loss: Optional[float] = None
    take_profit: Optional[float] = None
    exit_reason: Optional[str] = None

@dataclass
class AlertMessage:
    &quot;&quot;&quot;é è­¦æ¶ˆæ¯æ•¸æ“šé¡&quot;&quot;&quot;
    timestamp: datetime
    severity: AlertSeverity
    message: str
    metric_name: str
    current_value: float
    threshold: float
    action_level: ActionLevel

class FailureMonitorSystem:
    &quot;&quot;&quot;
    è¶¨å‹¢ç­–ç•¥å¤±æ•ˆç›£æ§ç³»çµ±

    æ ¸å¿ƒåŠŸèƒ½ï¼š
    1. å¯¦æ™‚è¨ˆç®—ç›£æ§æŒ‡æ¨™
    2. å¤šæ¢ä»¶é è­¦è§¸ç™¼
    3. è‡ªå‹•æ‡‰å°æªæ–½
    4. å¤šæ¸ é“é€šçŸ¥
    &quot;&quot;&quot;

    def __init__(self,
                 # å‹ç‡ç›£æ§
                 min_win_rate: float = 45.0,
                 lookback_trades: int = 20,
                 max_consecutive_losses: int = 5,

                 # ç›ˆè™§æ¯”ç›£æ§
                 min_profit_loss_ratio: float = 1.0,
                 max_loss_multiplier: float = 1.5,

                 # å›æ’¤ç›£æ§
                 max_drawdown_threshold: float = -15.0,
                 drawdown_window: int = 30,

                 # ä¿¡è™Ÿè³ªé‡ç›£æ§
                 min_high_conf_win_rate: float = 60.0,
                 max_signal_frequency_deviation: float = 0.5,

                 # é€šçŸ¥è¨­ç½®
                 enable_email: bool = False,
                 enable_telegram: bool = False,
                 email_recipients: List[str] = None,
                 telegram_chat_id: str = None,

                 # æ—¥èªŒè¨­ç½®
                 log_level: str = &quot;INFO&quot;,
                 log_file: str = &quot;failure_monitor.log&quot;):

        # å‹ç‡åƒæ•¸
        self.min_win_rate = min_win_rate
        self.lookback_trades = lookback_trades
        self.max_consecutive_losses = max_consecutive_losses

        # ç›ˆè™§æ¯”åƒæ•¸
        self.min_profit_loss_ratio = min_profit_loss_ratio
        self.max_loss_multiplier = max_loss_multiplier

        # å›æ’¤åƒæ•¸
        self.max_drawdown_threshold = max_drawdown_threshold
        self.drawdown_window = drawdown_window

        # ä¿¡è™Ÿè³ªé‡åƒæ•¸
        self.min_high_conf_win_rate = min_high_conf_win_rate
        self.max_signal_frequency_deviation = max_signal_frequency_deviation

        # é€šçŸ¥è¨­ç½®
        self.enable_email = enable_email
        self.enable_telegram = enable_telegram
        self.email_recipients = email_recipients or []
        self.telegram_chat_id = telegram_chat_id

        # ç³»çµ±ç‹€æ…‹
        self.current_action_level = ActionLevel.CONTINUE
        self.position_multiplier = 1.0
        self.is_active = True

        # æ­·å²æ•¸æ“š
        self.trade_history: List[TradeRecord] = []
        self.alert_history: List[AlertMessage] = []
        self.equity_curve = []
        self.signal_history = []

        # è¨­ç½®æ—¥èªŒ
        self._setup_logging(log_level, log_file)

        self.logger.info(&quot;Failure Monitor System initialized&quot;)

    def _setup_logging(self, log_level: str, log_file: str):
        &quot;&quot;&quot;è¨­ç½®æ—¥èªŒç³»çµ±&quot;&quot;&quot;
        logging.basicConfig(
            level=getattr(logging, log_level),
            format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
            handlers=[
                logging.FileHandler(log_file),
                logging.StreamHandler()
            ]
        )
        self.logger = logging.getLogger(&quot;FailureMonitor&quot;)

    def add_trade(self, trade: TradeRecord):
        &quot;&quot;&quot;
        æ·»åŠ äº¤æ˜“è¨˜éŒ„

        Parameters:
        -----------
        trade : TradeRecord
            äº¤æ˜“è¨˜éŒ„
        &quot;&quot;&quot;
        self.trade_history.append(trade)
        self.logger.info(f&quot;Trade added: {trade.symbol} {trade.action} at {trade.entry_price}&quot;)

    def add_signal(self, signal_data: Dict):
        &quot;&quot;&quot;
        æ·»åŠ ä¿¡è™Ÿè¨˜éŒ„

        Parameters:
        -----------
        signal_data : Dict
            ä¿¡è™Ÿæ•¸æ“š
        &quot;&quot;&quot;
        signal_record = {
            'timestamp': datetime.now(),
            'symbol': signal_data.get('symbol', ''),
            'signal_type': signal_data.get('signal_type', ''),
            'confidence': signal_data.get('confidence', ''),
            'price': signal_data.get('price', 0.0),
            'confirmation_count': signal_data.get('confirmation_count', 0)
        }
        self.signal_history.append(signal_record)

    def update_equity(self, equity: float, timestamp: Optional[datetime] = None):
        &quot;&quot;&quot;
        æ›´æ–°è³‡é‡‘æ›²ç·š

        Parameters:
        -----------
        equity : float
            ç•¶å‰è³‡é‡‘
        timestamp : datetime, optional
            æ™‚é–“æˆ³
        &quot;&quot;&quot;
        if timestamp is None:
            timestamp = datetime.now()

        self.equity_curve.append({
            'timestamp': timestamp,
            'equity': equity
        })

    def calculate_win_rate_metrics(self) -&gt; Dict:
        &quot;&quot;&quot;
        è¨ˆç®—å‹ç‡ç›¸é—œæŒ‡æ¨™

        Returns:
        --------
        Dict
            å‹ç‡æŒ‡æ¨™
        &quot;&quot;&quot;
        if not self.trade_history:
            return {
                'win_rate': 0.0,
                'consecutive_losses': 0,
                'recent_win_rate': 0.0,
                'trading_performance': 'no_data'
            }

        # å®Œæ•´æ­·å²å‹ç‡
        completed_trades = [t for t in self.trade_history if t.pnl is not None]
        if not completed_trades:
            return {
                'win_rate': 0.0,
                'consecutive_losses': 0,
                'recent_win_rate': 0.0,
                'trading_performance': 'no_completed_trades'
            }

        winning_trades = [t for t in completed_trades if t.pnl &gt; 0]
        overall_win_rate = len(winning_trades) / len(completed_trades) * 100

        # æœ€è¿‘äº¤æ˜“å‹ç‡
        recent_trades = completed_trades[-self.lookback_trades:]
        recent_winning = [t for t in recent_trades if t.pnl &gt; 0]
        recent_win_rate = len(recent_winning) / len(recent_trades) * 100 if recent_trades else 0

        # é€£çºŒè™§æ
        consecutive_losses = 0
        for trade in reversed(completed_trades):
            if trade.pnl &lt; 0:
                consecutive_losses += 1
            else:
                break

        # äº¤æ˜“è¡¨ç¾è©•ä¼°
        trading_performance = 'normal'
        if recent_win_rate &lt; self.min_win_rate:
            trading_performance = 'poor'
        elif consecutive_losses &gt; self.max_consecutive_losses:
            trading_performance = 'critical'
        elif recent_win_rate &lt; self.min_win_rate * 0.8:
            trading_performance = 'warning'

        return {
            'win_rate': overall_win_rate,
            'consecutive_losses': consecutive_losses,
            'recent_win_rate': recent_win_rate,
            'trading_performance': trading_performance,
            'completed_trades': len(completed_trades),
            'recent_trades': len(recent_trades)
        }

    def calculate_profit_loss_metrics(self) -&gt; Dict:
        &quot;&quot;&quot;
        è¨ˆç®—ç›ˆè™§æ¯”ç›¸é—œæŒ‡æ¨™

        Returns:
        --------
        Dict
            ç›ˆè™§æ¯”æŒ‡æ¨™
        &quot;&quot;&quot;
        completed_trades = [t for t in self.trade_history if t.pnl is not None]
        if not completed_trades:
            return {
                'profit_loss_ratio': 0.0,
                'avg_win': 0.0,
                'avg_loss': 0.0,
                'largest_loss': 0.0,
                'risk_performance': 'no_data'
            }

        winning_trades = [t for t in completed_trades if t.pnl &gt; 0]
        losing_trades = [t for t in completed_trades if t.pnl &lt; 0]

        avg_win = np.mean([t.pnl for t in winning_trades]) if winning_trades else 0
        avg_loss = np.mean([abs(t.pnl) for t in losing_trades]) if losing_trades else 0

        profit_loss_ratio = abs(avg_win / avg_loss) if avg_loss &gt; 0 else 0
        largest_loss = min([t.pnl for t in losing_trades]) if losing_trades else 0

        # é¢¨éšªè¡¨ç¾è©•ä¼°
        risk_performance = 'normal'
        if profit_loss_ratio &lt; self.min_profit_loss_ratio:
            risk_performance = 'poor'
        elif abs(largest_loss) &gt; avg_loss * self.max_loss_multiplier:
            risk_performance = 'critical'
        elif profit_loss_ratio &lt; self.min_profit_loss_ratio * 1.2:
            risk_performance = 'warning'

        return {
            'profit_loss_ratio': profit_loss_ratio,
            'avg_win': avg_win,
            'avg_loss': avg_loss,
            'largest_loss': largest_loss,
            'risk_performance': risk_performance
        }

    def calculate_drawdown_metrics(self) -&gt; Dict:
        &quot;&quot;&quot;
        è¨ˆç®—å›æ’¤ç›¸é—œæŒ‡æ¨™

        Returns:
        --------
        Dict
            å›æ’¤æŒ‡æ¨™
        &quot;&quot;&quot;
        if not self.equity_curve:
            return {
                'current_drawdown': 0.0,
                'max_drawdown': 0.0,
                'drawdown_duration': 0,
                'drawdown_status': 'no_data'
            }

        equity_series = pd.Series([e['equity'] for e in self.equity_curve])
        timestamps = pd.to_datetime([e['timestamp'] for e in self.equity_curve])

        # è¨ˆç®—å›æ’¤
        running_max = equity_series.expanding().max()
        drawdown = (equity_series - running_max) / running_max * 100

        current_drawdown = drawdown.iloc[-1]
        max_drawdown = drawdown.min()

        # è¨ˆç®—å›æ’¤æŒçºŒæ™‚é–“
        in_drawdown = drawdown &lt; -1.0  # 1% ä»¥å…§èªç‚ºæ˜¯å›æ’¤
        drawdown_start = None
        drawdown_duration = 0

        for i, is_dd in enumerate(in_drawdown):
            if is_dd and drawdown_start is None:
                drawdown_start = i
            elif not is_dd and drawdown_start is not None:
                duration = i - drawdown_start
                drawdown_duration = max(drawdown_duration, duration)
                drawdown_start = None

        # è©•ä¼°å›æ’¤ç‹€æ…‹
        drawdown_status = 'normal'
        if current_drawdown &lt; self.max_drawdown_threshold:
            drawdown_status = 'critical'
        elif current_drawdown &lt; self.max_drawdown_threshold * 0.7:
            drawdown_status = 'warning'
        elif max_drawdown &lt; self.max_drawdown_threshold * 0.5:
            drawdown_status = 'poor'

        return {
            'current_drawdown': current_drawdown,
            'max_drawdown': max_drawdown,
            'drawdown_duration': drawdown_duration,
            'drawdown_status': drawdown_status
        }

    def calculate_signal_quality_metrics(self) -&gt; Dict:
        &quot;&quot;&quot;
        è¨ˆç®—ä¿¡è™Ÿè³ªé‡ç›¸é—œæŒ‡æ¨™

        Returns:
        --------
        Dict
            ä¿¡è™Ÿè³ªé‡æŒ‡æ¨™
        &quot;&quot;&quot;
        if not self.signal_history:
            return {
                'high_conf_win_rate': 0.0,
                'signal_frequency': 0.0,
                'signal_quality': 'no_data'
            }

        # ä¿¡è™Ÿé »ç‡
        if len(self.signal_history) &gt; 1:
            time_diffs = []
            for i in range(1, len(self.signal_history)):
                diff = (self.signal_history[i]['timestamp'] - 
                       self.signal_history[i-1]['timestamp']).total_seconds() / 3600  # å°æ™‚
                time_diffs.append(diff)
            avg_signal_frequency = np.mean(time_diffs) if time_diffs else 0
        else:
            avg_signal_frequency = 0

        # é«˜ç½®ä¿¡åº¦ä¿¡è™Ÿå‹ç‡
        high_conf_signals = [s for s in self.signal_history if s.get('confidence') == 'é«˜']
        if high_conf_signals:
            # æ‰¾åˆ°å°æ‡‰çš„äº¤æ˜“è¨˜éŒ„
            high_conf_trades = []
            for signal in high_conf_signals:
                matching_trades = [
                    t for t in self.trade_history 
                    if (t.symbol == signal.get('signal_type', '') and
                        abs((t.timestamp - signal['timestamp']).total_seconds()) &lt; 3600)  # 1å°æ™‚å…§
                ]
                high_conf_trades.extend(matching_trades)

            completed_high_conf_trades = [t for t in high_conf_trades if t.pnl is not None]
            if completed_high_conf_trades:
                high_conf_winning = [t for t in completed_high_conf_trades if t.pnl &gt; 0]
                high_conf_win_rate = len(high_conf_winning) / len(completed_high_conf_trades) * 100
            else:
                high_conf_win_rate = 0
        else:
            high_conf_win_rate = 0

        # ä¿¡è™Ÿè³ªé‡è©•ä¼°
        signal_quality = 'normal'
        if high_conf_win_rate &lt; self.min_high_conf_win_rate:
            signal_quality = 'poor'
        elif avg_signal_frequency &gt; 100:  # è¶…é 100 å°æ™‚æ²’æœ‰ä¿¡è™Ÿ
            signal_quality = 'low_frequency'
        elif avg_signal_frequency &lt; 1:   # é »ç‡éé«˜ï¼ˆä¸åˆ° 1 å°æ™‚ï¼‰
            signal_quality = 'high_frequency'

        return {
            'high_conf_win_rate': high_conf_win_rate,
            'signal_frequency': avg_signal_frequency,
            'signal_quality': signal_quality,
            'total_signals': len(self.signal_history),
            'high_conf_signals': len(high_conf_signals)
        }

    def check_all_alerts(self) -&gt; List[AlertMessage]:
        &quot;&quot;&quot;
        æª¢æŸ¥æ‰€æœ‰é è­¦æ¢ä»¶

        Returns:
        --------
        List[AlertMessage]
            é è­¦æ¶ˆæ¯åˆ—è¡¨
        &quot;&quot;&quot;
        alerts = []

        # 1. å‹ç‡é è­¦
        win_rate_metrics = self.calculate_win_rate_metrics()
        if win_rate_metrics['recent_win_rate'] &lt; self.min_win_rate:
            alert = AlertMessage(
                timestamp=datetime.now(),
                severity=AlertSeverity.HIGH,
                message=f&quot;å‹ç‡éä½ï¼š{win_rate_metrics['recent_win_rate']:.1f}% &lt; {self.min_win_rate}%&quot;,
                metric_name=&quot;win_rate&quot;,
                current_value=win_rate_metrics['recent_win_rate'],
                threshold=self.min_win_rate,
                action_level=ActionLevel.STOP_ALL if win_rate_metrics['recent_win_rate'] &lt; 35 else ActionLevel.REDUCE_25
            )
            alerts.append(alert)

        if win_rate_metrics['consecutive_losses'] &gt; self.max_consecutive_losses:
            alert = AlertMessage(
                timestamp=datetime.now(),
                severity=AlertSeverity.HIGH,
                message=f&quot;é€£çºŒè™§æéå¤šï¼š{win_rate_metrics['consecutive_losses']} ç­†&quot;,
                metric_name=&quot;consecutive_losses&quot;,
                current_value=win_rate_metrics['consecutive_losses'],
                threshold=self.max_consecutive_losses,
                action_level=ActionLevel.STOP_ALL
            )
            alerts.append(alert)

        # 2. ç›ˆè™§æ¯”é è­¦
        pl_metrics = self.calculate_profit_loss_metrics()
        if pl_metrics['profit_loss_ratio'] &lt; self.min_profit_loss_ratio:
            alert = AlertMessage(
                timestamp=datetime.now(),
                severity=AlertSeverity.MEDIUM,
                message=f&quot;ç›ˆè™§æ¯”éä½ï¼š{pl_metrics['profit_loss_ratio']:.2f} &lt; {self.min_profit_loss_ratio}&quot;,
                metric_name=&quot;profit_loss_ratio&quot;,
                current_value=pl_metrics['profit_loss_ratio'],
                threshold=self.min_profit_loss_ratio,
                action_level=ActionLevel.REDUCE_50
            )
            alerts.append(alert)

        if abs(pl_metrics['largest_loss']) &gt; pl_metrics['avg_loss'] * self.max_loss_multiplier:
            alert = AlertMessage(
                timestamp=datetime.now(),
                severity=AlertSeverity.MEDIUM,
                message=f&quot;æœ€å¤§è™§æéå¤§ï¼š{pl_metrics['largest_loss']:.2f}&quot;,
                metric_name=&quot;largest_loss&quot;,
                current_value=pl_metrics['largest_loss'],
                threshold=pl_metrics['avg_loss'] * self.max_loss_multiplier,
                action_level=ActionLevel.REDUCE_25
            )
            alerts.append(alert)

        # 3. å›æ’¤é è­¦
        dd_metrics = self.calculate_drawdown_metrics()
        if dd_metrics['current_drawdown'] &lt; self.max_drawdown_threshold:
            alert = AlertMessage(
                timestamp=datetime.now(),
                severity=AlertSeverity.HIGH,
                message=f&quot;å›æ’¤è¶…æ¨™ï¼š{dd_metrics['current_drawdown']:.1f}% &lt; {self.max_drawdown_threshold}%&quot;,
                metric_name=&quot;drawdown&quot;,
                current_value=dd_metrics['current_drawdown'],
                threshold=self.max_drawdown_threshold,
                action_level=ActionLevel.STOP_ALL
            )
            alerts.append(alert)

        # 4. ä¿¡è™Ÿè³ªé‡é è­¦
        sq_metrics = self.calculate_signal_quality_metrics()
        if sq_metrics['high_conf_win_rate'] &lt; self.min_high_conf_win_rate:
            alert = AlertMessage(
                timestamp=datetime.now(),
                severity=AlertSeverity.MEDIUM,
                message=f&quot;é«˜ç½®ä¿¡åº¦ä¿¡è™Ÿå‹ç‡ä½ï¼š{sq_metrics['high_conf_win_rate']:.1f}% &lt; {self.min_high_conf_win_rate}%&quot;,
                metric_name=&quot;high_conf_win_rate&quot;,
                current_value=sq_metrics['high_conf_win_rate'],
                threshold=self.min_high_conf_win_rate,
                action_level=ActionLevel.REDUCE_50
            )
            alerts.append(alert)

        # è¨˜éŒ„é è­¦æ­·å²
        self.alert_history.extend(alerts)

        return alerts

    def evaluate_severity(self, alerts: List[AlertMessage]) -&gt; Tuple[AlertSeverity, ActionLevel]:
        &quot;&quot;&quot;
        è©•ä¼°é è­¦çš„æ•´é«”åš´é‡ç¨‹åº¦å’Œæ‡‰å°æªæ–½

        Parameters:
        -----------
        alerts : List[AlertMessage]
            é è­¦æ¶ˆæ¯åˆ—è¡¨

        Returns:
        --------
        Tuple[AlertSeverity, ActionLevel]
            (åš´é‡ç¨‹åº¦, æ‡‰å°æªæ–½)
        &quot;&quot;&quot;
        if not alerts:
            return AlertSeverity.INFO, ActionLevel.CONTINUE

        # è¨ˆç®—åš´é‡ç¨‹åº¦åˆ†æ•¸
        severity_score = 0
        high_severity_count = 0
        medium_severity_count = 0

        for alert in alerts:
            if alert.severity == AlertSeverity.HIGH:
                severity_score += 3
                high_severity_count += 1
            elif alert.severity == AlertSeverity.MEDIUM:
                severity_score += 2
                medium_severity_count += 1
            elif alert.severity == AlertSeverity.LOW:
                severity_score += 1

        # ç¢ºå®šæ•´é«”åš´é‡ç¨‹åº¦
        if high_severity_count &gt;= 2:
            overall_severity = AlertSeverity.HIGH
        elif high_severity_count &gt;= 1 or medium_severity_count &gt;= 2:
            overall_severity = AlertSeverity.MEDIUM
        elif medium_severity_count &gt;= 1 or severity_score &gt;= 3:
            overall_severity = AlertSeverity.LOW
        else:
            overall_severity = AlertSeverity.INFO

        # ç¢ºå®šæ‡‰å°æªæ–½
        if overall_severity == AlertSeverity.HIGH:
            action_level = ActionLevel.STOP_ALL
        elif overall_severity == AlertSeverity.MEDIUM:
            action_level = ActionLevel.REDUCE_25
        elif overall_severity == AlertSeverity.LOW:
            action_level = ActionLevel.REDUCE_50
        else:
            action_level = ActionLevel.CONTINUE

        return overall_severity, action_level

    def execute_response(self, action_level: ActionLevel):
        &quot;&quot;&quot;
        åŸ·è¡Œæ‡‰å°æªæ–½

        Parameters:
        -----------
        action_level : ActionLevel
            æ‡‰å°æªæ–½ç´šåˆ¥
        &quot;&quot;&quot;
        self.current_action_level = action_level

        if action_level == ActionLevel.CONTINUE:
            self.position_multiplier = 1.0
            self.is_active = True
            self.logger.info(&quot;ç³»çµ±æ¢å¾©æ­£å¸¸äº¤æ˜“ç‹€æ…‹&quot;)

        elif action_level == ActionLevel.REDUCE_50:
            self.position_multiplier = 0.5
            self.is_active = True
            self.logger.warning(f&quot;é™ä½å€‰ä½è‡³ 50%ï¼ˆç•¶å‰å€æ•¸ï¼š{self.position_multiplier}ï¼‰&quot;)

        elif action_level == ActionLevel.REDUCE_25:
            self.position_multiplier = 0.25
            self.is_active = True
            self.logger.warning(f&quot;é™ä½å€‰ä½è‡³ 25%ï¼ˆç•¶å‰å€æ•¸ï¼š{self.position_multiplier}ï¼‰&quot;)

        elif action_level == ActionLevel.STOP_ALL:
            self.position_multiplier = 0.0
            self.is_active = False
            self.logger.error(&quot;åœæ­¢æ‰€æœ‰äº¤æ˜“ï¼Œå¹³å€‰ç¾æœ‰é ­å¯¸&quot;)

    def send_notification(self, alerts: List[AlertMessage], severity: AlertSeverity):
        &quot;&quot;&quot;
        ç™¼é€é€šçŸ¥

        Parameters:
        -----------
        alerts : List[AlertMessage]
            é è­¦æ¶ˆæ¯åˆ—è¡¨
        severity : AlertSeverity
            åš´é‡ç¨‹åº¦
        &quot;&quot;&quot;
        # æ§‹å»ºé€šçŸ¥æ¶ˆæ¯
        alert_messages = [alert.message for alert in alerts]
        subject = f&quot;ã€è¶¨å‹¢ç­–ç•¥é è­¦ã€‘{severity.value.upper()} - {len(alerts)} å€‹é è­¦&quot;
        body = f&quot;åš´é‡ç¨‹åº¦ï¼š{severity.value}\n\né è­¦è©³æƒ…ï¼š\n&quot; + &quot;\n&quot;.join(f&quot;â€¢ {msg}&quot; for msg in alert_messages)

        self.logger.warning(f&quot;ç™¼é€é è­¦é€šçŸ¥ï¼š{subject}&quot;)
        self.logger.warning(body)

        # TODO: å¯¦ç¾éƒµä»¶é€šçŸ¥
        if self.enable_email and self.email_recipients:
            self._send_email_notification(subject, body)

        # TODO: å¯¦ç¾ Telegram é€šçŸ¥
        if self.enable_telegram and self.telegram_chat_id:
            self._send_telegram_notification(subject, body)

    def _send_email_notification(self, subject: str, body: str):
        &quot;&quot;&quot;
        ç™¼é€éƒµä»¶é€šçŸ¥ï¼ˆå¯¦ç¾éœ€è¦ï¼‰
        &quot;&quot;&quot;
        # é€™è£¡éœ€è¦å¯¦ç¾éƒµä»¶ç™¼é€åŠŸèƒ½
        # å¯ä»¥ä½¿ç”¨ smtplib æˆ–ç¬¬ä¸‰æ–¹éƒµä»¶æœå‹™
        self.logger.info(&quot;éƒµä»¶é€šçŸ¥åŠŸèƒ½éœ€è¦å¯¦ç¾&quot;)

    def _send_telegram_notification(self, subject: str, body: str):
        &quot;&quot;&quot;
        ç™¼é€ Telegram é€šçŸ¥ï¼ˆå¯¦ç¾éœ€è¦ï¼‰
        &quot;&quot;&quot;
        # é€™è£¡éœ€è¦å¯¦ç¾ Telegram æ©Ÿå™¨äººé€šçŸ¥åŠŸèƒ½
        self.logger.info(&quot;Telegram é€šçŸ¥åŠŸèƒ½éœ€è¦å¯¦ç¾&quot;)

    def monitor_and_respond(self) -&gt; Dict:
        &quot;&quot;&quot;
        åŸ·è¡Œå®Œæ•´çš„ç›£æ§å’Œæ‡‰å°æµç¨‹

        Returns:
        --------
        Dict
            ç›£æ§çµæœ
        &quot;&quot;&quot;
        # 1. æª¢æŸ¥æ‰€æœ‰é è­¦
        alerts = self.check_all_alerts()

        # 2. è©•ä¼°åš´é‡ç¨‹åº¦
        severity, action_level = self.evaluate_severity(alerts)

        # 3. åŸ·è¡Œæ‡‰å°æªæ–½
        self.execute_response(action_level)

        # 4. ç™¼é€é€šçŸ¥
        if alerts:
            self.send_notification(alerts, severity)

        # 5. è¿”å›ç›£æ§çµæœ
        return {
            'timestamp': datetime.now(),
            'alerts_count': len(alerts),
            'severity': severity.value,
            'action_level': action_level.value,
            'position_multiplier': self.position_multiplier,
            'is_active': self.is_active,
            'alerts': alerts
        }

    def get_system_status(self) -&gt; Dict:
        &quot;&quot;&quot;
        ç²å–ç³»çµ±ç•¶å‰ç‹€æ…‹

        Returns:
        --------
        Dict
            ç³»çµ±ç‹€æ…‹
        &quot;&quot;&quot;
        win_rate_metrics = self.calculate_win_rate_metrics()
        pl_metrics = self.calculate_profit_loss_metrics()
        dd_metrics = self.calculate_drawdown_metrics()
        sq_metrics = self.calculate_signal_quality_metrics()

        return {
            'system_status': 'active' if self.is_active else 'stopped',
            'action_level': self.current_action_level.value,
            'position_multiplier': self.position_multiplier,
            'total_trades': len(self.trade_history),
            'completed_trades': len([t for t in self.trade_history if t.pnl is not None]),
            'total_alerts': len(self.alert_history),
            'metrics': {
                'win_rate': win_rate_metrics,
                'profit_loss': pl_metrics,
                'drawdown': dd_metrics,
                'signal_quality': sq_metrics
            },
            'recent_alerts': self.alert_history[-5:] if self.alert_history else []
        }

    def generate_report(self, period_days: int = 30) -&gt; str:
        &quot;&quot;&quot;
        ç”Ÿæˆç›£æ§å ±å‘Š

        Parameters:
        -----------
        period_days : int
            å ±å‘ŠæœŸé–“ï¼ˆå¤©æ•¸ï¼‰

        Returns:
        --------
        str
            å ±å‘Šå…§å®¹
        &quot;&quot;&quot;
        end_date = datetime.now()
        start_date = end_date - timedelta(days=period_days)

        # ç¯©é¸æœŸé–“å…§çš„æ•¸æ“š
        period_trades = [
            t for t in self.trade_history
            if start_date &lt;= t.timestamp &lt;= end_date and t.pnl is not None
        ]

        period_alerts = [
            a for a in self.alert_history
            if start_date &lt;= a.timestamp &lt;= end_date
        ]

        # è¨ˆç®—æœŸé–“çµ±è¨ˆ
        if period_trades:
            winning_trades = [t for t in period_trades if t.pnl &gt; 0]
            total_pnl = sum(t.pnl for t in period_trades)
            win_rate = len(winning_trades) / len(period_trades) * 100
            avg_pnl = total_pnl / len(period_trades)
        else:
            winning_trades = []
            total_pnl = 0
            win_rate = 0
            avg_pnl = 0

        # ç”Ÿæˆå ±å‘Š
        report = f&quot;&quot;&quot;
è¶¨å‹¢ç­–ç•¥å¤±æ•ˆç›£æ§å ±å‘Š
å ±å‘ŠæœŸé–“ï¼š{start_date.strftime('%Y-%m-%d')} è‡³ {end_date.strftime('%Y-%m-%d')}

=== åŸºæœ¬çµ±è¨ˆ ===
äº¤æ˜“ç­†æ•¸ï¼š{len(period_trades)}
å‹ç‡ï¼š{win_rate:.1f}%
ç¸½ç›ˆè™§ï¼š{total_pnl:.2f}
å¹³å‡ç›ˆè™§ï¼š{avg_pnl:.2f}

=== é è­¦çµ±è¨ˆ ===
é è­¦æ¬¡æ•¸ï¼š{len(period_alerts)}
é«˜é¢¨éšªé è­¦ï¼š{len([a for a in period_alerts if a.severity == AlertSeverity.HIGH])}
ä¸­é¢¨éšªé è­¦ï¼š{len([a for a in period_alerts if a.severity == AlertSeverity.MEDIUM])}
ä½é¢¨éšªé è­¦ï¼š{len([a for a in period_alerts if a.severity == AlertSeverity.LOW])}

=== ç³»çµ±ç‹€æ…‹ ===
ç•¶å‰ç‹€æ…‹ï¼š{'æ´»èº' if self.is_active else 'åœæ­¢'}
ç•¶å‰æªæ–½ï¼š{self.current_action_level.value}
å€‰ä½å€æ•¸ï¼š{self.position_multiplier}
&quot;&quot;&quot;

        return report

    def reset_monitor(self):
        &quot;&quot;&quot;
        é‡ç½®ç›£æ§ç³»çµ±ï¼ˆç”¨æ–¼æ¸¬è©¦æˆ–é‡æ–°é–‹å§‹ï¼‰
        &quot;&quot;&quot;
        self.current_action_level = ActionLevel.CONTINUE
        self.position_multiplier = 1.0
        self.is_active = True
        self.alert_history = []
        self.logger.info(&quot;ç›£æ§ç³»çµ±å·²é‡ç½®&quot;)
</code></pre>
<h3 id="2_1">2. ä½¿ç”¨ç¯„ä¾‹<a class="headerlink" href="#2_1" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<pre><code class="language-python">import yfinance as yf
from datetime import datetime, timedelta
import pandas as pd

def demo_failure_monitor():
    &quot;&quot;&quot;
    æ¼”ç¤ºå¤±æ•ˆç›£æ§ç³»çµ±çš„ä½¿ç”¨
    &quot;&quot;&quot;
    # 1. åˆå§‹åŒ–ç›£æ§ç³»çµ±
    monitor = FailureMonitorSystem(
        min_win_rate=45.0,
        lookback_trades=20,
        max_consecutive_losses=5,
        min_profit_loss_ratio=1.0,
        max_drawdown_threshold=-15.0,
        min_high_conf_win_rate=60.0,
        enable_email=False,
        enable_telegram=False
    )

    # 2. æ¨¡æ“¬ä¸€äº›äº¤æ˜“è¨˜éŒ„ï¼ˆæ­£å¸¸æƒ…æ³ï¼‰
    print(&quot;=== æ¨¡æ“¬æ­£å¸¸äº¤æ˜“ ===&quot;)
    normal_trades = [
        TradeRecord(
            timestamp=datetime.now() - timedelta(days=10),
            symbol=&quot;AAPL&quot;,
            action=&quot;buy&quot;,
            entry_price=150.0,
            exit_price=155.0,
            pnl=500.0,
            confidence=&quot;é«˜&quot;,
            position_size=1.0
        ),
        TradeRecord(
            timestamp=datetime.now() - timedelta(days=9),
            symbol=&quot;AAPL&quot;,
            action=&quot;sell&quot;,
            entry_price=152.0,
            exit_price=148.0,
            pnl=400.0,
            confidence=&quot;ä¸­&quot;,
            position_size=1.0
        ),
        TradeRecord(
            timestamp=datetime.now() - timedelta(days=8),
            symbol=&quot;AAPL&quot;,
            action=&quot;buy&quot;,
            entry_price=149.0,
            exit_price=145.0,
            pnl=-400.0,
            confidence=&quot;é«˜&quot;,
            position_size=1.0
        )
    ]

    for trade in normal_trades:
        monitor.add_trade(trade)

    # 3. æ¨¡æ“¬è³‡é‡‘æ›²ç·š
    initial_equity = 100000
    equity_values = [initial_equity]
    for i in range(30):
        equity_values.append(equity_values[-1] * (1 + np.random.normal(0.001, 0.02)))

    for i, equity in enumerate(equity_values):
        timestamp = datetime.now() - timedelta(days=30-i)
        monitor.update_equity(equity, timestamp)

    # 4. åŸ·è¡Œç›£æ§ï¼ˆæ‡‰è©²æ²’æœ‰é è­¦ï¼‰
    result = monitor.monitor_and_respond()
    print(f&quot;æ­£å¸¸æƒ…æ³ç›£æ§çµæœï¼š{result['alerts_count']} å€‹é è­¦&quot;)
    print(f&quot;ç³»çµ±ç‹€æ…‹ï¼š{result['action_level']}&quot;)

    # 5. æ¨¡æ“¬ç­–ç•¥å¤±æ•ˆå ´æ™¯
    print(&quot;\n=== æ¨¡æ“¬ç­–ç•¥å¤±æ•ˆ ===&quot;)
    failure_trades = [
        TradeRecord(
            timestamp=datetime.now() - timedelta(days=7),
            symbol=&quot;AAPL&quot;,
            action=&quot;buy&quot;,
            entry_price=146.0,
            exit_price=142.0,
            pnl=-400.0,
            confidence=&quot;é«˜&quot;,
            position_size=1.0
        ),
        TradeRecord(
            timestamp=datetime.now() - timedelta(days=6),
            symbol=&quot;AAPL&quot;,
            action=&quot;buy&quot;,
            entry_price=143.0,
            exit_price=139.0,
            pnl=-400.0,
            confidence=&quot;é«˜&quot;,
            position_size=1.0
        ),
        TradeRecord(
            timestamp=datetime.now() - timedelta(days=5),
            symbol=&quot;AAPL&quot;,
            action=&quot;buy&quot;,
            entry_price=140.0,
            exit_price=136.0,
            pnl=-400.0,
            confidence=&quot;é«˜&quot;,
            position_size=1.0
        ),
        TradeRecord(
            timestamp=datetime.now() - timedelta(days=4),
            symbol=&quot;AAPL&quot;,
            action=&quot;buy&quot;,
            entry_price=137.0,
            exit_price=133.0,
            pnl=-400.0,
            confidence=&quot;é«˜&quot;,
            position_size=1.0
        ),
        TradeRecord(
            timestamp=datetime.now() - timedelta(days=3),
            symbol=&quot;AAPL&quot;,
            action=&quot;buy&quot;,
            entry_price=134.0,
            exit_price=130.0,
            pnl=-400.0,
            confidence=&quot;é«˜&quot;,
            position_size=1.0
        ),
        TradeRecord(
            timestamp=datetime.now() - timedelta(days=2),
            symbol=&quot;AAPL&quot;,
            action=&quot;buy&quot;,
            entry_price=131.0,
            exit_price=125.0,
            pnl=-600.0,
            confidence=&quot;é«˜&quot;,
            position_size=1.0
        )
    ]

    for trade in failure_trades:
        monitor.add_trade(trade)

    # æ¨¡æ“¬å›æ’¤
    for i in range(10):
        equity = equity_values[-1] * (0.98 - i * 0.005)  # æŒçºŒä¸‹è·Œ
        monitor.update_equity(equity)

    # 6. å†æ¬¡åŸ·è¡Œç›£æ§ï¼ˆæ‡‰è©²è§¸ç™¼é è­¦ï¼‰
    result = monitor.monitor_and_respond()
    print(f&quot;å¤±æ•ˆæƒ…æ³ç›£æ§çµæœï¼š{result['alerts_count']} å€‹é è­¦&quot;)
    print(f&quot;åš´é‡ç¨‹åº¦ï¼š{result['severity']}&quot;)
    print(f&quot;æ‡‰å°æªæ–½ï¼š{result['action_level']}&quot;)
    print(f&quot;å€‰ä½å€æ•¸ï¼š{result['position_multiplier']}&quot;)

    # 7. é¡¯ç¤ºé è­¦è©³æƒ…
    for alert in result['alerts']:
        print(f&quot;é è­¦ï¼š{alert.message}&quot;)

    # 8. ç”Ÿæˆç‹€æ…‹å ±å‘Š
    status = monitor.get_system_status()
    print(f&quot;\n=== ç³»çµ±ç‹€æ…‹ ===&quot;)
    print(f&quot;ç³»çµ±ç‹€æ…‹ï¼š{status['system_status']}&quot;)
    print(f&quot;ç•¶å‰æªæ–½ï¼š{status['action_level']}&quot;)
    print(f&quot;æœ€è¿‘å‹ç‡ï¼š{status['metrics']['win_rate']['recent_win_rate']:.1f}%&quot;)
    print(f&quot;ç•¶å‰å›æ’¤ï¼š{status['metrics']['drawdown']['current_drawdown']:.1f}%&quot;)

    # 9. ç”Ÿæˆç›£æ§å ±å‘Š
    report = monitor.generate_report(30)
    print(f&quot;\n=== ç›£æ§å ±å‘Š ===&quot;)
    print(report)

    return monitor

# é‹è¡Œæ¼”ç¤º
if __name__ == &quot;__main__&quot;:
    demo_monitor = demo_failure_monitor()
</code></pre>
<h3 id="3_1">3. å›æ¸¬é›†æˆç¤ºä¾‹<a class="headerlink" href="#3_1" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<pre><code class="language-python">class BacktestWithMonitor:
    &quot;&quot;&quot;
    é›†æˆç›£æ§ç³»çµ±çš„å›æ¸¬å™¨
    &quot;&quot;&quot;

    def __init__(self, strategy, initial_capital=100000):
        &quot;&quot;&quot;
        åˆå§‹åŒ–å›æ¸¬å™¨

        Parameters:
        -----------
        strategy : object
            äº¤æ˜“ç­–ç•¥å°è±¡
        initial_capital : float
            åˆå§‹è³‡é‡‘
        &quot;&quot;&quot;
        self.strategy = strategy
        self.initial_capital = initial_capital
        self.current_capital = initial_capital
        self.position = 0
        self.trades = []
        self.equity_curve = []

        # åˆå§‹åŒ–ç›£æ§ç³»çµ±
        self.monitor = FailureMonitorSystem(
            min_win_rate=45.0,
            max_drawdown_threshold=-20.0,
            min_profit_loss_ratio=1.2
        )

    def run_backtest(self, data):
        &quot;&quot;&quot;
        é‹è¡Œå›æ¸¬

        Parameters:
        -----------
        data : pd.DataFrame
            åƒ¹æ ¼æ•¸æ“š

        Returns:
        --------
        Dict
            å›æ¸¬çµæœ
        &quot;&quot;&quot;
        for i in range(len(data)):
            current_price = data.iloc[i]['Close']
            current_time = data.index[i]

            # æ›´æ–°è³‡é‡‘æ›²ç·š
            if self.position != 0:
                unrealized_pnl = self.position * (current_price - self.entry_price)
                current_equity = self.current_capital + unrealized_pnl
            else:
                current_equity = self.current_capital

            self.equity_curve.append({
                'timestamp': current_time,
                'equity': current_equity
            })

            # æ›´æ–°ç›£æ§ç³»çµ±
            self.monitor.update_equity(current_equity, current_time)

            # ç”Ÿæˆç­–ç•¥ä¿¡è™Ÿ
            signal = self.strategy.generate_signal(data.iloc[:i+1])

            # æ ¹æ“šç›£æ§ç³»çµ±èª¿æ•´å€‰ä½
            monitor_result = self.monitor.monitor_and_respond()
            position_multiplier = monitor_result['position_multiplier']

            if signal['action'] == 'buy' and self.position &lt;= 0:
                # è€ƒæ…®ç›£æ§ç³»çµ±çš„å€‰ä½é™åˆ¶
                if monitor_result['is_active']:
                    target_position = int(self.current_capital * position_multiplier / current_price)
                    self._execute_buy(current_price, current_time, target_position, signal)

            elif signal['action'] == 'sell' and self.position &gt;= 0:
                if monitor_result['is_active']:
                    target_position = -int(self.current_capital * position_multiplier / current_price)
                    self._execute_sell(current_price, current_time, target_position, signal)

            # æª¢æŸ¥æ­¢æ
            if self.position != 0:
                if self._check_stop_loss(current_price):
                    self._close_position(current_price, current_time, &quot;stop_loss&quot;)

        # è¨ˆç®—ç¸¾æ•ˆ
        performance = self._calculate_performance()

        # ç”Ÿæˆç›£æ§å ±å‘Š
        monitor_report = self.monitor.generate_report(len(data))

        return {
            'performance': performance,
            'monitor_report': monitor_report,
            'trades': self.trades,
            'equity_curve': self.equity_curve,
            'monitor_status': self.monitor.get_system_status()
        }

    def _execute_buy(self, price, time, quantity, signal):
        &quot;&quot;&quot;åŸ·è¡Œè²·å…¥&quot;&quot;&quot;
        if quantity &gt; 0:
            self.position = quantity
            self.entry_price = price
            cost = quantity * price
            if cost &gt; self.current_capital:
                quantity = int(self.current_capital / price)
                cost = quantity * price
                self.position = quantity

            # è¨˜éŒ„äº¤æ˜“
            trade = TradeRecord(
                timestamp=time,
                symbol=signal.get('symbol', 'UNKNOWN'),
                action='buy',
                entry_price=price,
                confidence=signal.get('confidence', 'unknown'),
                position_size=quantity
            )
            self.trades.append(trade)
            self.monitor.add_trade(trade)

    def _execute_sell(self, price, time, quantity, signal):
        &quot;&quot;&quot;åŸ·è¡Œè³£å‡º&quot;&quot;&quot;
        if abs(quantity) &gt; 0:
            self.position = quantity
            self.entry_price = price

            # è¨˜éŒ„äº¤æ˜“
            trade = TradeRecord(
                timestamp=time,
                symbol=signal.get('symbol', 'UNKNOWN'),
                action='sell',
                entry_price=price,
                confidence=signal.get('confidence', 'unknown'),
                position_size=abs(quantity)
            )
            self.trades.append(trade)
            self.monitor.add_trade(trade)

    def _close_position(self, price, time, reason):
        &quot;&quot;&quot;å¹³å€‰&quot;&quot;&quot;
        if self.position != 0:
            pnl = self.position * (price - self.entry_price)
            self.current_capital += pnl

            # æ›´æ–°æœ€å¾Œä¸€ç­†äº¤æ˜“
            if self.trades:
                last_trade = self.trades[-1]
                last_trade.exit_price = price
                last_trade.pnl = pnl
                last_trade.exit_reason = reason

            self.position = 0

    def _check_stop_loss(self, price):
        &quot;&quot;&quot;æª¢æŸ¥æ­¢æ&quot;&quot;&quot;
        # ç°¡å–®çš„æ­¢æé‚è¼¯ï¼šè™§æè¶…é 2%
        if self.position &gt; 0 and price &lt; self.entry_price * 0.98:
            return True
        elif self.position &lt; 0 and price &gt; self.entry_price * 1.02:
            return True
        return False

    def _calculate_performance(self):
        &quot;&quot;&quot;è¨ˆç®—å›æ¸¬ç¸¾æ•ˆ&quot;&quot;&quot;
        completed_trades = [t for t in self.trades if t.pnl is not None]

        if not completed_trades:
            return {
                'total_return': 0,
                'win_rate': 0,
                'sharpe_ratio': 0,
                'max_drawdown': 0
            }

        total_pnl = sum(t.pnl for t in completed_trades)
        total_return = (total_pnl / self.initial_capital) * 100

        winning_trades = [t for t in completed_trades if t.pnl &gt; 0]
        win_rate = len(winning_trades) / len(completed_trades) * 100

        # è¨ˆç®—å¤æ™®æ¯”ç‡ï¼ˆç°¡åŒ–ç‰ˆï¼‰
        equity_series = pd.Series([e['equity'] for e in self.equity_curve])
        returns = equity_series.pct_change().dropna()
        sharpe_ratio = (returns.mean() / returns.std()) * np.sqrt(252) if len(returns) &gt; 1 else 0

        # è¨ˆç®—æœ€å¤§å›æ’¤
        running_max = equity_series.expanding().max()
        drawdown = (equity_series - running_max) / running_max * 100
        max_drawdown = drawdown.min()

        return {
            'total_return': total_return,
            'win_rate': win_rate,
            'sharpe_ratio': sharpe_ratio,
            'max_drawdown': max_drawdown,
            'total_trades': len(completed_trades)
        }
</code></pre>
<h2 id="_12">ç³»çµ±å„ªç¼ºé»åˆ†æ<a class="headerlink" href="#_12" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h2>
<h3 id="_13">å„ªé»<a class="headerlink" href="#_13" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<h4 id="1_2">1. <strong>å…¨é¢çš„ç›£æ§è¦†è“‹</strong><a class="headerlink" href="#1_2" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h4>
<ul>
<li>å››å€‹æ ¸å¿ƒå¤±æ•ˆæ¨¡å¼çš„å®Œæ•´ç›£æ§</li>
<li>å¤šç¶­åº¦æŒ‡æ¨™è©•ä¼°</li>
<li>å¯¦æ™‚å’Œæ»¾å‹•çµ±è¨ˆçµåˆ</li>
</ul>
<h4 id="2_2">2. <strong>æ™ºèƒ½é è­¦ç³»çµ±</strong><a class="headerlink" href="#2_2" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h4>
<ul>
<li>å¤šæ¢ä»¶è§¸ç™¼é‚è¼¯</li>
<li>åš´é‡ç¨‹åº¦è‡ªå‹•è©•ä¼°</li>
<li>é¿å…éåº¦é è­¦çš„é‚è¼¯</li>
</ul>
<h4 id="3_2">3. <strong>è‡ªå‹•åŒ–æ‡‰å°æªæ–½</strong><a class="headerlink" href="#3_2" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h4>
<ul>
<li>æ ¹æ“šé è­¦ç´šåˆ¥è‡ªå‹•èª¿æ•´å€‰ä½</li>
<li>åš´é‡æƒ…æ³è‡ªå‹•åœæ­¢äº¤æ˜“</li>
<li>æ¸›å°‘äººç‚ºå¹²é å’Œæƒ…ç·’åŒ–æ±ºç­–</li>
</ul>
<h4 id="4_1">4. <strong>å¯æ“´å±•çš„é€šçŸ¥ç³»çµ±</strong><a class="headerlink" href="#4_1" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h4>
<ul>
<li>æ”¯æŒå¤šç¨®é€šçŸ¥æ¸ é“</li>
<li>å¯è‡ªå®šç¾©é »ç‡é™åˆ¶</li>
<li>è©³ç´°çš„é è­¦ä¿¡æ¯</li>
</ul>
<h4 id="5">5. <strong>å®Œæ•´çš„å ±å‘Šç³»çµ±</strong><a class="headerlink" href="#5" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h4>
<ul>
<li>å¯¦æ™‚ç‹€æ…‹ç›£æ§</li>
<li>æ­·å²æ•¸æ“šåˆ†æ</li>
<li>è¶¨å‹¢è®ŠåŒ–è·Ÿè¹¤</li>
</ul>
<h3 id="_14">ç¼ºé»<a class="headerlink" href="#_14" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<h4 id="1_3">1. <strong>æ»¯å¾Œæ€§</strong><a class="headerlink" href="#1_3" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h4>
<ul>
<li>åŸºæ–¼æ­·å²æ•¸æ“šçš„ç›£æ§å­˜åœ¨æ»¯å¾Œ</li>
<li>å¯èƒ½ç„¡æ³•åŠæ™‚è­˜åˆ¥çªç„¶çš„å¸‚å ´è®ŠåŒ–</li>
<li>é è­¦è§¸ç™¼æ™‚å¯èƒ½å·²ç¶“ç”¢ç”Ÿè™§æ</li>
</ul>
<h4 id="2_3">2. <strong>åƒæ•¸æ•æ„Ÿæ€§</strong><a class="headerlink" href="#2_3" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h4>
<ul>
<li>é–¾å€¼è¨­ç½®éœ€è¦æ ¹æ“šå…·é«”ç­–ç•¥èª¿æ•´</li>
<li>ä¸åŒå¸‚å ´ç’°å¢ƒéœ€è¦ä¸åŒåƒæ•¸</li>
<li>éåº¦å„ªåŒ–é¢¨éšª</li>
</ul>
<h4 id="3_3">3. <strong>èª¤å ±é¢¨éšª</strong><a class="headerlink" href="#3_3" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h4>
<ul>
<li>æ­£å¸¸çš„æ³¢å‹•å¯èƒ½è§¸ç™¼é è­¦</li>
<li>éåº¦ä¿å®ˆçš„é–¾å€¼æœƒéŒ¯éçœŸå¯¦å¤±æ•ˆ</li>
<li>éœ€è¦å¹³è¡¡æ•æ„Ÿæ€§èˆ‡æº–ç¢ºæ€§</li>
</ul>
<h4 id="4_2">4. <strong>å¯¦æ–½è¤‡é›œåº¦</strong><a class="headerlink" href="#4_2" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h4>
<ul>
<li>éœ€è¦èˆ‡ç¾æœ‰äº¤æ˜“ç³»çµ±é›†æˆ</li>
<li>éœ€è¦å¯é çš„æ•¸æ“šæº</li>
<li>éœ€è¦ç©©å®šçš„é€šçŸ¥æ¸ é“</li>
</ul>
<h4 id="5_1">5. <strong>å¿ƒç†ä¾è³´</strong><a class="headerlink" href="#5_1" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h4>
<ul>
<li>å¯èƒ½å°è‡´éåº¦ä¾è³´è‡ªå‹•åŒ–ç³»çµ±</li>
<li>å¿½ç•¥åŸºæœ¬é¢åˆ†æå’Œå¸‚å ´ç›´è¦º</li>
<li>éœ€è¦äººç‚ºç›£ç£å’Œå¹²é </li>
</ul>
<h2 id="_15">å¯¦éš›æ‡‰ç”¨å»ºè­°<a class="headerlink" href="#_15" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h2>
<h3 id="1_4">1. æ¼¸é€²å¼éƒ¨ç½²<a class="headerlink" href="#1_4" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<h4 id="1-2">ç¬¬ä¸€éšæ®µï¼šç›£æ§æ¨¡å¼ï¼ˆ1-2 é€±ï¼‰<a class="headerlink" href="#1-2" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h4>
<ul>
<li>åƒ…å•Ÿå‹•ç›£æ§ï¼Œä¸è‡ªå‹•æ‡‰å°</li>
<li>æ”¶é›†åŸºç·šæ•¸æ“š</li>
<li>èª¿æ•´é–¾å€¼å’Œåƒæ•¸</li>
</ul>
<h4 id="2-4">ç¬¬äºŒéšæ®µï¼šåŠè‡ªå‹•ï¼ˆ2-4 é€±ï¼‰<a class="headerlink" href="#2-4" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h4>
<ul>
<li>å•Ÿå‹•ä½é¢¨éšªé è­¦çš„æ‡‰å°</li>
<li>ç›£æ§è‡ªå‹•æ‡‰å°çš„æ•ˆæœ</li>
<li>é€²ä¸€æ­¥å„ªåŒ–åƒæ•¸</li>
</ul>
<h4 id="_16">ç¬¬ä¸‰éšæ®µï¼šå…¨è‡ªå‹•ï¼ˆæŒçºŒï¼‰<a class="headerlink" href="#_16" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h4>
<ul>
<li>å•Ÿå‹•æ‰€æœ‰é è­¦ç´šåˆ¥</li>
<li>å®šæœŸå›é¡§å’Œå„ªåŒ–</li>
<li>æŒçºŒç›£æ§ç³»çµ±è¡¨ç¾</li>
</ul>
<h3 id="2_4">2. åƒæ•¸è¨­ç½®åŸå‰‡<a class="headerlink" href="#2_4" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<h4 id="_17">ä¿å®ˆè¨­ç½®ï¼ˆæ¨è–¦åˆå§‹ä½¿ç”¨ï¼‰<a class="headerlink" href="#_17" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h4>
<pre><code class="language-python">conservative_settings = {
    'min_win_rate': 40.0,           # æœ€ä½å‹ç‡ 40%
    'max_consecutive_losses': 6,   # æœ€å¤§é€£çºŒè™§æ 6 ç­†
    'min_profit_loss_ratio': 0.8, # æœ€ä½ç›ˆè™§æ¯” 0.8
    'max_drawdown_threshold': -25.0, # æœ€å¤§å›æ’¤ -25%
    'min_high_conf_win_rate': 50.0  # é«˜ç½®ä¿¡åº¦å‹ç‡ 50%
}
</code></pre>
<h4 id="_18">æ¿€é€²è¨­ç½®ï¼ˆé©ç”¨æ–¼é«˜é¢¨éšªæ‰¿å—èƒ½åŠ›ï¼‰<a class="headerlink" href="#_18" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h4>
<pre><code class="language-python">aggressive_settings = {
    'min_win_rate': 50.0,           # æœ€ä½å‹ç‡ 50%
    'max_consecutive_losses': 3,   # æœ€å¤§é€£çºŒè™§æ 3 ç­†
    'min_profit_loss_ratio': 1.5, # æœ€ä½ç›ˆè™§æ¯” 1.5
    'max_drawdown_threshold': -10.0, # æœ€å¤§å›æ’¤ -10%
    'min_high_conf_win_rate': 70.0  # é«˜ç½®ä¿¡åº¦å‹ç‡ 70%
}
</code></pre>
<h3 id="3_4">3. æ—¥å¸¸ç¶­è­·<a class="headerlink" href="#3_4" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<h4 id="_19">æ¯æ—¥æª¢æŸ¥<a class="headerlink" href="#_19" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h4>
<pre><code class="language-python">def daily_maintenance(monitor):
    &quot;&quot;&quot;
    æ¯æ—¥ç¶­è­·æª¢æŸ¥
    &quot;&quot;&quot;
    # ç²å–ç³»çµ±ç‹€æ…‹
    status = monitor.get_system_status()

    # æª¢æŸ¥é—œéµæŒ‡æ¨™
    alerts = []
    if status['metrics']['win_rate']['recent_win_rate'] &lt; 35:
        alerts.append(&quot;å‹ç‡åš´é‡åä½&quot;)
    if status['metrics']['drawdown']['current_drawdown'] &lt; -20:
        alerts.append(&quot;å›æ’¤è¶…æ¨™&quot;)
    if status['metrics']['signal_quality']['high_conf_win_rate'] &lt; 40:
        alerts.append(&quot;é«˜ç½®ä¿¡åº¦ä¿¡è™Ÿè³ªé‡å·®&quot;)

    # è¨˜éŒ„æ—¥èªŒ
    for alert in alerts:
        print(f&quot;âš ï¸ {alert} - éœ€è¦é—œæ³¨&quot;)

    return alerts
</code></pre>
<h4 id="_20">é€±åº¦åˆ†æ<a class="headerlink" href="#_20" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h4>
<pre><code class="language-python">def weekly_analysis(monitor):
    &quot;&quot;&quot;
    é€±åº¦åˆ†æå ±å‘Š
    &quot;&quot;&quot;
    # ç”Ÿæˆé€±å ±
    report = monitor.generate_report(7)

    # è¨ˆç®—é—œéµæŒ‡æ¨™è®ŠåŒ–
    status = monitor.get_system_status()
    metrics = status['metrics']

    # åˆ†æé è­¦è¶¨å‹¢
    recent_alerts = monitor.alert_history[-7:] if monitor.alert_history else []
    alert_trend = len(recent_alerts)

    # æä¾›æ”¹é€²å»ºè­°
    suggestions = []
    if alert_trend &gt; 3:
        suggestions.append(&quot;è€ƒæ…®æ”¾å¯¬é è­¦é–¾å€¼æˆ–æª¢æŸ¥ç­–ç•¥&quot;)
    if metrics['drawdown']['current_drawdown'] &lt; -15:
        suggestions.append(&quot;é™ä½å€‰ä½æˆ–æš«åœäº¤æ˜“&quot;)
    if metrics['win_rate']['recent_win_rate'] &lt; 40:
        suggestions.append(&quot;æª¢æŸ¥ç­–ç•¥é‚è¼¯å’Œå¸‚å ´ç’°å¢ƒ&quot;)

    return {
        'report': report,
        'alert_trend': alert_trend,
        'suggestions': suggestions
    }
</code></pre>
<h3 id="4_3">4. çªç™¼äº‹ä»¶è™•ç†<a class="headerlink" href="#4_3" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<h4 id="_21">å¸‚å ´åŠ‡è®Šæ‡‰å°<a class="headerlink" href="#_21" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h4>
<pre><code class="language-python">def handle_market_shock(monitor, shock_type):
    &quot;&quot;&quot;
    è™•ç†å¸‚å ´åŠ‡è®Š
    &quot;&quot;&quot;
    if shock_type == &quot;black_swan&quot;:
        # é»‘å¤©éµäº‹ä»¶ï¼šç«‹å³åœæ­¢æ‰€æœ‰äº¤æ˜“
        monitor.execute_response(ActionLevel.STOP_ALL)
        print(&quot;ğŸš¨ é»‘å¤©éµäº‹ä»¶ - åœæ­¢æ‰€æœ‰äº¤æ˜“&quot;)

    elif shock_type == &quot;high_volatility&quot;:
        # é«˜æ³¢å‹•äº‹ä»¶ï¼šé™ä½å€‰ä½
        monitor.execute_response(ActionLevel.REDUCE_25)
        print(&quot;âš¡ é«˜æ³¢å‹•äº‹ä»¶ - é™ä½å€‰ä½è‡³ 25%&quot;)

    elif shock_type == &quot;liquidity_crisis&quot;:
        # æµå‹•æ€§å±æ©Ÿï¼šè¬¹æ…äº¤æ˜“
        monitor.execute_response(ActionLevel.REDUCE_50)
        print(&quot;ğŸ’§ æµå‹•æ€§å±æ©Ÿ - è¬¹æ…äº¤æ˜“&quot;)
</code></pre>
<h4 id="_22">æ•¸æ“šå•é¡Œè™•ç†<a class="headerlink" href="#_22" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h4>
<pre><code class="language-python">def handle_data_issues(monitor):
    &quot;&quot;&quot;
    è™•ç†æ•¸æ“šå•é¡Œ
    &quot;&quot;&quot;
    # æª¢æŸ¥æ•¸æ“šå®Œæ•´æ€§
    if not monitor.equity_curve:
        print(&quot;âŒ è³‡é‡‘æ›²ç·šæ•¸æ“šç¼ºå¤±&quot;)
        return False

    # æª¢æŸ¥äº¤æ˜“è¨˜éŒ„å®Œæ•´æ€§
    recent_trades = [t for t in monitor.trade_history if t.pnl is None]
    if len(recent_trades) &gt; 5:
        print(&quot;âŒ å­˜åœ¨æœªå®Œæˆçš„äº¤æ˜“è¨˜éŒ„&quot;)
        return False

    return True
</code></pre>
<h2 id="_23">é¿å…é è­¦éåº¦æ•æ„Ÿçš„ç­–ç•¥<a class="headerlink" href="#_23" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h2>
<h3 id="1_5">1. å¤šé‡ç¢ºèªæ©Ÿåˆ¶<a class="headerlink" href="#1_5" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<h4 id="_24">æ™‚é–“çª—å£ç¢ºèª<a class="headerlink" href="#_24" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h4>
<pre><code class="language-python">class TimeWindowConfirmation:
    &quot;&quot;&quot;
    æ™‚é–“çª—å£ç¢ºèªæ©Ÿåˆ¶
    &quot;&quot;&quot;

    def __init__(self, window_size=3):
        self.window_size = window_size
        self.alert_history = []

    def should_trigger(self, alert):
        &quot;&quot;&quot;
        æª¢æŸ¥æ˜¯å¦æ‡‰è©²è§¸ç™¼é è­¦

        åªåœ¨åŒä¸€æŒ‡æ¨™é€£çºŒå¤šæ¬¡è§¸ç™¼æ™‚æ‰é è­¦
        &quot;&quot;&quot;
        self.alert_history.append(alert)

        # åªæª¢æŸ¥æœ€è¿‘çª—å£å…§çš„ç›¸åŒé¡å‹é è­¦
        recent_same_type = [
            a for a in self.alert_history[-self.window_size:]
            if a.metric_name == alert.metric_name
        ]

        if len(recent_same_type) &gt;= 2:
            return True
        return False
</code></pre>
<h4 id="_25">åš´é‡ç¨‹åº¦åŠ æ¬Š<a class="headerlink" href="#_25" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h4>
<pre><code class="language-python">def weighted_severity_score(alerts):
    &quot;&quot;&quot;
    è¨ˆç®—åŠ æ¬Šåš´é‡ç¨‹åº¦åˆ†æ•¸
    &quot;&quot;&quot;
    if not alerts:
        return 0.0

    severity_weights = {
        AlertSeverity.HIGH: 3.0,
        AlertSeverity.MEDIUM: 2.0,
        AlertSeverity.LOW: 1.0,
        AlertSeverity.INFO: 0.5
    }

    total_score = sum(severity_weights[alert.severity] for alert in alerts)

    # å¦‚æœæœ‰é‡è¤‡é¡å‹çš„é è­¦ï¼Œå¢åŠ æ¬Šé‡
    metric_types = [alert.metric_name for alert in alerts]
    unique_types = set(metric_types)
    duplicate_penalty = len(alerts) - len(unique_types)

    return total_score + duplicate_penalty * 0.5
</code></pre>
<h3 id="2_5">2. è‡ªé©æ‡‰é–¾å€¼<a class="headerlink" href="#2_5" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<h4 id="_26">å‹•æ…‹é–¾å€¼èª¿æ•´<a class="headerlink" href="#_26" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h4>
<pre><code class="language-python">class AdaptiveThreshold:
    &quot;&quot;&quot;
    è‡ªé©æ‡‰é–¾å€¼èª¿æ•´
    &quot;&quot;&quot;

    def __init__(self, initial_threshold, min_threshold, max_threshold, 
                 adjustment_rate=0.1, stability_period=10):
        self.current_threshold = initial_threshold
        self.min_threshold = min_threshold
        self.max_threshold = max_threshold
        self.adjustment_rate = adjustment_rate
        self.stability_period = stability_period
        self.alert_count = 0
        self.stable_count = 0

    def update(self, current_value, is_alert=False):
        &quot;&quot;&quot;
        æ ¹æ“šç•¶å‰å€¼å’Œé è­¦ç‹€æ…‹èª¿æ•´é–¾å€¼
        &quot;&quot;&quot;
        if is_alert:
            self.alert_count += 1
            self.stable_count = 0

            # å¦‚æœé è­¦éå¤šï¼Œæ”¾å¯¬é–¾å€¼
            if self.alert_count &gt; self.stability_period:
                new_threshold = self.current_threshold * (1 + self.adjustment_rate)
                self.current_threshold = min(new_threshold, self.max_threshold)
                self.alert_count = 0
        else:
            self.stable_count += 1
            self.alert_count = max(0, self.alert_count - 1)

            # å¦‚æœé•·æœŸç©©å®šï¼Œæ”¶ç·Šé–¾å€¼
            if self.stable_count &gt; self.stability_period * 2:
                new_threshold = self.current_threshold * (1 - self.adjustment_rate)
                self.current_threshold = max(new_threshold, self.min_threshold)
                self.stable_count = 0

        return self.current_threshold
</code></pre>
<h4 id="_27">å¸‚å ´æ³¢å‹•æ€§èª¿æ•´<a class="headerlink" href="#_27" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h4>
<pre><code class="language-python">def volatility_adjusted_threshold(base_threshold, volatility, normal_volatility=0.01):
    &quot;&quot;&quot;
    æ ¹æ“šå¸‚å ´æ³¢å‹•æ€§èª¿æ•´é–¾å€¼
    &quot;&quot;&quot;
    if volatility &lt;= 0:
        return base_threshold

    # è¨ˆç®—æ³¢å‹•æ€§æ¯”ä¾‹
    vol_ratio = volatility / normal_volatility

    # æ ¹æ“šæ³¢å‹•æ€§èª¿æ•´é–¾å€¼
    if vol_ratio &gt; 2.0:
        # é«˜æ³¢å‹•ï¼šæ”¾å¯¬é–¾å€¼
        adjusted_threshold = base_threshold * 1.5
    elif vol_ratio &gt; 1.5:
        # ä¸­é«˜æ³¢å‹•ï¼šé©åº¦æ”¾å¯¬
        adjusted_threshold = base_threshold * 1.2
    elif vol_ratio &lt; 0.5:
        # ä½æ³¢å‹•ï¼šæ”¶ç·Šé–¾å€¼
        adjusted_threshold = base_threshold * 0.8
    else:
        # æ­£å¸¸æ³¢å‹•ï¼šä¸èª¿æ•´
        adjusted_threshold = base_threshold

    return adjusted_threshold
</code></pre>
<h3 id="3_5">3. æ™ºèƒ½éæ¿¾<a class="headerlink" href="#3_5" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<h4 id="_28">é‡è¦æ€§æ¬Šé‡<a class="headerlink" href="#_28" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h4>
<pre><code class="language-python">def calculate_importance_weight(alert):
    &quot;&quot;&quot;
    è¨ˆç®—é è­¦çš„é‡è¦æ€§æ¬Šé‡
    &quot;&quot;&quot;
    weight = 1.0

    # æ ¹æ“šæŒ‡æ¨™é¡å‹åˆ†é…æ¬Šé‡
    if alert.metric_name == &quot;win_rate&quot;:
        weight *= 1.5  # å‹ç‡æœ€é‡è¦
    elif alert.metric_name == &quot;drawdown&quot;:
        weight *= 1.3  # å›æ’¤å¾ˆé‡è¦
    elif alert.metric_name == &quot;consecutive_losses&quot;:
        weight *= 1.2  # é€£çºŒè™§æè¼ƒé‡è¦
    elif alert.metric_name == &quot;high_conf_win_rate&quot;:
        weight *= 1.1  # é«˜ç½®ä¿¡åº¦å‹ç‡è¼ƒé‡è¦

    # æ ¹æ“šåé›¢ç¨‹åº¦èª¿æ•´æ¬Šé‡
    deviation_ratio = abs(alert.current_value - alert.threshold) / abs(alert.threshold)
    if deviation_ratio &gt; 0.5:
        weight *= 1.5
    elif deviation_ratio &gt; 0.3:
        weight *= 1.2

    return weight
</code></pre>
<h4 id="_29">æ™‚é–“éæ¿¾<a class="headerlink" href="#_29" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h4>
<pre><code class="language-python">class TimeBasedFilter:
    &quot;&quot;&quot;
    åŸºæ–¼æ™‚é–“çš„é è­¦éæ¿¾
    &quot;&quot;&quot;

    def __init__(self, min_interval_minutes=30):
        self.min_interval_minutes = min_interval_minutes
        self.last_alert_time = {}

    def should_alert(self, alert):
        &quot;&quot;&quot;
        æª¢æŸ¥æ˜¯å¦æ‡‰è©²ç™¼é€é è­¦ï¼ˆåŸºæ–¼æ™‚é–“é–“éš”ï¼‰
        &quot;&quot;&quot;
        alert_key = f&quot;{alert.metric_name}_{alert.severity.value}&quot;

        if alert_key in self.last_alert_time:
            time_diff = (datetime.now() - self.last_alert_time[alert_key]).total_seconds() / 60
            if time_diff &lt; self.min_interval_minutes:
                return False

        self.last_alert_time[alert_key] = datetime.now()
        return True
</code></pre>
<h2 id="_30">çµè«–<a class="headerlink" href="#_30" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h2>
<p>æœ¬è¶¨å‹¢ç­–ç•¥å¤±æ•ˆç›£æ§ç³»çµ±é€šéå››å€‹æ ¸å¿ƒå¤±æ•ˆæ¨¡å¼çš„ç›£æ§ï¼ˆå‹ç‡ä¸‹é™ã€ç›ˆè™§æ¯”æƒ¡åŒ–ã€å›æ’¤è¶…æ¨™ã€ä¿¡è™Ÿè³ªé‡ä¸‹é™ï¼‰ï¼Œæä¾›äº†å…¨é¢çš„ç­–ç•¥ä¿è­·æ©Ÿåˆ¶ã€‚</p>
<h3 id="_31">æ ¸å¿ƒåƒ¹å€¼<a class="headerlink" href="#_31" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<ol>
<li><strong>é¢¨éšªæ§åˆ¶</strong> - åŠæ™‚è­˜åˆ¥ç­–ç•¥å¤±æ•ˆï¼Œé™ä½æå¤±</li>
<li><strong>è‡ªå‹•åŒ–æ‡‰å°</strong> - æ ¹æ“šåš´é‡ç¨‹åº¦è‡ªå‹•æ¡å–ä¿è­·æªæ–½</li>
<li><strong>å¤šç¶­åº¦ç›£æ§</strong> - å¾å¤šå€‹è§’åº¦è©•ä¼°ç­–ç•¥å¥åº·åº¦</li>
<li><strong>æ™ºèƒ½é è­¦</strong> - é¿å…éåº¦æ•æ„Ÿçš„é è­¦æ©Ÿåˆ¶</li>
</ol>
<h3 id="_32">é æœŸæ•ˆæœ<a class="headerlink" href="#_32" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<p>åœ¨å¯¦éš›æ‡‰ç”¨ä¸­ï¼Œè©²ç³»çµ±é æœŸèƒ½å¤ ï¼š
- æ¸›å°‘ç­–ç•¥å¤±æ•ˆæœŸé–“çš„æå¤± 30-50%
- æé«˜é•·æœŸè³‡é‡‘æ›²ç·šç©©å®šæ€§
- æä¾›æ¸…æ™°çš„ç­–ç•¥å¥åº·åº¦æŒ‡æ¨™
- é™ä½æƒ…ç·’åŒ–æ±ºç­–çš„é¢¨éšª</p>
<h3 id="_33">å¯¦æ–½å»ºè­°<a class="headerlink" href="#_33" title="é€£çµåˆ°æ­¤æ¨™é¡Œ">&para;</a></h3>
<ol>
<li><strong>å¾ç›£æ§æ¨¡å¼é–‹å§‹</strong> - å…ˆè®“ç³»çµ±é‹è¡Œä¸€æ®µæ™‚é–“ï¼Œæ”¶é›†åŸºç·šæ•¸æ“š</li>
<li><strong>é€æ­¥å•Ÿç”¨æ‡‰å°</strong> - å…ˆå¾ä½é¢¨éšªé è­¦çš„æ‡‰å°é–‹å§‹</li>
<li><strong>å®šæœŸå„ªåŒ–åƒæ•¸</strong> - æ ¹æ“šå¯¦éš›è¡¨ç¾èª¿æ•´é–¾å€¼å’Œåƒæ•¸</li>
<li><strong>ä¿æŒäººç›£ç£</strong> - è‡ªå‹•åŒ–ç³»çµ±éœ€è¦äººé¡ç›£ç£å’Œå¹²é </li>
</ol>
<p>é€šéé€™å€‹ç³»çµ±ï¼Œè¶¨å‹¢äº¤æ˜“è€…å¯ä»¥æ›´å¥½åœ°ä¿è­·è‡ªå·±çš„è³‡é‡‘ï¼Œåœ¨ç­–ç•¥å¤±æ•ˆæ™‚åŠæ™‚æ¡å–è¡Œå‹•ï¼Œå¾è€Œæé«˜é•·æœŸäº¤æ˜“çš„æˆåŠŸç‡ã€‚</p>
<hr />
<p><strong>ä»»å‹™ç‹€æ…‹ï¼šå·²å®Œæˆ</strong>
<strong>å®Œæˆæ™‚é–“ï¼š2026-02-19</strong>
<strong>ç½®ä¿¡åº¦ï¼šé«˜</strong>
**ä¸‹ä¸€æ­¥ï¼šé€²è¡Œ t004 æ³¢å‹•ç‡é©æ‡‰æ€§è¶¨å‹¢è·Ÿéš¨ç ”ç©¶</p>
        </div>
        
        <div class="footer">
            <p>Â© 2026 Charlie's Quantitative Trading Research Hub</p>
            <p class="disclaimer">âš ï¸ å…è²¬è²æ˜ï¼šç ”ç©¶å…§å®¹åƒ…ä¾›å­¸è¡“åƒè€ƒï¼Œä¸æ§‹æˆä»»ä½•æŠ•è³‡å»ºè­°ã€‚æŠ•è³‡æœ‰é¢¨éšªï¼Œè«‹è¬¹æ…è©•ä¼°ã€‚</p>
        </div>
    </div>
</body>
</html>
